<!DOCTYPE html>
<html lang="en">
<head>
	<title>CommonSettings.php - Wikimedia configuration files</title>
	<link rel="shortcut icon" href="//www.wikimedia.org/static/favicon/wmf.ico">
	<link rel="stylesheet" href="../css/base.css">
</head>
<body>
<h1><a href="./">&laquo;</a> CommonSettings.php</h1>
<p>(
<a href="https://gerrit.wikimedia.org/g/operations/mediawiki-config/+log/master/wmf-config/CommonSettings.php">version control</a> &bull;
<a href="https://gerrit.wikimedia.org/g/operations/mediawiki-config/+blame/master/wmf-config/CommonSettings.php?blame=1">blame</a> &bull;
<a href="CommonSettings.php.txt">raw text</a>
)</p>
<hr>
<pre><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000"># WARNING: This file is publicly viewable on the web. Do not put private data here.<br /><br /># CommonSettings.php is the main configuration file of the WMF cluster.<br /># This file contains settings common to all (or many) WMF wikis.<br /># For per-wiki configuration, see InitialiseSettings.php.<br />#<br /># This is for PRODUCTION.<br />#<br /># Effective load order:<br /># - multiversion<br /># - mediawiki/DefaultSettings.php<br /># - wmf-config/InitialiseSettings.php<br /># - wmf-config/CommonSettings.php [THIS FILE]<br />#<br /># Full load tree:<br /># - multiversion<br /># - mediawiki/index.php (or other entry point)<br /># - mediawiki/WebStart.php<br /># - mediawiki/Setup.php<br /># - mediawiki/DefaultSettings.php<br /># - mediawiki/LocalSettings.php<br />#   `-- wmf-config/CommonSettings.php [THIS FILE]<br />#	   |-- wmf-config/*Services.php<br />#	   |-- wmf-config/etcd.php<br />#	   |-- wmf-config/InitialiseSettings.php<br />#	   |-- private/PrivateSettings.php<br />#	   |-- wmf-config/logging.php<br />#	   |-- wmf-config/redis.php<br />#	   |-- wmf-config/filebackend.php<br />#	   |-- wmf-config/db-*.php<br />#	   |-- wmf-config/mc.php<br />#	   |<br />#	   `-- (main stuff in CommonSettings.php)<br />#<br /><br /></span><span style="color: #007700">use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">AuthenticationResponse</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Extension</span><span style="color: #007700">\</span><span style="color: #0000BB">ApiFeatureUsage</span><span style="color: #007700">\</span><span style="color: #0000BB">ApiFeatureUsageQueryEngineElastica</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Extension</span><span style="color: #007700">\</span><span style="color: #0000BB">CentralAuth</span><span style="color: #007700">\</span><span style="color: #0000BB">User</span><span style="color: #007700">\</span><span style="color: #0000BB">CentralAuthUser</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Extension</span><span style="color: #007700">\</span><span style="color: #0000BB">ExtensionDistributor</span><span style="color: #007700">\</span><span style="color: #0000BB">Providers</span><span style="color: #007700">\</span><span style="color: #0000BB">GerritExtDistProvider</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Logger</span><span style="color: #007700">\</span><span style="color: #0000BB">LoggerFactory</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">MediaWikiServices</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">User</span><span style="color: #007700">\</span><span style="color: #0000BB">UserIdentity</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">Wikimedia</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfig</span><span style="color: #007700">\</span><span style="color: #0000BB">ServiceConfig</span><span style="color: #007700">;<br />use </span><span style="color: #0000BB">Wikimedia</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfig</span><span style="color: #007700">\</span><span style="color: #0000BB">XWikimediaDebug</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Godforsaken hack to work around problems with the reverse proxy caching changes...<br />#<br /># To minimize damage on fatal PHP errors, output a default no-cache header<br /># It will be overridden in cases where we actually specify caching behavior.<br />#<br /># More modern PHP versions will send a 500 result code on fatal error,<br /># at least sometimes, but what we're running will send a 200.<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">PHP_SAPI </span><span style="color: #007700">!== </span><span style="color: #DD0000">'cli' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">header</span><span style="color: #007700">( </span><span style="color: #DD0000">"Cache-control: no-cache" </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000"># ----------------------------------------------------------------------<br /># Initialisation<br /><br /></span><span style="color: #007700">require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/../src/XWikimediaDebug.php'</span><span style="color: #007700">;<br />require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/../src/ServiceConfig.php'</span><span style="color: #007700">;<br />require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/etcd.php'</span><span style="color: #007700">;<br />require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/../multiversion/MWConfigCacheGenerator.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// - This file must be included by MediaWiki via our LocalSettings.php file.<br />//   Determined by MediaWiki core having initialised the $IP variable.<br />// - MediaWiki must be included via a multiversion-aware entry point<br />//   (e.g. WMF's "w/index.php", or MWScript).<br />//   That entry point must have initialised the MWMultiVersion singleton and<br />//   decided which wiki we are on (based on hostname or --wiki CLI arg).<br />//   Note that getInstance does not (and may not) lazy-create this instance,<br />//   it returns null if it hasn't been setup yet.<br /></span><span style="color: #0000BB">$multiVersion </span><span style="color: #007700">= </span><span style="color: #0000BB">class_exists</span><span style="color: #007700">( </span><span style="color: #DD0000">'MWMultiVersion' </span><span style="color: #007700">) ? </span><span style="color: #0000BB">MWMultiVersion</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">() : </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />if ( !isset( </span><span style="color: #0000BB">$IP </span><span style="color: #007700">) || !</span><span style="color: #0000BB">$multiVersion </span><span style="color: #007700">) {<br />	print </span><span style="color: #DD0000">"No MWMultiVersion instance initialized! MWScript.php wrapper not used?\n"</span><span style="color: #007700">;<br />	exit( </span><span style="color: #0000BB">1 </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$includePaths </span><span style="color: #007700">= [ </span><span style="color: #0000BB">$IP</span><span style="color: #007700">, </span><span style="color: #DD0000">'/usr/local/lib/php'</span><span style="color: #007700">, </span><span style="color: #DD0000">'/usr/share/php' </span><span style="color: #007700">];<br />if ( </span><span style="color: #0000BB">is_readable</span><span style="color: #007700">( </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/vendor/composer/include_paths.php" </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$includePaths </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br />		require </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/vendor/composer/include_paths.php"</span><span style="color: #007700">,<br />		</span><span style="color: #0000BB">$includePaths<br />	</span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">set_include_path</span><span style="color: #007700">( </span><span style="color: #0000BB">implode</span><span style="color: #007700">( </span><span style="color: #0000BB">PATH_SEPARATOR</span><span style="color: #007700">, </span><span style="color: #0000BB">$includePaths </span><span style="color: #007700">) );<br /><br /></span><span style="color: #FF8000">### List of some service hostnames<br /># 'meta'	: meta wiki for user editable content<br /># 'upload'  : hostname where files are hosted<br /># 'wikidata': hostname for the data repository<br /># Whenever all realms/datacenters should use the same host, do not use<br /># $wmgHostnames but use the hardcoded hostname instead. A good example are the<br /># spam blacklists hosted on meta.wikimedia.org which you will surely want to<br /># reuse.<br /></span><span style="color: #0000BB">$wmgHostnames </span><span style="color: #007700">= [];<br />switch ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">) {<br />case </span><span style="color: #DD0000">'labs'</span><span style="color: #007700">:<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'meta'</span><span style="color: #007700">]		  = </span><span style="color: #DD0000">'meta.wikimedia.beta.wmflabs.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'test'</span><span style="color: #007700">]		  = </span><span style="color: #DD0000">'test.wikipedia.beta.wmflabs.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'upload'</span><span style="color: #007700">]		= </span><span style="color: #DD0000">'upload.wikimedia.beta.wmflabs.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikidata'</span><span style="color: #007700">]	  = </span><span style="color: #DD0000">'wikidata.beta.wmflabs.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikifunctions'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'wikifunctions.beta.wmflabs.org'</span><span style="color: #007700">;<br />	break;<br />case </span><span style="color: #DD0000">'production'</span><span style="color: #007700">:<br />default:<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'meta'</span><span style="color: #007700">]		  = </span><span style="color: #DD0000">'meta.wikimedia.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'test'</span><span style="color: #007700">]		  = </span><span style="color: #DD0000">'test.wikipedia.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'upload'</span><span style="color: #007700">]		= </span><span style="color: #DD0000">'upload.wikimedia.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikidata'</span><span style="color: #007700">]	  = </span><span style="color: #DD0000">'www.wikidata.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikifunctions'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'www.wikifunctions.org'</span><span style="color: #007700">;<br />	break;<br />}<br /><br /></span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">= </span><span style="color: #0000BB">$multiVersion</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getDatabase</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$wgDBuser </span><span style="color: #007700">= </span><span style="color: #DD0000">'wikiuser'</span><span style="color: #007700">; </span><span style="color: #FF8000">// Don't rely on MW default (T46251)<br /></span><span style="color: #0000BB">$wgSQLMode </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wmgVersionNumber </span><span style="color: #007700">= </span><span style="color: #0000BB">$multiVersion</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getVersionNumber</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Used further down this file for per-wiki SiteConfiguration caching:<br /># - MUST be in /tmp to allow atomic rename from elsewhere in /tmp.<br /># - MUST vary by MediaWiki branch (aka MWMultiversion deployment version).<br />#<br /># Also used by MediaWiki core for various caching purposes, and may<br /># be shared between wikis (e.g. does not need to vary by wgDBname).<br /></span><span style="color: #0000BB">$wgCacheDirectory </span><span style="color: #007700">= </span><span style="color: #DD0000">'/tmp/mw-cache-' </span><span style="color: #007700">. </span><span style="color: #0000BB">$wmgVersionNumber</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wmgServerGroup </span><span style="color: #007700">= </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'SERVERGROUP'</span><span style="color: #007700">] ?? </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Whether MediaWiki is running on Kubernetes, intended for config<br /># that needs to differ during the migration. On dedicated servers,<br /># SERVERGROUP is set by Puppet in profile::mediawiki::httpd, in<br /># Kubernetes pods, it's set by configuring the php.servergroup<br /># Helm value.<br /></span><span style="color: #0000BB">$wmgUsingKubernetes </span><span style="color: #007700">= </span><span style="color: #0000BB">strpos</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgServerGroup</span><span style="color: #007700">, </span><span style="color: #DD0000">'kube-' </span><span style="color: #007700">) === </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Get all the service definitions<br /></span><span style="color: #0000BB">$wmgAllServices </span><span style="color: #007700">= </span><span style="color: #0000BB">ServiceConfig</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getAllServices</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000"># Shorthand when we have no master-replica situation to keep into account<br /></span><span style="color: #0000BB">$wmgLocalServices </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #0000BB">$wmgDatacenter</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000"># The list of datacenters known to this realm<br /></span><span style="color: #0000BB">$wmgDatacenters </span><span style="color: #007700">= </span><span style="color: #0000BB">ServiceConfig</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getDatacenters</span><span style="color: #007700">();<br /><br />if ( </span><span style="color: #0000BB">getenv</span><span style="color: #007700">( </span><span style="color: #DD0000">'WMF_MAINTENANCE_OFFLINE' </span><span style="color: #007700">) ) {<br />	</span><span style="color: #FF8000">// Prepare just enough configuration to allow<br />	// rebuildLocalisationCache.php and mergeMessageFileList.php to<br />	// run to completion without complaints.<br /><br />	</span><span style="color: #0000BB">$wmgEtcdLastModifiedIndex </span><span style="color: #007700">= </span><span style="color: #DD0000">"wmgEtcdLastModifiedIndex uninitialized due to WMF_MAINTENANCE_OFFLINE"</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgReadOnly </span><span style="color: #007700">= </span><span style="color: #DD0000">"In read-only mode because WMF_MAINTENANCE_OFFLINE is set"</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wmgMasterDatacenter </span><span style="color: #007700">= </span><span style="color: #0000BB">ServiceConfig</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getDatacenter</span><span style="color: #007700">();<br />	</span><span style="color: #0000BB">$wmgMasterServices </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #0000BB">$wmgMasterDatacenter</span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wmgDbconfigFromEtcd </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'readOnlyBySection' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'groupLoadsBySection' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'DEFAULT' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'' </span><span style="color: #007700">=&gt; [<br />				   </span><span style="color: #DD0000">'WMF_MAINTENANCE_OFFLINE_placeholder' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0<br />				</span><span style="color: #007700">],<br />			],<br />		],<br />		</span><span style="color: #DD0000">'hostsByName' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'sectionLoads' </span><span style="color: #007700">=&gt; [],<br />		</span><span style="color: #DD0000">'externalLoads' </span><span style="color: #007700">=&gt; [],<br />	];<br />} else {<br />	</span><span style="color: #0000BB">$etcdConfig </span><span style="color: #007700">= </span><span style="color: #0000BB">wmfSetupEtcd</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'etcd'</span><span style="color: #007700">] );<br /><br />	</span><span style="color: #0000BB">$wmgEtcdLastModifiedIndex </span><span style="color: #007700">= </span><span style="color: #0000BB">$etcdConfig</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getModifiedIndex</span><span style="color: #007700">();<br />	</span><span style="color: #0000BB">$wgReadOnly </span><span style="color: #007700">= </span><span style="color: #0000BB">$etcdConfig</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">( </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$wmgDatacenter</span><span style="color: #DD0000">/ReadOnly" </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wmgMasterDatacenter </span><span style="color: #007700">= </span><span style="color: #0000BB">$etcdConfig</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">( </span><span style="color: #DD0000">'common/WMFMasterDatacenter' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wmgMasterServices </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #0000BB">$wmgMasterDatacenter</span><span style="color: #007700">];<br /><br />	</span><span style="color: #FF8000">// Database load balancer config (sectionLoads, groupLoadsBySection, …)<br />	// This is later merged into $wgLBFactoryConf by wmfEtcdApplyDBConfig().<br />	// See also &lt;https://wikitech.wikimedia.org/wiki/Dbctl&gt;<br />	</span><span style="color: #0000BB">$wmgDbconfigFromEtcd </span><span style="color: #007700">= </span><span style="color: #0000BB">$etcdConfig</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">get</span><span style="color: #007700">( </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$wmgDatacenter</span><span style="color: #DD0000">/dbconfig" </span><span style="color: #007700">);<br /><br />	unset( </span><span style="color: #0000BB">$etcdConfig </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$wmgUdp2logDest </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'udp2log'</span><span style="color: #007700">];<br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'testwiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'test2wiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDebugLogFile </span><span style="color: #007700">= </span><span style="color: #DD0000">"udp://</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgUdp2logDest</span><span style="color: #007700">}</span><span style="color: #DD0000">/testwiki"</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDebugLogFile </span><span style="color: #007700">= </span><span style="color: #DD0000">'/dev/null'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgConf </span><span style="color: #007700">= new </span><span style="color: #0000BB">SiteConfiguration</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgConf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">suffixes </span><span style="color: #007700">= </span><span style="color: #0000BB">MWMultiVersion</span><span style="color: #007700">::</span><span style="color: #0000BB">SUFFIXES</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgConf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">wikis </span><span style="color: #007700">= </span><span style="color: #0000BB">MWWikiversions</span><span style="color: #007700">::</span><span style="color: #0000BB">readDbListFile</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">? </span><span style="color: #DD0000">'all-labs' </span><span style="color: #007700">: </span><span style="color: #DD0000">'all' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgConf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">fullLoadCallback </span><span style="color: #007700">= </span><span style="color: #DD0000">'wmfLoadInitialiseSettings'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/**<br /> * @param SiteConfiguration $conf<br /> */<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">wmfLoadInitialiseSettings</span><span style="color: #007700">( </span><span style="color: #0000BB">$conf </span><span style="color: #007700">) {<br />	global </span><span style="color: #0000BB">$wmgRealm</span><span style="color: #007700">;<br />	require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/InitialiseSettings.php'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$settings </span><span style="color: #007700">= </span><span style="color: #0000BB">wmfGetVariantSettings</span><span style="color: #007700">();<br /><br />	if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">!== </span><span style="color: #DD0000">'production' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// Override for Beta Cluster and other realms.<br />		// Ref: InitialiseSettings-labs.php<br />		</span><span style="color: #007700">require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">"/InitialiseSettings-</span><span style="color: #0000BB">$wmgRealm</span><span style="color: #DD0000">.php"</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$settings </span><span style="color: #007700">= </span><span style="color: #0000BB">Wikimedia</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfig</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfigCacheGenerator</span><span style="color: #007700">::</span><span style="color: #0000BB">applyOverrides</span><span style="color: #007700">( </span><span style="color: #0000BB">$settings </span><span style="color: #007700">);<br />	}<br /><br />	</span><span style="color: #0000BB">$conf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">settings </span><span style="color: #007700">= </span><span style="color: #0000BB">$settings</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgLocalDatabases </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgConf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLocalDatabases</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// Do not add wikimedia.org, because of other non-MediaWiki sites under that domain<br />// Do not add wikidata.org, because of query.wikidata.org<br />// If a non-MediaWiki site gets into this list, MediaWiki will not be able to<br />// make HTTP requests to it.<br />// At a minimum, all SUL-linked wikis must be included here for cross-wiki HTTP<br />// requests to work (GlobalUserPage, cross-wiki notifications, etc.).<br />// TODO: add remaining MediaWiki sites<br /></span><span style="color: #0000BB">$wgLocalVirtualHosts </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'wikipedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wiktionary.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikiquote.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikibooks.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikiquote.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikinews.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikisource.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikiversity.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikivoyage.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'www.mediawiki.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'www.wikidata.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'test.wikidata.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'api.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'ar.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'bd.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'be.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'br.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'ca.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'co.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'commons.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'dk.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'ee.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'fi.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'foundation.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'incubator.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'login.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'meta.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'mk.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'mx.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'nl.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'no.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'nyc.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'outreach.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'pl.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'pt.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'ru.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'se.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'species.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'test-commons.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'tr.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'ua.wikimedia.org'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'wikimania.wikimedia.org'</span><span style="color: #007700">,<br />];<br /><br /></span><span style="color: #FF8000"># Is this database listed in dblist?<br /># Note: must be done before calling $multiVersion functions other than getDatabase().<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">array_search</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgLocalDatabases </span><span style="color: #007700">) === </span><span style="color: #0000BB">false </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000"># No? Load missing.php<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgCommandLineMode </span><span style="color: #007700">) {<br />		print </span><span style="color: #DD0000">"Database name </span><span style="color: #0000BB">$wgDBname</span><span style="color: #DD0000"> is not listed in dblist\n"</span><span style="color: #007700">;<br />	} else {<br />		require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/missing.php'</span><span style="color: #007700">;<br />	}<br />	exit;<br />}<br /><br /></span><span style="color: #FF8000"># Determine domain and language and the directories for this instance<br /></span><span style="color: #007700">list( </span><span style="color: #0000BB">$site</span><span style="color: #007700">, </span><span style="color: #0000BB">$lang </span><span style="color: #007700">) = </span><span style="color: #0000BB">$wgConf</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">siteFromDB</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000"># Try configuration cache<br /></span><span style="color: #0000BB">$confCacheFileName </span><span style="color: #007700">= </span><span style="color: #DD0000">"conf2-</span><span style="color: #0000BB">$wgDBname</span><span style="color: #DD0000">.json"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$confActualMtime </span><span style="color: #007700">= </span><span style="color: #0000BB">max</span><span style="color: #007700">(<br />	</span><span style="color: #0000BB">filemtime</span><span style="color: #007700">( </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/InitialiseSettings.php' </span><span style="color: #007700">),<br />	</span><span style="color: #0000BB">filemtime</span><span style="color: #007700">( </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/logos.php' </span><span style="color: #007700">),<br />	</span><span style="color: #0000BB">filemtime</span><span style="color: #007700">( </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/includes/Defines.php" </span><span style="color: #007700">)<br />);<br /></span><span style="color: #0000BB">$globals </span><span style="color: #007700">= </span><span style="color: #0000BB">Wikimedia</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfig</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfigCacheGenerator</span><span style="color: #007700">::</span><span style="color: #0000BB">readFromStaticCache</span><span style="color: #007700">(<br />	</span><span style="color: #0000BB">$wgCacheDirectory </span><span style="color: #007700">. </span><span style="color: #DD0000">'/' </span><span style="color: #007700">. </span><span style="color: #0000BB">$confCacheFileName</span><span style="color: #007700">, </span><span style="color: #0000BB">$confActualMtime<br /></span><span style="color: #007700">);<br /><br />if ( !</span><span style="color: #0000BB">$globals </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000"># Get configuration from SiteConfiguration object<br />	</span><span style="color: #0000BB">wmfLoadInitialiseSettings</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgConf </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$globals </span><span style="color: #007700">= </span><span style="color: #0000BB">Wikimedia</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfig</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfigCacheGenerator</span><span style="color: #007700">::</span><span style="color: #0000BB">getMWConfigForCacheing</span><span style="color: #007700">(<br />		</span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">, </span><span style="color: #0000BB">$site</span><span style="color: #007700">, </span><span style="color: #0000BB">$lang</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgConf</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgRealm<br />	</span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$confCacheObject </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'mtime' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$confActualMtime</span><span style="color: #007700">, </span><span style="color: #DD0000">'globals' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$globals </span><span style="color: #007700">];<br /><br />	</span><span style="color: #FF8000"># Save cache if the grace period expired.<br />	# We define the grace period as the opcache revalidation frequency + 1<br />	# in order to ensure we don't incur in race conditions when saving the values.<br />	# See T236104<br />	</span><span style="color: #0000BB">$minTime </span><span style="color: #007700">= </span><span style="color: #0000BB">$confActualMtime </span><span style="color: #007700">+ </span><span style="color: #0000BB">intval</span><span style="color: #007700">( </span><span style="color: #0000BB">ini_get</span><span style="color: #007700">( </span><span style="color: #DD0000">'opcache.revalidate_freq' </span><span style="color: #007700">) );<br />	if ( </span><span style="color: #0000BB">time</span><span style="color: #007700">() &gt; </span><span style="color: #0000BB">$minTime </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">Wikimedia</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfig</span><span style="color: #007700">\</span><span style="color: #0000BB">MWConfigCacheGenerator</span><span style="color: #007700">::</span><span style="color: #0000BB">writeToStaticCache</span><span style="color: #007700">(<br />			</span><span style="color: #0000BB">$wgCacheDirectory</span><span style="color: #007700">, </span><span style="color: #0000BB">$confCacheFileName</span><span style="color: #007700">, </span><span style="color: #0000BB">$confCacheObject<br />		</span><span style="color: #007700">);<br />	}<br />}<br />unset( </span><span style="color: #0000BB">$confCacheFileName</span><span style="color: #007700">, </span><span style="color: #0000BB">$confActualMtime</span><span style="color: #007700">, </span><span style="color: #0000BB">$confCacheObject </span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">extract</span><span style="color: #007700">( </span><span style="color: #0000BB">$globals </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000"># -------------------------------------------------------------------------<br /># Settings common to all wikis<br /><br /># Private settings such as passwords, that shouldn't be published<br /># Needs to be before db.php<br /></span><span style="color: #007700">require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/../private/PrivateSettings.php'</span><span style="color: #007700">;<br /><br />require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/logging.php'</span><span style="color: #007700">;<br />require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/redis.php'</span><span style="color: #007700">;<br />require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/filebackend.php'</span><span style="color: #007700">;<br />require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/mc.php'</span><span style="color: #007700">;<br />if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Beta Cluster overrides<br />	</span><span style="color: #007700">require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/mc-labs.php'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #FF8000"># db-*.php needs $wgDebugDumpSql so should be loaded after logging.php.<br /># Ref: db-production.php or db-labs.php<br /></span><span style="color: #007700">require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">"/db-</span><span style="color: #0000BB">$wmgRealm</span><span style="color: #DD0000">.php"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Override certain settings in command-line mode<br /># This must be after InitialiseSettings.php is processed (T197475)<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">PHP_SAPI </span><span style="color: #007700">=== </span><span style="color: #DD0000">'cli' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgShowExceptionDetails </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># APC not available in CLI mode<br />	</span><span style="color: #0000BB">$wgLanguageConverterCacheType </span><span style="color: #007700">= </span><span style="color: #0000BB">CACHE_NONE</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">XWikimediaDebug</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">hasOption</span><span style="color: #007700">( </span><span style="color: #DD0000">'readonly' </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgReadOnly </span><span style="color: #007700">= </span><span style="color: #DD0000">'X-Wikimedia-Debug'</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">$wgAllowedCorsHeaders</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'X-Wikimedia-Debug'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// In production, read the database loadbalancer config from etcd.<br />// See https://wikitech.wikimedia.org/wiki/Dbctl<br />// This must be called after db-{eqiad,codfw}.php has been loaded!<br />// It overwrites a few sections of $wgLBFactoryConf with data from etcd.<br /></span><span style="color: #0000BB">wmfEtcdApplyDBConfig</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// labtestwiki is a one-off test server, using a wmcs-managed database.  Cut<br />// etcd out of the loop entirely for this one.<br /></span><span style="color: #0000BB">$wgLBFactoryConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'sectionLoads'</span><span style="color: #007700">][</span><span style="color: #DD0000">'s11'</span><span style="color: #007700">] = [ </span><span style="color: #DD0000">'clouddb2001-dev' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1 </span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$wgLBFactoryConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'hostsByName'</span><span style="color: #007700">][</span><span style="color: #DD0000">'clouddb2001-dev'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'10.192.20.11'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Set $wgProfiler to the value provided by PhpAutoPrepend.php<br /></span><span style="color: #007700">if ( isset( </span><span style="color: #0000BB">$wmgProfiler </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgProfiler </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgProfiler</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># Disallow web request DB transactions slower than this<br /></span><span style="color: #0000BB">$wgMaxUserDBWriteDuration </span><span style="color: #007700">= </span><span style="color: #0000BB">3</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Activate read-only mode for bots when lag is getting high.<br /># This should be lower than 'max lag' in the LBFactory conf.<br /></span><span style="color: #0000BB">$wgAPIMaxLagThreshold </span><span style="color: #007700">= </span><span style="color: #0000BB">3</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Allow different memory_limit settings for Parsoid/PHP servers (T236833)<br /># keep in sync with php7-fatal-error.php in operations/puppet<br /># and with wmf-config/logging.php<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgServerGroup </span><span style="color: #007700">=== </span><span style="color: #DD0000">'parsoid' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">( </span><span style="color: #DD0000">'memory_limit'</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgMemoryLimitParsoid </span><span style="color: #007700">);<br />} else {<br />	</span><span style="color: #0000BB">ini_set</span><span style="color: #007700">( </span><span style="color: #DD0000">'memory_limit'</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgMemoryLimit </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000"># Change calls to wfShellWikiCmd() to use MWScript.php wrapper<br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'wfShellWikiCmd'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'MWMultiVersion::onWfShellMaintenanceCmd'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">setlocale</span><span style="color: #007700">( </span><span style="color: #0000BB">LC_ALL</span><span style="color: #007700">, </span><span style="color: #DD0000">'en_US.UTF-8' </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Revision backend settings<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgCompressRevisions </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgExternalStores </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'DB' </span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Performance settings and restrictions<br /># ######################################################################<br /><br />// Replicas aren't fast enough to generate all special pages all the time.<br /></span><span style="color: #0000BB">$wgMiserMode </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgQueryCacheLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">5000</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// ParserCache expire time temporarily reduced to 21 days (T280605)<br /></span><span style="color: #0000BB">$wgParserCacheExpireTime </span><span style="color: #007700">= </span><span style="color: #0000BB">86400 </span><span style="color: #007700">* </span><span style="color: #0000BB">21</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// Override talk pages to have 10 days only (T280605)<br /></span><span style="color: #0000BB">$wgDiscussionToolsTalkPageParserCacheExpiry </span><span style="color: #007700">= </span><span style="color: #0000BB">86400 </span><span style="color: #007700">* </span><span style="color: #0000BB">10</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Old revision parser cache expire in 1 hour<br /></span><span style="color: #0000BB">$wgOldRevisionParserCacheExpireTime </span><span style="color: #007700">= </span><span style="color: #0000BB">3600</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// This feature would vastly increase the size of the CDN cache, and increase<br />// MW appserver load.<br /></span><span style="color: #0000BB">$wgULSLanguageDetection </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/**<br /> * Configure PHP request timeouts. These should be slightly less than the Apache<br /> * timeouts, so that the slightly more informative PHP error message is<br /> * delivered to the user, and so that we can verify that PHP timeouts actually<br /> * exist (T97192).<br /> */<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">PHP_SAPI </span><span style="color: #007700">=== </span><span style="color: #DD0000">'cli' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Should always be unlimited, this is probably redundant<br />	</span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />} elseif ( </span><span style="color: #0000BB">XWikimediaDebug</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">hasOption</span><span style="color: #007700">( </span><span style="color: #DD0000">'shorttimeout' </span><span style="color: #007700">) ) {<br />	</span><span style="color: #FF8000">// To probe for excimer-related memory corruption e.g. T293568<br />	</span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">2</span><span style="color: #007700">;<br />} else {<br />	switch ( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_HOST'</span><span style="color: #007700">] ?? </span><span style="color: #DD0000">'' </span><span style="color: #007700">) {<br />		case </span><span style="color: #DD0000">'videoscaler.svc.eqiad.wmnet'</span><span style="color: #007700">:<br />		case </span><span style="color: #DD0000">'videoscaler.svc.codfw.wmnet'</span><span style="color: #007700">:<br />		case </span><span style="color: #DD0000">'videoscaler.discovery.wmnet'</span><span style="color: #007700">:<br />			</span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">86400</span><span style="color: #007700">;<br />			break;<br /><br />		case </span><span style="color: #DD0000">'jobrunner.svc.eqiad.wmnet'</span><span style="color: #007700">:<br />		case </span><span style="color: #DD0000">'jobrunner.svc.codfw.wmnet'</span><span style="color: #007700">:<br />		case </span><span style="color: #DD0000">'jobrunner.discovery.wmnet'</span><span style="color: #007700">:<br />			</span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">1200</span><span style="color: #007700">;<br />			break;<br /><br />		default:<br />			if ( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">] === </span><span style="color: #DD0000">'POST' </span><span style="color: #007700">) {<br />				</span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">200</span><span style="color: #007700">;<br />			} else {<br />				</span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">60</span><span style="color: #007700">;<br />			}<br />	}<br />}<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Account- and notifications-related settings<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgSecureLogin </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgMaxNameChars </span><span style="color: #007700">= </span><span style="color: #0000BB">85</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Turn this on so UserMailer::send() will be able to send both text and html email<br /></span><span style="color: #0000BB">$wgAllowHTMLEmail </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgEnotifUserTalk </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgEnotifWatchlist </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Keep this true; it's just whether the feature is available at all, not the default<br />// setting. T142727<br /></span><span style="color: #0000BB">$wgEnotifMinorEdits </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Anti-abuse settings<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgEnableUserEmailMuteList </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGlobalPreferences </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Allow global preferences for email-blacklist and echo-notifications<br />	// to be auto-set where it is overridden<br />	</span><span style="color: #0000BB">$wgGlobalPreferencesAutoPrefs </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'email-blacklist'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'echo-notifications-blacklist'<br />	</span><span style="color: #007700">];<br />}<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Legal matters<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgRightsIcon </span><span style="color: #007700">= </span><span style="color: #DD0000">'//creativecommons.org/images/public/somerights20.png'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># ResourceLoader settings<br /># ######################################################################<br /><br /></span><span style="color: #007700">unset( </span><span style="color: #0000BB">$wgStylePath </span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$wgInternalServer </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgCanonicalServer</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgArticlePath </span><span style="color: #007700">= </span><span style="color: #DD0000">'/wiki/$1'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgScriptPath  </span><span style="color: #007700">= </span><span style="color: #DD0000">'/w'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgScript </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wgScriptPath</span><span style="color: #007700">}</span><span style="color: #DD0000">/index.php"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgRedirectScript </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wgScriptPath</span><span style="color: #007700">}</span><span style="color: #DD0000">/redirect.php"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgLoadScript </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wgScriptPath</span><span style="color: #007700">}</span><span style="color: #DD0000">/load.php"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Don't include a hostname in $wgResourceBasePath and friends<br />// - Goes wrong otherwise on mobile web (T106966, T112646)<br />// - Improves performance by leveraging HTTP/2<br />// - $wgLocalStylePath MUST be relative<br />// Apache rewrites /w/resources, /w/extensions, and /w/skins to /w/static.php (T99096)<br /></span><span style="color: #0000BB">$wgResourceBasePath </span><span style="color: #007700">= </span><span style="color: #DD0000">'/w'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgExtensionAssetsPath </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wgResourceBasePath</span><span style="color: #007700">}</span><span style="color: #DD0000">/extensions"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgStylePath </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wgResourceBasePath</span><span style="color: #007700">}</span><span style="color: #DD0000">/skins"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgLocalStylePath </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgStylePath</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Deprecated<br /></span><span style="color: #0000BB">$wgIncludeLegacyJavaScript </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgResourceLoaderMaxQueryLength </span><span style="color: #007700">= </span><span style="color: #0000BB">5000</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Cache version key for ResourceLoader client-side module store<br />// - Bumped to fix breakage due to old /static/$branchName/ urls still<br />// being cached after the switch to /w/static.php (T134368).<br />// - Bumped to fix broken SVG embedding being cached (T176884)<br /></span><span style="color: #0000BB">$wgResourceLoaderStorageVersion </span><span style="color: #007700">.= </span><span style="color: #DD0000">'-3'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgGitInfoCacheDirectory </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/cache/gitinfo"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// @var string|bool: E-mail address to send notifications to, or false to disable notifications.<br /></span><span style="color: #0000BB">$wmgAddWikiNotify </span><span style="color: #007700">= </span><span style="color: #DD0000">"newprojects@lists.wikimedia.org"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgLocalisationCacheConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'storeClass'</span><span style="color: #007700">] = </span><span style="color: #0000BB">LCStoreCDB</span><span style="color: #007700">::class;<br /></span><span style="color: #0000BB">$wgLocalisationCacheConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'storeDirectory'</span><span style="color: #007700">] = </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/cache/l10n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgLocalisationCacheConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'manualRecache'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Add some useful config data to query=siteinfo<br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'APIQuerySiteInfoGeneralInfo'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$module</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$data </span><span style="color: #007700">) {<br />	global </span><span style="color: #0000BB">$wmgMasterDatacenter</span><span style="color: #007700">;<br />	global </span><span style="color: #0000BB">$wmgEtcdLastModifiedIndex</span><span style="color: #007700">;<br />	global </span><span style="color: #0000BB">$wmgCirrusSearchDefaultCluster</span><span style="color: #007700">;<br />	global </span><span style="color: #0000BB">$wgCirrusSearchDefaultCluster</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$data</span><span style="color: #007700">[</span><span style="color: #DD0000">'wmf-config'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'wmfMasterDatacenter' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgMasterDatacenter</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wmfEtcdLastModifiedIndex' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgEtcdLastModifiedIndex</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wmgCirrusSearchDefaultCluster' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgCirrusSearchDefaultCluster</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wgCirrusSearchDefaultCluster' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgCirrusSearchDefaultCluster</span><span style="color: #007700">,<br />	];<br />};<br /><br /></span><span style="color: #0000BB">$wgEmergencyContact </span><span style="color: #007700">= </span><span style="color: #DD0000">'noc@wikipedia.org'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgShowIPinHeader </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgRCMaxAge </span><span style="color: #007700">= </span><span style="color: #0000BB">30 </span><span style="color: #007700">* </span><span style="color: #0000BB">86400</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgTmpDirectory </span><span style="color: #007700">= </span><span style="color: #DD0000">'/tmp'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Object cache and session settings<br /><br /></span><span style="color: #0000BB">$wgSessionName </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">. </span><span style="color: #DD0000">'Session'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$pcServers </span><span style="color: #007700">= [];<br />foreach ( </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'parsercache-dbs'</span><span style="color: #007700">] as </span><span style="color: #0000BB">$tag </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$host </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$pcServers</span><span style="color: #007700">[</span><span style="color: #0000BB">$tag</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mysql'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$host</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'dbname' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'parsercache'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'user' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgDBuser</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'password' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgDBpassword</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'flags' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0</span><span style="color: #007700">,<br />	];<br />}<br /><br /></span><span style="color: #0000BB">$wgObjectCaches</span><span style="color: #007700">[</span><span style="color: #DD0000">'mysql-multiwrite'</span><span style="color: #007700">] = [<br />	</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'MultiWriteBagOStuff'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'caches' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #0000BB">0 </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'factory' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'ObjectCache'</span><span style="color: #007700">, </span><span style="color: #DD0000">'getInstance' </span><span style="color: #007700">],<br />			</span><span style="color: #DD0000">'args' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'mcrouter-with-onhost-tier' </span><span style="color: #007700">]<br />		],<br />		</span><span style="color: #0000BB">1 </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'SqlBagOStuff'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'servers' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$pcServers</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'purgePeriod' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'tableName' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'pc'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'shards' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">256</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'reportDupes' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false<br />		</span><span style="color: #007700">],<br />	],<br />	</span><span style="color: #DD0000">'replication' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'async'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'reportDupes' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false<br /></span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$wgObjectCaches</span><span style="color: #007700">[</span><span style="color: #DD0000">'kask-session'</span><span style="color: #007700">] = [<br />	</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'RESTBagOStuff'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'sessionstore'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/sessions/v1/"</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'httpParams' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #DD0000">'writeHeaders' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'content-type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'application/octet-stream'</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'writeMethod' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'POST'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'serialization_type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'PHP'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'hmac_key' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSessionStoreHMACKey</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'extendedErrorBodyFields' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'type'</span><span style="color: #007700">, </span><span style="color: #DD0000">'title'</span><span style="color: #007700">, </span><span style="color: #DD0000">'detail'</span><span style="color: #007700">, </span><span style="color: #DD0000">'instance' </span><span style="color: #007700">]<br />];<br /></span><span style="color: #0000BB">$wgObjectCaches</span><span style="color: #007700">[</span><span style="color: #DD0000">'kask-echoseen'</span><span style="color: #007700">] = [<br />	</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'RESTBagOStuff'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'echostore'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/echoseen/v1/"</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'httpParams' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #DD0000">'writeHeaders' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'content-type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'application/octet-stream'</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'writeMethod' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'POST'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'serialization_type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'JSON'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'extendedErrorBodyFields' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'type'</span><span style="color: #007700">, </span><span style="color: #DD0000">'title'</span><span style="color: #007700">, </span><span style="color: #DD0000">'detail'</span><span style="color: #007700">, </span><span style="color: #DD0000">'instance' </span><span style="color: #007700">],<br />	</span><span style="color: #DD0000">'reportDupes' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />];<br /><br /></span><span style="color: #0000BB">session_name</span><span style="color: #007700">( </span><span style="color: #0000BB">$lang </span><span style="color: #007700">. </span><span style="color: #DD0000">'wikiSession' </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Use PBKDF2 for password hashing (T70766)<br /></span><span style="color: #0000BB">$wgPasswordDefault </span><span style="color: #007700">= </span><span style="color: #DD0000">'pbkdf2'</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// This needs to be increased as allowable by server performance<br /></span><span style="color: #0000BB">$wgPasswordConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'pbkdf2'</span><span style="color: #007700">] = [<br />	</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Pbkdf2Password'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'algo' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'sha512'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'cost' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'128000'</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'length' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'64'</span><span style="color: #007700">,<br />];<br /><br /></span><span style="color: #FF8000">// Temporary for T57420<br /></span><span style="color: #0000BB">$wgPasswordConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'null'</span><span style="color: #007700">] = [ </span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">InvalidPassword</span><span style="color: #007700">::class ];<br /><br /></span><span style="color: #FF8000">// Password policies; see https://meta.wikimedia.org/wiki/Password_policy<br />//<br />// For global policies, see $wgCentralAuthGlobalPasswordPolicies below<br /></span><span style="color: #0000BB">$wmgPrivilegedPolicy </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'MinimalPasswordLength' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">10</span><span style="color: #007700">, </span><span style="color: #DD0000">'suggestChangeOnLogin' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #DD0000">'forceChange' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true </span><span style="color: #007700">],<br />	</span><span style="color: #FF8000">// With MinimumPasswordLengthToLogin, if the length of the password is &lt;= the value<br />	// of the policy, the user will be forced to use Special:PasswordReset or similar<br />	// to be able to get into their account<br />	</span><span style="color: #DD0000">'MinimumPasswordLengthToLogin' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1 </span><span style="color: #007700">],<br />	</span><span style="color: #DD0000">'PasswordNotInCommonList' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #DD0000">'suggestChangeOnLogin' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true </span><span style="color: #007700">],<br />];<br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labswiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgPasswordPolicy</span><span style="color: #007700">[</span><span style="color: #DD0000">'policies'</span><span style="color: #007700">][</span><span style="color: #DD0000">'default'</span><span style="color: #007700">][</span><span style="color: #DD0000">'MinimalPasswordLength'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">10</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'suggestChangeOnLogin' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'forceChange' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	];<br />} else {<br />	foreach ( </span><span style="color: #0000BB">$wmgPrivilegedGroups </span><span style="color: #007700">as </span><span style="color: #0000BB">$group </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// On non-SUL wikis this is the effective password policy. On SUL wikis, it will be overridden<br />		// in the PasswordPoliciesForUser hook, but still needed for Special:PasswordPolicies<br />		</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$group </span><span style="color: #007700">=== </span><span style="color: #DD0000">'user' </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$group </span><span style="color: #007700">= </span><span style="color: #DD0000">'default'</span><span style="color: #007700">; </span><span style="color: #FF8000">// For e.g. private and fishbowl wikis; covers 'user' in password policies<br />		</span><span style="color: #007700">}<br />		</span><span style="color: #0000BB">$wgPasswordPolicy</span><span style="color: #007700">[</span><span style="color: #DD0000">'policies'</span><span style="color: #007700">][</span><span style="color: #0000BB">$group</span><span style="color: #007700">] = </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgPasswordPolicy</span><span style="color: #007700">[</span><span style="color: #DD0000">'policies'</span><span style="color: #007700">][</span><span style="color: #0000BB">$group</span><span style="color: #007700">] ?? [],<br />			</span><span style="color: #0000BB">$wmgPrivilegedPolicy </span><span style="color: #007700">);<br />	}<br />}<br /><br /></span><span style="color: #0000BB">$wgPasswordPolicy</span><span style="color: #007700">[</span><span style="color: #DD0000">'policies'</span><span style="color: #007700">][</span><span style="color: #DD0000">'default'</span><span style="color: #007700">][</span><span style="color: #DD0000">'MinimalPasswordLength'</span><span style="color: #007700">] = [<br />	</span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">8</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'suggestChangeOnLogin' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />];<br /><br /></span><span style="color: #0000BB">$wgPasswordPolicy</span><span style="color: #007700">[</span><span style="color: #DD0000">'policies'</span><span style="color: #007700">][</span><span style="color: #DD0000">'default'</span><span style="color: #007700">][</span><span style="color: #DD0000">'PasswordNotInCommonList'</span><span style="color: #007700">] = [<br />	</span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'suggestChangeOnLogin' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />];<br /><br /></span><span style="color: #FF8000">// Enforce password policy when users login on other wikis; also for sensitive global groups<br />// FIXME does this just duplicate the global policy checks down in the main $wmgUseCentralAuth block?<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'PasswordPoliciesForUser'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">User $user</span><span style="color: #007700">, array &amp;</span><span style="color: #0000BB">$effectivePolicy </span><span style="color: #007700">) use ( </span><span style="color: #0000BB">$wmgPrivilegedPolicy </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$privilegedGroups </span><span style="color: #007700">= </span><span style="color: #0000BB">wmfGetPrivilegedGroups</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">);<br />		if ( </span><span style="color: #0000BB">$privilegedGroups </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$effectivePolicy </span><span style="color: #007700">= </span><span style="color: #0000BB">UserPasswordPolicy</span><span style="color: #007700">::</span><span style="color: #0000BB">maxOfPolicies</span><span style="color: #007700">( </span><span style="color: #0000BB">$effectivePolicy</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgPrivilegedPolicy </span><span style="color: #007700">);<br /><br />			if ( </span><span style="color: #0000BB">in_array</span><span style="color: #007700">( </span><span style="color: #DD0000">'staff'</span><span style="color: #007700">, </span><span style="color: #0000BB">$privilegedGroups</span><span style="color: #007700">, </span><span style="color: #0000BB">true </span><span style="color: #007700">) ) {<br />				</span><span style="color: #0000BB">$effectivePolicy</span><span style="color: #007700">[</span><span style="color: #DD0000">'MinimumPasswordLengthToLogin'</span><span style="color: #007700">] = [<br />					</span><span style="color: #DD0000">'value' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">10</span><span style="color: #007700">,<br />				];<br />			}<br />		}<br />		return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgDisableAccountCreation </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'*'</span><span style="color: #007700">][</span><span style="color: #DD0000">'createaccount'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'*'</span><span style="color: #007700">][</span><span style="color: #DD0000">'autocreateaccount'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Server security settings<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgShellRestrictionMethod </span><span style="color: #007700">= </span><span style="color: #DD0000">'firejail'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgUseImageMagick			   </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgImageMagickConvertCommand	</span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/local/bin/mediawiki-firejail-convert'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgSharpenParameter </span><span style="color: #007700">= </span><span style="color: #DD0000">'0x0.8'</span><span style="color: #007700">; </span><span style="color: #FF8000"># for IM&gt;6.5, T26857<br /><br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUsePagedTiffHandler </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'PagedTiffHandler' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTiffUseTiffinfo </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTiffMaxMetaSize </span><span style="color: #007700">= </span><span style="color: #0000BB">1048576</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wmgUsePagedTiffHandlerShellbox </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-media'</span><span style="color: #007700">] ) {<br />		</span><span style="color: #FF8000">// Route pagedtiffhandler to the Shellbox named "shellbox-media".<br />		</span><span style="color: #0000BB">$wgShellboxUrls</span><span style="color: #007700">[</span><span style="color: #DD0000">'pagedtiffhandler'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-media'</span><span style="color: #007700">];<br />		</span><span style="color: #FF8000">// $wgShellboxSecretKey set in PrivateSettings.php<br />	</span><span style="color: #007700">}<br />}<br /><br /></span><span style="color: #FF8000">// Disable $wgMaxImageArea checks, Thumbor uses a timeout instead<br />// of a size limit (T291014#7367570)<br /></span><span style="color: #0000BB">$wgMaxImageArea </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgMaxAnimatedGifArea </span><span style="color: #007700">= </span><span style="color: #0000BB">10e7</span><span style="color: #007700">; </span><span style="color: #FF8000">// 100MP<br /><br /></span><span style="color: #0000BB">$wgFileExtensions </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgFileExtensions </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgProhibitedFileExtensions </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgProhibitedFileExtensions</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgProhibitedFileExtensions </span><span style="color: #007700">);<br /><br />if ( isset( </span><span style="color: #0000BB">$wmgUploadStashMaxAge </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgUploadStashMaxAge </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgUploadStashMaxAge</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgPrivateWikiUploads </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000"># mav forced me to --midom<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'ppt'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># mav forced me as well!!! -- Tim<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'doc'</span><span style="color: #007700">;<br />	</span><span style="color: #FF8000"># adding since removed elsewhere now -- 2007-08-21 -- brion<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'xls'</span><span style="color: #007700">;<br />	</span><span style="color: #FF8000"># delphine made me do it!!!!! --brion<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'eps'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'zip'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># OpenOffice, hell if we're going to allow doc we may as well have these too -- Tim<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'odf'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'odp'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'ods'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'odt'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'odg'</span><span style="color: #007700">; </span><span style="color: #FF8000">// OpenOffice Graphics<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'ott'</span><span style="color: #007700">; </span><span style="color: #FF8000">// Templates<br /><br />	# Temporary for office work :P<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'wmv'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'dv'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'avi'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'mov'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'aif'</span><span style="color: #007700">; </span><span style="color: #FF8000">// "<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'aiff'</span><span style="color: #007700">; </span><span style="color: #FF8000">// "<br /><br />	# Because I hate having to find print drivers -- tomasz<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'ppd'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># InDesign &amp; PhotoShop, Illustrator wanted for Chapters logo work<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'indd'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'inx'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'psd'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'ai'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># Pete made me --Roan<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'omniplan'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># Dia Diagrams files --fred.<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'dia'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># Font files (so we can upload Montserrat to donatewiki) --Roan<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'woff'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'woff2'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// To allow OpenOffice doc formats we need to not exclude zip files<br />	</span><span style="color: #0000BB">$wgMimeTypeExclusions </span><span style="color: #007700">= </span><span style="color: #0000BB">array_diff</span><span style="color: #007700">(<br />		</span><span style="color: #0000BB">$wgMimeTypeExclusions</span><span style="color: #007700">,<br />		[ </span><span style="color: #DD0000">'application/zip' </span><span style="color: #007700">]<br />	);<br />}<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># SVG renderer settings<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgSVGConverter </span><span style="color: #007700">= </span><span style="color: #DD0000">'rsvg-secure'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgSVGConverterPath </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgSVGMaxSize </span><span style="color: #007700">= </span><span style="color: #0000BB">4096</span><span style="color: #007700">; </span><span style="color: #FF8000">// 1024's a bit low?<br /><br /># Hack for rsvg broken by security patch<br /></span><span style="color: #0000BB">$wgSVGConverters</span><span style="color: #007700">[</span><span style="color: #DD0000">'rsvg-broken'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'$path/rsvg-convert -w $width -h $height -o $output &lt; $input'</span><span style="color: #007700">;<br /></span><span style="color: #FF8000"># This converter will only work when rsvg has a suitable security patch<br /></span><span style="color: #0000BB">$wgSVGConverters</span><span style="color: #007700">[</span><span style="color: #DD0000">'rsvg-secure'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'$path/rsvg-convert --no-external-files -w $width -h $height -o $output $input'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># DJVU renderer settings<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgDjvuDump </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/djvudump'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgDjvuRenderer </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/ddjvu'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgDjvuTxt </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/djvutxt'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Reverse proxy Configuration<br /># ######################################################################<br /><br /></span><span style="color: #0000BB">$wgStatsdServer </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'statsd'</span><span style="color: #007700">];<br /><br /></span><span style="color: #0000BB">$wgUseCdn </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'production' </span><span style="color: #007700">) {<br />	require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/reverse-proxy.php'</span><span style="color: #007700">;<br />} elseif ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgStatsdMetricPrefix </span><span style="color: #007700">= </span><span style="color: #DD0000">'BetaMediaWiki'</span><span style="color: #007700">;<br />	require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/reverse-proxy-staging.php'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// CORS (cross-domain AJAX, T22814)<br />// This lists the domains that are accepted as *origins* of CORS requests<br />// DO NOT add domains here that aren't WMF wikis unless you really know what you're doing<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCORS </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgCrossSiteAJAXdomains </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'*.wikipedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikinews.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wiktionary.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikibooks.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikiversity.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikisource.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikisource.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikiquote.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'www.wikidata.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'m.wikidata.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'test.wikidata.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'test.m.wikidata.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikivoyage.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'www.mediawiki.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'m.mediawiki.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'advisory.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'advisory.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'affcom.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'api.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'auditcom.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'boardgovcom.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'board.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'chair.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'checkuser.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'checkuser.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'collab.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'commons.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'commons.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'test-commons.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'test-commons.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'donate.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'exec.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'foundation.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'foundation.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'grants.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'incubator.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'incubator.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'internal.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'login.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'meta.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'meta.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'movementroles.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'office.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'office.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'outreach.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'outreach.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'quality.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'quality.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'searchcom.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'spcom.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'species.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'species.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'steward.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'steward.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'strategy.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'strategy.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'usability.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'usability.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'vrt-wiki.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'vrt-wiki.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikimania.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikimania.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikimania????.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikimania????.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikimaniateam.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wikimaniateam.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'am.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'am.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ar.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ar.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'bd.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'bd.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'be.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'be.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'br.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'br.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ca.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ca.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'cn.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'cn.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'co.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'co.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'dk.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'dk.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ec.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ec.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ee.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ee.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'et.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'et.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'fi.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'fi.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ge.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ge.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'hi.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'hi.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'id.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'id.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'il.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'il.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mai.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mai.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mk.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mk.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mx.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mx.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nl.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nl.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'noboard-chapters.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'no.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'no.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nyc.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nyc.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nz.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nz.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'punjabi.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'punjabi.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'pa-us.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'pa-us.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'pl.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'pl.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'pt.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'pt.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'romd.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'romd.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'rs.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'rs.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ru.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ru.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'se.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'se.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'tr.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'tr.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ua.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ua.m.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wb.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wb.m.wikimedia.org'</span><span style="color: #007700">,<br />	];<br />}<br /><br /></span><span style="color: #0000BB">wfLoadSkins</span><span style="color: #007700">( [ </span><span style="color: #DD0000">'Vector'</span><span style="color: #007700">, </span><span style="color: #DD0000">'MonoBook'</span><span style="color: #007700">, </span><span style="color: #DD0000">'Modern'</span><span style="color: #007700">, </span><span style="color: #DD0000">'CologneBlue'</span><span style="color: #007700">, </span><span style="color: #DD0000">'Timeless' </span><span style="color: #007700">] );<br /><br /></span><span style="color: #FF8000">// Grants and rights<br />// Note these have to be visible on all wikis, not just the ones the<br />// extension is enabled on, for proper display in OAuth pages and such.<br /><br />// Adding Flaggedrevs rights so that they are available for globalgroups/staff rights - JRA 2013-07-22<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'autoreview'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'autoreviewrestore'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'movestable'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'review'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'stablesettings'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'unreviewedpages'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'validate'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'movestable'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Enable GWToolset's right<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'gwtoolset'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// So that protection rights can be assigned to global groups<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'templateeditor'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'editeditorprotected'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'editextendedsemiprotected'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'extendedconfirmed'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'editautoreviewprotected'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'editautopatrolprotected'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'edittrustedprotected'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'templateeditor'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editeditorprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editextendedsemiprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'extendedconfirmed'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editautoreviewprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editautopatrolprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'edittrustedprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editprotected'</span><span style="color: #007700">][</span><span style="color: #DD0000">'edit-legal'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Adding Flow's rights so that they are available for global groups/staff rights<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'flow-create-board'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'flow-edit-post'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'flow-suppress'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'flow-hide'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'flow-delete'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Adding GrowthExperiments's rights<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'setmentor'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Checkuser<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'checkuser'</span><span style="color: #007700">][</span><span style="color: #DD0000">'checkuser'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'checkuser'</span><span style="color: #007700">][</span><span style="color: #DD0000">'checkuser-log'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #FF8000">// Categorize additional groups defined above.<br />// Corresponding messages are mwoauth-grant-* in WikimediaMessages.<br /></span><span style="color: #0000BB">$wgGrantPermissionGroups</span><span style="color: #007700">[</span><span style="color: #DD0000">'checkuser'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'administration'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Rights needed to interact with wikibase<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'createeditmovepage'</span><span style="color: #007700">][</span><span style="color: #DD0000">'property-create'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editpage'</span><span style="color: #007700">][</span><span style="color: #DD0000">'item-term'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editpage'</span><span style="color: #007700">][</span><span style="color: #DD0000">'item-merge'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editpage'</span><span style="color: #007700">][</span><span style="color: #DD0000">'property-term'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGrantPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'editpage'</span><span style="color: #007700">][</span><span style="color: #DD0000">'item-redirect'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Extension:Newsletter, so that they are available for global groups --MA 2017.09.09<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'newsletter-create'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'newsletter-delete'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'newsletter-manage'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'newsletter-restore'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Enable a "viewdeletedfile" userright for [[m:Global deleted image review]] (T16801)<br /></span><span style="color: #0000BB">$wgAvailableRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'viewdeletedfile'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'TitleQuickPermissions'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">Title $title</span><span style="color: #007700">, </span><span style="color: #0000BB">User $user</span><span style="color: #007700">, </span><span style="color: #0000BB">$action</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$errors</span><span style="color: #007700">, </span><span style="color: #0000BB">$doExpensiveQueries</span><span style="color: #007700">, </span><span style="color: #0000BB">$short </span><span style="color: #007700">) {<br />	return ( !</span><span style="color: #0000BB">in_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$action</span><span style="color: #007700">, [ </span><span style="color: #DD0000">'deletedhistory'</span><span style="color: #007700">, </span><span style="color: #DD0000">'deletedtext' </span><span style="color: #007700">] ) || !</span><span style="color: #0000BB">$title</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">inNamespaces</span><span style="color: #007700">( </span><span style="color: #0000BB">NS_FILE</span><span style="color: #007700">, </span><span style="color: #0000BB">NS_FILE_TALK </span><span style="color: #007700">) || !</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isAllowed</span><span style="color: #007700">( </span><span style="color: #DD0000">'viewdeletedfile' </span><span style="color: #007700">) );<br />};<br /><br /></span><span style="color: #FF8000">// Assign "editautopatrolprotected" to sysops and bots, if autopatroller restriction level is enabled<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">in_array</span><span style="color: #007700">( </span><span style="color: #DD0000">'editautopatrolprotected'</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgRestrictionLevels </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editautopatrolprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'bot'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editautopatrolprotected'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># ######################################################################<br /># Logo settings<br /># ######################################################################<br /><br />// Pieced together so that wikis can inherit their logo from their project/default<br /></span><span style="color: #007700">if ( isset( </span><span style="color: #0000BB">$wmgSiteLogo1x </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgLogos </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'1x' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogo1x </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'1.5x' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogo1_5x </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'2x' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogo2x </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'icon' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogoIcon </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'wordmark' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogoWordmark </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'tagline' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogoTagline </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'variants' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgSiteLogoVariants </span><span style="color: #007700">?? </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />	];<br />}<br /><br /></span><span style="color: #FF8000">// Max width modifications<br /></span><span style="color: #0000BB">$wgVectorMaxWidthOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'exclude'</span><span style="color: #007700">][</span><span style="color: #DD0000">'namespaces'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgVectorMaxWidthOptionsNamespaces</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTimeline </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'timeline' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTimelineFontDirectory </span><span style="color: #007700">= </span><span style="color: #DD0000">'/srv/mediawiki/fonts'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTimelineFileBackend </span><span style="color: #007700">= </span><span style="color: #DD0000">'local-multiwrite'</span><span style="color: #007700">;<br />	</span><span style="color: #FF8000">// Filenames in Shellbox container with no .ttf suffix<br />	</span><span style="color: #0000BB">$wgTimelineFonts </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'freesans' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'/srv/app/fonts/FreeSans'</span><span style="color: #007700">,<br />		</span><span style="color: #FF8000">// FreeSansWMF has been generated from FreeSans and FreeSerif by using this script with fontforge:<br />		// Open("FreeSans.ttf");<br />		// MergeFonts("FreeSerif.ttf");<br />		// SetFontNames("FreeSans-WMF", "FreeSans WMF", "FreeSans WMF Regular", "Regular", "");<br />		// Generate("FreeSansWMF.ttf", "", 4 );<br />		</span><span style="color: #DD0000">'freesanswmf' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'/srv/app/fonts/FreeSansWMF'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'unifont' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'/srv/app/fonts/unifont'<br />		</span><span style="color: #FF8000">// TODO: add noto fonts<br />	</span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wgTimelineFonts</span><span style="color: #007700">[</span><span style="color: #DD0000">'default'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wgTimelineFonts</span><span style="color: #007700">[</span><span style="color: #0000BB">$wmgTimelineDefaultFont</span><span style="color: #007700">];<br />	</span><span style="color: #FF8000">// Route easytimeline to the Shellbox named "shellbox-timeline".<br />	</span><span style="color: #0000BB">$wgShellboxUrls</span><span style="color: #007700">[</span><span style="color: #DD0000">'easytimeline'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-timeline'</span><span style="color: #007700">];<br />}<br /><br /></span><span style="color: #FF8000">// TODO: This should be handled by LocalServices, not here.<br /></span><span style="color: #0000BB">$wgCopyUploadProxy </span><span style="color: #007700">= ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">!== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) ? </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'urldownloader'</span><span style="color: #007700">] : </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgUploadThumbnailRenderHttpCustomHost </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'upload'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$wgUploadThumbnailRenderHttpCustomDomain </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'upload'</span><span style="color: #007700">];<br />if ( </span><span style="color: #0000BB">$wmgUseLocalHTTPProxy </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUsingKubernetes </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgLocalHTTPProxy </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'mwapi'</span><span style="color: #007700">] ?? </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikiHiero </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'wikihiero' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SiteMatrix' </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Config for sitematrix<br /></span><span style="color: #0000BB">$wgSiteMatrixFile </span><span style="color: #007700">= ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) ? </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/../langlist-labs" </span><span style="color: #007700">: </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/../langlist"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgSiteMatrixSites </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'wiki' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikipedia'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikipedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'w'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wiktionary' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wiktionary'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wiktionary.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'wikt'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wikibooks' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikibooks'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikibooks.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'b'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wikinews' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikinews'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikinews.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'n'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wikiquote' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikiquote'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikiquote.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'q'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wikisource' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikisource'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikisource.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'s'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wikiversity' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikiversity'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikiversity.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'v'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'wikivoyage' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikivoyage'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'www.wikivoyage.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'voy'</span><span style="color: #007700">,<br />	],<br />];<br /><br /></span><span style="color: #0000BB">$wgSiteMatrixClosedSites </span><span style="color: #007700">= </span><span style="color: #0000BB">MWWikiversions</span><span style="color: #007700">::</span><span style="color: #0000BB">readDbListFile</span><span style="color: #007700">( </span><span style="color: #DD0000">'closed' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgSiteMatrixPrivateSites </span><span style="color: #007700">= </span><span style="color: #0000BB">MWWikiversions</span><span style="color: #007700">::</span><span style="color: #0000BB">readDbListFile</span><span style="color: #007700">( </span><span style="color: #DD0000">'private' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgSiteMatrixFishbowlSites </span><span style="color: #007700">= </span><span style="color: #0000BB">MWWikiversions</span><span style="color: #007700">::</span><span style="color: #0000BB">readDbListFile</span><span style="color: #007700">( </span><span style="color: #DD0000">'fishbowl' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgSiteMatrixNonGlobalSites </span><span style="color: #007700">= </span><span style="color: #0000BB">MWWikiversions</span><span style="color: #007700">::</span><span style="color: #0000BB">readDbListFile</span><span style="color: #007700">( </span><span style="color: #DD0000">'nonglobal' </span><span style="color: #007700">);<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCharInsert </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CharInsert' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseParserFunctions </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ParserFunctions' </span><span style="color: #007700">);<br />}<br /></span><span style="color: #0000BB">$wgExpensiveParserFunctionLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">500</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCite </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Cite' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCiteThisPage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CiteThisPage' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseInputBox </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'InputBox' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseImageMap </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ImageMap' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSyntaxHighlight </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SyntaxHighlight_GeSHi' </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">$wmgUseSyntaxHighlightShellbox </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-syntaxhighlight'</span><span style="color: #007700">] ) {<br />		</span><span style="color: #FF8000">// Route syntaxhighlight to the Shellbox named "shellbox-syntaxhighlight".<br />		</span><span style="color: #0000BB">$wgShellboxUrls</span><span style="color: #007700">[</span><span style="color: #DD0000">'syntaxhighlight'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-syntaxhighlight'</span><span style="color: #007700">];<br />		</span><span style="color: #FF8000">// $wgShellboxSecretKey set in PrivateSettings.php<br />		</span><span style="color: #0000BB">$wgPygmentizePath </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/pygmentize'</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseDoubleWiki </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'DoubleWiki' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUsePoem </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Poem' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// Per-wiki config for Flagged Revisions<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseFlaggedRevs </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Include load of extension, and its config.<br />	</span><span style="color: #007700">include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/flaggedrevs.php'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCategoryTree </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CategoryTree' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseProofreadPage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ProofreadPage' </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'dewikisource' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'*'</span><span style="color: #007700">][</span><span style="color: #DD0000">'pagequality'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000"># 27516<br />	</span><span style="color: #007700">}<br /><br />	if ( </span><span style="color: #0000BB">$wmgProofreadPageShowHeaders </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'proofreadpage-showheaders'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Wikisource requires special handling.<br />	// See T300563#7665461 and T74525<br />	</span><span style="color: #0000BB">$wgVectorMaxWidthOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'exclude'</span><span style="color: #007700">][</span><span style="color: #DD0000">'namespaces'</span><span style="color: #007700">][] = </span><span style="color: #0000BB">$wgProofreadPageNamespaceIds</span><span style="color: #007700">[</span><span style="color: #DD0000">'page'</span><span style="color: #007700">];<br /><br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseLabeledSectionTransclusion </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'LabeledSectionTransclusion' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSpamBlacklist </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SpamBlacklist' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgBlacklistSettings </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'email' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'files' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'https://meta.wikimedia.org/w/index.php?title=Email_blacklist&amp;action=raw&amp;sb_ver=1'<br />			</span><span style="color: #007700">],<br />		],<br />		</span><span style="color: #DD0000">'spam' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'files' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'https://meta.wikimedia.org/w/index.php?title=Spam_blacklist&amp;action=raw&amp;sb_ver=1'<br />			</span><span style="color: #007700">],<br />		],<br />	];<br />	</span><span style="color: #0000BB">$wgLogSpamBlacklistHits </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TitleBlacklist' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgTitleBlacklistBlockAutoAccountCreation </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGlobalTitleBlacklist </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgTitleBlacklistSources </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'meta' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'url'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'src'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"https://meta.wikimedia.org/w/index.php?title=Title_blacklist&amp;action=raw&amp;tb_ver=1"</span><span style="color: #007700">,<br />		],<br />	];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseQuiz </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Quiz' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGadgets </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Gadgets' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTimedMediaHandler </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TimedMediaHandler' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgTimedTextForeignNamespaces </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">102 </span><span style="color: #007700">];<br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgTimedTextNS </span><span style="color: #007700">= </span><span style="color: #0000BB">102</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #FF8000">// overwrite enabling of local TimedText namespace<br />	</span><span style="color: #0000BB">$wgEnableLocalTimedText </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgEnableLocalTimedText</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// enable transcoding on all wikis that allow uploads<br />	</span><span style="color: #0000BB">$wgEnableTranscode </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgEnableUploads</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgEnabledTranscodeSet </span><span style="color: #007700">= [<br />		</span><span style="color: #FF8000">// Keep the old WebM VP8 flat-file transcodes enabled<br />		// while we transition, or playback of un-upgraded files<br />		// will revert to original high-res sources.<br />		// Disable them again once T200747 batch process complete.<br />		</span><span style="color: #DD0000">'160p.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'240p.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'360p.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'480p.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'720p.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'1080p.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br /><br />		</span><span style="color: #FF8000">// Enable the WebM VP9 flat-file transcodes<br />		</span><span style="color: #DD0000">'120p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'180p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'240p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'360p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'480p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'720p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'1080p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'1440p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'2160p.vp9.webm' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #0000BB">$wgOggThumbLocation </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">; </span><span style="color: #FF8000">// use ffmpeg for performance<br /><br />	// tmh1/2 have 12 cores and need lots of shared memory<br />	// for ffmpeg, which mmaps large input files<br />	</span><span style="color: #0000BB">$wgTranscodeBackgroundMemoryLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">4 </span><span style="color: #007700">* </span><span style="color: #0000BB">1024 </span><span style="color: #007700">* </span><span style="color: #0000BB">1024</span><span style="color: #007700">; </span><span style="color: #FF8000">// 4GB<br /><br />	// This allows using 2x the threads for VP9 encoding, but will<br />	// fail if running a too-old ffmpeg version.<br />	</span><span style="color: #0000BB">$wgFFmpegVP9RowMT </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// VP9 encoding benefits from more threads; up to 4 for HD or<br />	// 8 when using row-based multithreading.<br />	//<br />	// Note compression of second pass is "spiky", alternating between<br />	// single-threaded and multithreaded portions, so you can somewhat<br />	// overcommit process threads per CPU thread.<br />	</span><span style="color: #0000BB">$wgFFmpegThreads </span><span style="color: #007700">= </span><span style="color: #0000BB">8</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// HD transcodes of full-length films/docs/conference vids can<br />	// take several hours, and sometimes over 12. Bump up from default<br />	// 8 hour limit to 16 to avoid wasting the time we've already spent<br />	// when breaking these off.<br />	// Then double that for VP9, which is more intense on the CPU.<br />	</span><span style="color: #0000BB">$wgTranscodeBackgroundTimeLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">32 </span><span style="color: #007700">* </span><span style="color: #0000BB">3600</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// ffmpeg tends to use about 175% CPU when dual-threaded, so hits<br />	// say an 8-hour ulimit in 4-6 hours. This tends to cut<br />	// off very large files at very high resolution just before<br />	// they finish, wasting a lot of time.<br />	// Pad it back out so we don't waste that CPU time with a fail!<br />	</span><span style="color: #0000BB">$wgTranscodeBackgroundTimeLimit </span><span style="color: #007700">*= </span><span style="color: #0000BB">$wgFFmpegThreads</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Minimum size for an embed video player<br />	</span><span style="color: #0000BB">$wgMinimumVideoPlayerSize </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgMinimumVideoPlayerSize</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// use new ffmpeg build w/ VP9 &amp; Opus support<br />	</span><span style="color: #0000BB">$wgFFmpegLocation </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/ffmpeg'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// For MIDI to Ogg/MP3 conversion:<br />	// add Debian paths for fluidsynth and the sound font to use<br />	</span><span style="color: #0000BB">$wgTmhFluidsynthLocation </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/fluidsynth'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTmhSoundfontLocation </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/share/sounds/sf2/FluidR3_GM.sf2'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// The type of HTML5 player to use<br />	</span><span style="color: #0000BB">$wgTmhWebPlayer </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgTmhWebPlayer</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseUploadsLink </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'UploadsLink' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// Set default search experience to MediaSearch (T297484)<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseMediaSearch </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'search-special-page'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'MediaSearch'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseUrlShortener </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'UrlShortener' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgUrlShortenerTemplate </span><span style="color: #007700">= </span><span style="color: #DD0000">'/$1'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgUrlShortenerServer </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://w.wiki'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgUrlShortenerDBCluster </span><span style="color: #007700">= </span><span style="color: #DD0000">'extension1'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgUrlShortenerDBName </span><span style="color: #007700">= </span><span style="color: #DD0000">'wikishared'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgUrlShortenerAllowedDomains </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'(.*\.)?wikipedia\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wiktionary\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikibooks\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikinews\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikiquote\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikisource\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikiversity\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikivoyage\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikimedia\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikidata\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?wikifunctions\.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'(.*\.)?mediawiki\.org'</span><span style="color: #007700">,<br />	];<br />	</span><span style="color: #0000BB">$wgUrlShortenerApprovedDomains </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'*.wikipedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wiktionary.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikibooks.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikinews.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikiquote.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikisource.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikiversity.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikivoyage.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikimedia.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikidata.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.wikifunctions.org'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'*.mediawiki.org'</span><span style="color: #007700">,<br />	];<br />	</span><span style="color: #0000BB">$wgUrlShortenerEnableSidebar </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'urlshortener-manage-url'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'urlshortener-view-log'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Never ever change this config<br />	// Changing it would change target of all short urls<br />	</span><span style="color: #0000BB">$wgUrlShortenerIdSet </span><span style="color: #007700">= </span><span style="color: #DD0000">'23456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz$'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgPFEnableStringFunctions </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgPFEnableStringFunctions </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'mediawikiwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ExtensionDistributor' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgExtDistAPIConfig </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">GerritExtDistProvider</span><span style="color: #007700">::class,<br />		</span><span style="color: #DD0000">'apiUrl' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://gerrit.wikimedia.org/r/projects/mediawiki%2F$TYPE%2F$EXT/branches'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'tarballUrl' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://extdist.wmflabs.org/dist/$TYPE/$EXT-$REF-$SHA.tar.gz'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'tarballName' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'$EXT-$REF-$SHA.tar.gz'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'repoListUrl' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://gerrit.wikimedia.org/r/projects/?b=master&amp;p=mediawiki/$TYPE/'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'sourceUrl' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://gerrit.wikimedia.org/r/mediawiki/$TYPE/$EXT.git'</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #FF8000">// Current stable release<br />	</span><span style="color: #0000BB">$wgExtDistDefaultSnapshot </span><span style="color: #007700">= </span><span style="color: #DD0000">'REL1_37'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Current development snapshot<br />	</span><span style="color: #0000BB">$wgExtDistCandidateSnapshot </span><span style="color: #007700">= </span><span style="color: #DD0000">'REL1_38'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Available snapshots<br />	</span><span style="color: #0000BB">$wgExtDistSnapshotRefs </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'master'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'REL1_38'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'REL1_37'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'REL1_36'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'REL1_35'</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #FF8000">// Use Graphite for popular list<br />	</span><span style="color: #0000BB">$wgExtDistGraphiteRenderApi </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://graphite.wikimedia.org/render'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// CentralAuth needed so that user CentralIds match<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseGlobalBlocking </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GlobalBlocking' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGlobalBlockingDatabase </span><span style="color: #007700">= </span><span style="color: #DD0000">'centralauth'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgApplyGlobalBlocks </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgApplyGlobalBlocks</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGlobalBlockingBlockXFF </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// Apply blocks to IPs in XFF (T25343)<br /></span><span style="color: #007700">}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TrustedXFF' </span><span style="color: #007700">);<br /><br />if ( </span><span style="color: #0000BB">$wmgUseContactPage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ContactPage' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgContactConfig </span><span style="color: #007700">= [];<br />	</span><span style="color: #0000BB">$wgContactConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'default'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'RecipientUser' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'SenderEmail' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'SenderName' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Contact Form on ' </span><span style="color: #007700">. </span><span style="color: #0000BB">$wgSitename</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'RequireDetails' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'IncludeIP' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'MustBeLoggedIn' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'RLModules' </span><span style="color: #007700">=&gt; [],<br />		</span><span style="color: #DD0000">'RLStyleModules' </span><span style="color: #007700">=&gt; [],<br />		</span><span style="color: #DD0000">'AdditionalFields' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'Text' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'label-message' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'emailmessage'</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'textarea'</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'rows' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">20</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'required' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />			],<br />		],<br />	];<br /><br />	</span><span style="color: #0000BB">$wgContactConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'default'</span><span style="color: #007700">] = </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgContactConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'default'</span><span style="color: #007700">], </span><span style="color: #0000BB">$wmgContactPageConf </span><span style="color: #007700">);<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">) {<br />		include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/MetaContactPages.php'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgContactConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'stewards'</span><span style="color: #007700">] = [ </span><span style="color: #FF8000">// T98625<br />			</span><span style="color: #DD0000">'RecipientUser' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Wikimedia Stewards'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'SenderEmail' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgNotificationSender</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'RequireDetails' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'IncludeIP' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'AdditionalFields' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'Text' </span><span style="color: #007700">=&gt; [<br />					</span><span style="color: #DD0000">'label-message' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'emailmessage'</span><span style="color: #007700">,<br />					</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'textarea'</span><span style="color: #007700">,<br />					</span><span style="color: #DD0000">'rows' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">20</span><span style="color: #007700">,<br />					</span><span style="color: #DD0000">'required' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true<br />				</span><span style="color: #007700">],<br />				</span><span style="color: #DD0000">'Disclaimer' </span><span style="color: #007700">=&gt; [<br />					</span><span style="color: #DD0000">'label-message' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'contactpage-stewards-disclaimer-label'</span><span style="color: #007700">,<br />					</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'info'<br />				</span><span style="color: #007700">]<br />			]<br />		];<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSecurePoll </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SecurePoll' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgSecurePollUseNamespace </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgSecurePollUseNamespace</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgSecurePollScript </span><span style="color: #007700">= </span><span style="color: #DD0000">'auth-api.php'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'SecurePoll_JumpUrl'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$page</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$url </span><span style="color: #007700">) use ( </span><span style="color: #0000BB">$site</span><span style="color: #007700">, </span><span style="color: #0000BB">$lang </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$url </span><span style="color: #007700">= </span><span style="color: #0000BB">wfAppendQuery</span><span style="color: #007700">( </span><span style="color: #0000BB">$url</span><span style="color: #007700">, [ </span><span style="color: #DD0000">'site' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$site</span><span style="color: #007700">, </span><span style="color: #DD0000">'lang' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$lang </span><span style="color: #007700">] );<br />		return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	};<br />	</span><span style="color: #0000BB">$wgSecurePollCreateWikiGroups </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'securepollglobal' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'securepoll-dblist-securepollglobal'<br />	</span><span style="color: #007700">];<br />	</span><span style="color: #FF8000">// T173393 - This is number of days after the election ends, not<br />	// number of days after the vote was cast. Lower to 60 days so that<br />	// overall time retained is not &gt; 90 days.<br />	</span><span style="color: #0000BB">$wgSecurePollKeepPrivateInfoDays </span><span style="color: #007700">= </span><span style="color: #0000BB">60</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// T209802 - gpg2 is untested and evidently broken<br />	</span><span style="color: #0000BB">$wgSecurePollGPGCommand </span><span style="color: #007700">= </span><span style="color: #DD0000">'gpg1'</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">wfHostName</span><span style="color: #007700">() === </span><span style="color: #DD0000">'mwmaint1002' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgSecurePollShowErrorDetail </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />}<br /><br /></span><span style="color: #FF8000">// PoolCounter<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUsePoolCounter </span><span style="color: #007700">) {<br />	include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/PoolCounterSettings.php'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSecureLinkFixer </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SecureLinkFixer' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseScore </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Score' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgScoreSafeMode </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseScoreShellbox </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox'</span><span style="color: #007700">] ) {<br />		</span><span style="color: #FF8000">// Route score to the Shellbox named "shellbox".<br />		</span><span style="color: #0000BB">$wgShellboxUrls</span><span style="color: #007700">[</span><span style="color: #DD0000">'score'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox'</span><span style="color: #007700">];<br />		</span><span style="color: #FF8000">// $wgShellboxSecretKey set in PrivateSettings.php<br />		</span><span style="color: #0000BB">$wgScoreImageMagickConvert </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/bin/convert'</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #FF8000"># Emergency mode in which Score is disabled<br />		</span><span style="color: #0000BB">$wgScoreLilyPond </span><span style="color: #007700">= </span><span style="color: #DD0000">'/dev/null'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgScoreDisableExec </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgScoreLilyPondFakeVersion </span><span style="color: #007700">= </span><span style="color: #DD0000">'2.22.0'</span><span style="color: #007700">;<br />	}<br /><br />}<br /><br /></span><span style="color: #0000BB">$wgHiddenPrefs</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'realname'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># Default address gets rejected by some mail hosts<br /></span><span style="color: #0000BB">$wgPasswordSender </span><span style="color: #007700">= </span><span style="color: #DD0000">'wiki@wikimedia.org'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># e-mailing password based on e-mail address (T36386)<br /></span><span style="color: #0000BB">$wgPasswordResetRoutes</span><span style="color: #007700">[</span><span style="color: #DD0000">'email'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labswiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgUseInstantCommons </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'nostalgiawiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000"># Link back to current version from the archive funhouse<br />	</span><span style="color: #007700">if ( ( isset( </span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'title'</span><span style="color: #007700">] ) &amp;&amp; ( </span><span style="color: #0000BB">$title </span><span style="color: #007700">= </span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'title'</span><span style="color: #007700">] ) )<br />		|| ( isset( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PATH_INFO'</span><span style="color: #007700">] ) &amp;&amp; ( </span><span style="color: #0000BB">$title </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'PATH_INFO'</span><span style="color: #007700">], </span><span style="color: #0000BB">1 </span><span style="color: #007700">) ) ) ) {<br />		if ( </span><span style="color: #0000BB">preg_match</span><span style="color: #007700">( </span><span style="color: #DD0000">'/^(.*)\\/Talk$/'</span><span style="color: #007700">, </span><span style="color: #0000BB">$title</span><span style="color: #007700">, </span><span style="color: #0000BB">$matches </span><span style="color: #007700">) ) {<br />			</span><span style="color: #0000BB">$title </span><span style="color: #007700">= </span><span style="color: #DD0000">'Talk:' </span><span style="color: #007700">. </span><span style="color: #0000BB">$matches</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">];<br />		}<br />		</span><span style="color: #0000BB">$wgSiteNotice </span><span style="color: #007700">= </span><span style="color: #DD0000">"[//en.wikipedia.org/wiki/" </span><span style="color: #007700">.<br />			</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">( </span><span style="color: #0000BB">urlencode</span><span style="color: #007700">( </span><span style="color: #0000BB">$title </span><span style="color: #007700">) ) .<br />		</span><span style="color: #DD0000">' See the current version of this page on Wikipedia]'</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgSiteNotice </span><span style="color: #007700">= </span><span style="color: #DD0000">"[//en.wikipedia.org/ See current Wikipedia]"</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Nostalgia skin<br />	</span><span style="color: #0000BB">wfLoadSkin</span><span style="color: #007700">( </span><span style="color: #DD0000">'Nostalgia' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$wgFooterIcons</span><span style="color: #007700">[</span><span style="color: #DD0000">'copyright'</span><span style="color: #007700">][</span><span style="color: #DD0000">'copyright'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'&lt;a href="https://wikimediafoundation.org/"&gt;' </span><span style="color: #007700">.<br />	</span><span style="color: #DD0000">'&lt;img src="' </span><span style="color: #007700">. </span><span style="color: #0000BB">$wmgWikimediaIcon</span><span style="color: #007700">[</span><span style="color: #DD0000">'1x'</span><span style="color: #007700">] . </span><span style="color: #DD0000">'" ' </span><span style="color: #007700">.<br />		</span><span style="color: #DD0000">'srcset="' </span><span style="color: #007700">.<br />			</span><span style="color: #0000BB">$wmgWikimediaIcon</span><span style="color: #007700">[</span><span style="color: #DD0000">'1.5x'</span><span style="color: #007700">] . </span><span style="color: #DD0000">' 1.5x, ' </span><span style="color: #007700">.<br />			</span><span style="color: #0000BB">$wmgWikimediaIcon</span><span style="color: #007700">[</span><span style="color: #DD0000">'2x'</span><span style="color: #007700">] . </span><span style="color: #DD0000">' 2x' </span><span style="color: #007700">.<br />		</span><span style="color: #DD0000">'" ' </span><span style="color: #007700">.<br />		</span><span style="color: #DD0000">'width="88" height="31" alt="Wikimedia Foundation" loading="lazy" /&gt;&lt;/a&gt;'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># :SEARCH:<br /><br /># All wikis are special and get Cirrus :)<br /># Must come *AFTER* PoolCounterSettings.php<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Elastica' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CirrusSearch' </span><span style="color: #007700">);<br />include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/CirrusSearch-common.php'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgInvalidateCacheOnLocalSettingsChange </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgEnableUserEmail </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgNoFollowLinks </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// In case the MediaWiki default changed, T44594<br /><br /># XFF log for incident response<br /></span><span style="color: #0000BB">$wgExtensionFunctions</span><span style="color: #007700">[] = static function () {<br />	if (<br />		isset( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">] )<br />		&amp;&amp; </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_METHOD'</span><span style="color: #007700">] === </span><span style="color: #DD0000">'POST'<br />		</span><span style="color: #FF8000">// T129982<br />		</span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_HOST'</span><span style="color: #007700">] !== </span><span style="color: #DD0000">'jobrunner.discovery.wmnet'<br />	</span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$uri </span><span style="color: #007700">= ( ( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTPS'</span><span style="color: #007700">] ?? </span><span style="color: #0000BB">null </span><span style="color: #007700">) ? </span><span style="color: #DD0000">'https://' </span><span style="color: #007700">: </span><span style="color: #DD0000">'http://' </span><span style="color: #007700">) .<br />			</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_HOST'</span><span style="color: #007700">] . </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REQUEST_URI'</span><span style="color: #007700">];<br /><br />		</span><span style="color: #0000BB">$logger </span><span style="color: #007700">= </span><span style="color: #0000BB">LoggerFactory</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">( </span><span style="color: #DD0000">'xff' </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">( </span><span style="color: #DD0000">"{date}\t{uri}\t{xff}, {remoteaddr}\t{wpSave}"</span><span style="color: #007700">,<br />			[<br />				</span><span style="color: #DD0000">'date' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">gmdate</span><span style="color: #007700">( </span><span style="color: #DD0000">'r' </span><span style="color: #007700">),<br />				</span><span style="color: #DD0000">'uri' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$uri</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'xff' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_X_FORWARDED_FOR'</span><span style="color: #007700">] ?? </span><span style="color: #DD0000">''</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'remoteaddr' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'REMOTE_ADDR'</span><span style="color: #007700">],<br />				</span><span style="color: #DD0000">'wpSave' </span><span style="color: #007700">=&gt; ( </span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'wpSave'</span><span style="color: #007700">] ?? </span><span style="color: #0000BB">null </span><span style="color: #007700">) ? </span><span style="color: #DD0000">'save' </span><span style="color: #007700">: </span><span style="color: #DD0000">''</span><span style="color: #007700">,<br />			]<br />		);<br />	}<br />};<br /><br /></span><span style="color: #FF8000">// T26313, turn off minordefault on enwiki<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'enwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgHiddenPrefs</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'minordefault'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'SkinAddFooterLinks'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$sk</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$footerlinks </span><span style="color: #007700">)<br />	use ( </span><span style="color: #0000BB">$wmgUseFooterContactLink</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgUseFooterCodeOfConductLink</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgUseFooterTechCodeOfConductLink </span><span style="color: #007700">)<br />{<br />	if ( </span><span style="color: #0000BB">$key </span><span style="color: #007700">!== </span><span style="color: #DD0000">'places' </span><span style="color: #007700">) {<br />		return;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseFooterContactLink </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$footerlinks</span><span style="color: #007700">[</span><span style="color: #DD0000">'contact'</span><span style="color: #007700">] = </span><span style="color: #0000BB">Html</span><span style="color: #007700">::</span><span style="color: #0000BB">element</span><span style="color: #007700">(<br />			</span><span style="color: #DD0000">'a'</span><span style="color: #007700">,<br />			[ </span><span style="color: #DD0000">'href' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$sk</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">msg</span><span style="color: #007700">( </span><span style="color: #DD0000">'contact-url' </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">escaped</span><span style="color: #007700">() ],<br />			</span><span style="color: #0000BB">$sk</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">msg</span><span style="color: #007700">( </span><span style="color: #DD0000">'contact' </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">()<br />		);<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseFooterCodeOfConductLink </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// T280886 wm-codeofconduct-url currently points to<br />		// https://meta.wikimedia.org/wiki/Special:MyLanguage/Universal_Code_of_Conduct<br />		// but may need updating to point to<br />		// https://foundation.wikimedia.org/wiki/Special:MyLanguage/Universal_Code_of_Conduct<br />		</span><span style="color: #007700">return;<br />		</span><span style="color: #FF8000">// $urlKey = 'wm-codeofconduct-url';<br />		// $msgKey = 'wm-codeofconduct';<br />	</span><span style="color: #007700">} elseif ( </span><span style="color: #0000BB">$wmgUseFooterTechCodeOfConductLink </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$urlKey </span><span style="color: #007700">= </span><span style="color: #DD0000">'wm-techcodeofconduct-url'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$msgKey </span><span style="color: #007700">= </span><span style="color: #DD0000">'wm-techcodeofconduct'</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #0000BB">$footerlinks</span><span style="color: #007700">[</span><span style="color: #DD0000">'wm-codeofconduct'</span><span style="color: #007700">] = </span><span style="color: #0000BB">Html</span><span style="color: #007700">::</span><span style="color: #0000BB">element</span><span style="color: #007700">(<br />		</span><span style="color: #DD0000">'a'</span><span style="color: #007700">,<br />		[ </span><span style="color: #DD0000">'href' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$sk</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">msg</span><span style="color: #007700">( </span><span style="color: #0000BB">$urlKey </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">escaped</span><span style="color: #007700">() ],<br />		</span><span style="color: #0000BB">$sk</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">msg</span><span style="color: #007700">( </span><span style="color: #0000BB">$msgKey </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">()<br />	);<br />};<br /><br /></span><span style="color: #FF8000">// T35186: turn off incomplete feature action=imagerotate<br /></span><span style="color: #0000BB">$wgAPIModules</span><span style="color: #007700">[</span><span style="color: #DD0000">'imagerotate'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'ApiDisabled'</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseDynamicPageList </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'intersection' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgDLPMaxCacheTime </span><span style="color: #007700">= </span><span style="color: #0000BB">604800</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Renameuser' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'bureaucrat'</span><span style="color: #007700">][</span><span style="color: #DD0000">'renameuser'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgAllowLocalRenameuser</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSpecialNuke </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Nuke' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTorBlock </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TorBlock' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTorIPs </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'91.198.174.232'</span><span style="color: #007700">, </span><span style="color: #DD0000">'208.80.152.2'</span><span style="color: #007700">, </span><span style="color: #DD0000">'208.80.152.134' </span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wgTorAutoConfirmAge </span><span style="color: #007700">= </span><span style="color: #0000BB">90 </span><span style="color: #007700">* </span><span style="color: #0000BB">86400</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTorAutoConfirmCount </span><span style="color: #007700">= </span><span style="color: #0000BB">100</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTorDisableAdminBlocks </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTorTagChanges </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'torunblocked'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTorBlockProxy </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgCopyUploadProxy</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseRSSExtension </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'RSS' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgRSSProxy </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgCopyUploadProxy</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgRSSUrlWhitelist </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgRSSUrlWhitelist</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wgMaxCredits </span><span style="color: #007700">=== </span><span style="color: #0000BB">0 </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgActions</span><span style="color: #007700">[</span><span style="color: #DD0000">'credits'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># Process group overrides<br /><br /></span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'steward'   </span><span style="color: #007700">][</span><span style="color: #DD0000">'userrights'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'bureaucrat'</span><span style="color: #007700">][</span><span style="color: #DD0000">'userrights'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'bigdelete'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">; </span><span style="color: #FF8000">// quick hack<br /><br /></span><span style="color: #007700">foreach ( </span><span style="color: #0000BB">$groupOverrides2 </span><span style="color: #007700">as </span><span style="color: #0000BB">$group </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$permissions </span><span style="color: #007700">) {<br />	if ( !</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">( </span><span style="color: #0000BB">$group</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgGroupPermissions </span><span style="color: #007700">) ) {<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">] = [];<br />	}<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">] = </span><span style="color: #0000BB">$permissions </span><span style="color: #007700">+ </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">];<br />}<br /><br />foreach ( </span><span style="color: #0000BB">$groupOverrides </span><span style="color: #007700">as </span><span style="color: #0000BB">$group </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$permissions </span><span style="color: #007700">) {<br />	if ( !</span><span style="color: #0000BB">array_key_exists</span><span style="color: #007700">( </span><span style="color: #0000BB">$group</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgGroupPermissions </span><span style="color: #007700">) ) {<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">] = [];<br />	}<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">] = </span><span style="color: #0000BB">$permissions </span><span style="color: #007700">+ </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'loginwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'*'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'read' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'autocreateaccount' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'editmyoptions' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #FF8000">// T158871<br />	</span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'read' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'writeapi' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	];<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'autoconfirmed'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'read' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'writeapi' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	];<br /><br />	unset( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'import'</span><span style="color: #007700">] );<br />	unset( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'transwiki'</span><span style="color: #007700">] );<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">] = </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">],<br />		[<br />			</span><span style="color: #DD0000">'editinterface' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		]<br />	);<br />}<br /><br /></span><span style="color: #0000BB">$wgAutopromote </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'autoconfirmed' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'&amp;'</span><span style="color: #007700">,<br />		[ </span><span style="color: #0000BB">APCOND_EDITCOUNT</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgAutoConfirmCount </span><span style="color: #007700">],<br />		[ </span><span style="color: #0000BB">APCOND_AGE</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgAutoConfirmAge </span><span style="color: #007700">],<br />	],<br />];<br /><br />if ( </span><span style="color: #0000BB">is_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgAutopromoteExtraGroups </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgAutopromote </span><span style="color: #007700">+= </span><span style="color: #0000BB">$wmgAutopromoteExtraGroups</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgAutopromoteOnce </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'onEdit' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgAutopromoteOnceonEdit</span><span style="color: #007700">,<br />];<br /><br />if ( </span><span style="color: #0000BB">is_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgExtraImplicitGroups </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgImplicitGroups </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgImplicitGroups</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgExtraImplicitGroups </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgHTTPTimeout </span><span style="color: #007700">= </span><span style="color: #0000BB">10</span><span style="color: #007700">;<br />}<br />if ( </span><span style="color: #0000BB">$wgRequestTimeLimit </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Set the maximum HTTP client timeout equal to the current request timeout (T245170)<br />	</span><span style="color: #0000BB">$wgHTTPMaxTimeout </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgHTTPMaxConnectTimeout </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgRequestTimeLimit</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// TODO: This is a no-op with $wgForceHTTPS enabled<br />// Remove once enabled everywhere. – T256095<br /></span><span style="color: #0000BB">$wgHiddenPrefs</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'prefershttps'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T91352, T102245<br /><br /></span><span style="color: #007700">if ( isset( </span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'captchabypass'</span><span style="color: #007700">] ) &amp;&amp; </span><span style="color: #0000BB">$_REQUEST</span><span style="color: #007700">[</span><span style="color: #DD0000">'captchabypass'</span><span style="color: #007700">] == </span><span style="color: #0000BB">$wmgCaptchaPassword </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wmgEnableCaptcha </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgEnableCaptcha </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ConfirmEdit' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ConfirmEdit/FancyCaptcha' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'autoconfirmed'</span><span style="color: #007700">][</span><span style="color: #DD0000">'skipcaptcha'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCaptchaFileBackend </span><span style="color: #007700">= </span><span style="color: #DD0000">'global-multiwrite'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCaptchaSecret </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCaptchaSecret</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCaptchaDirectoryLevels </span><span style="color: #007700">= </span><span style="color: #0000BB">3</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCaptchaStorageClass </span><span style="color: #007700">= </span><span style="color: #DD0000">'CaptchaCacheStore'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCaptchaClass </span><span style="color: #007700">= </span><span style="color: #DD0000">'FancyCaptcha'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCaptchaWhitelist </span><span style="color: #007700">=<br />		</span><span style="color: #DD0000">'#^(https?:)?//([.a-z0-9-]+\\.)?((wikimedia|wikipedia|wiktionary|wikiquote|wikibooks|wikisource|wikispecies|mediawiki|wikinews|wikiversity|wikivoyage|wikidata|wikifunctions|wmflabs)\.org'<br />		</span><span style="color: #007700">. </span><span style="color: #DD0000">'|dnsstuff\.com|completewhois\.com|wikimedia\.de)([?/\#]|$)#i'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// 'XRumer' spambot<br />	// adds non-real links<br />	// http://meta.wikimedia.org/wiki/User:Cometstyles/XRumer<br />	// http://meta.wikimedia.org/wiki/User:Jorunn/tracks<br />	// (added 2008-05-08 -- brion)<br />	</span><span style="color: #0000BB">$wgCaptchaRegexes</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'/&lt;a +href/i'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// For emergencies<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgEmergencyCaptcha </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCaptchaTriggers</span><span style="color: #007700">[</span><span style="color: #DD0000">'edit'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgCaptchaTriggers</span><span style="color: #007700">[</span><span style="color: #DD0000">'create'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labswiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCaptchaTriggers</span><span style="color: #007700">[</span><span style="color: #DD0000">'addurl'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000"># akosiaris 20180306. contact pages in metawiki are being abused by bots<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCaptchaTriggers</span><span style="color: #007700">[</span><span style="color: #DD0000">'contactpage'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">extension_loaded</span><span style="color: #007700">( </span><span style="color: #DD0000">'wikidiff2' </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgDiff </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgInterwikiCache </span><span style="color: #007700">= require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/interwiki-labs.php'</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgInterwikiCache </span><span style="color: #007700">= require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/interwiki.php'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Username spoofing / mixed-script / similarity check detection<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'AntiSpoof' </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// For transwiki import<br /></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">( </span><span style="color: #DD0000">'user_agent'</span><span style="color: #007700">, </span><span style="color: #DD0000">'Wikimedia internal server fetcher (noc@wikimedia.org' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgHTTPImportTimeout </span><span style="color: #007700">= </span><span style="color: #0000BB">50</span><span style="color: #007700">; </span><span style="color: #FF8000">// T155209<br /><br />// CentralAuth<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CentralAuth' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// Enable cross-origin session cookies (T252236).<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgEnableCrossOriginSessions </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCookieSameSite </span><span style="color: #007700">= </span><span style="color: #DD0000">'None'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgUseSameSiteLegacyCookies </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">$wgCentralAuthDryRun </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCentralAuthCookies </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgCentralAuthUseEventLogging </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCentralAuthPreventUnattached </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Optimisation: Avoid overhead of computing localised urls<br />	// See https://phabricator.wikimedia.org/T189966#5436482<br />	</span><span style="color: #0000BB">$wgCentralAuthCookiesP3P </span><span style="color: #007700">= </span><span style="color: #DD0000">"CP=\"See </span><span style="color: #0000BB">$wgCanonicalServer</span><span style="color: #DD0000">/wiki/Special:CentralAutoLogin/P3P for more info.\""</span><span style="color: #007700">;<br /><br />	foreach ( </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'irc'</span><span style="color: #007700">] as </span><span style="color: #0000BB">$address </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCentralAuthRC</span><span style="color: #007700">[] = [<br />			</span><span style="color: #DD0000">'formatter' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'MediaWiki\\Extension\\CentralAuth\\RCFeed\\IRCColourfulCARCFeedFormatter'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'uri' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"udp://</span><span style="color: #0000BB">$address</span><span style="color: #DD0000">:</span><span style="color: #0000BB">$wmgRC2UDPPort</span><span style="color: #DD0000">/#central\t"</span><span style="color: #007700">,<br />		];<br />	}<br /><br />	switch ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">) {<br />	case </span><span style="color: #DD0000">'production'</span><span style="color: #007700">:<br />		</span><span style="color: #FF8000">// Production cluster<br />		</span><span style="color: #0000BB">$wmgSecondLevelDomainRegex </span><span style="color: #007700">= </span><span style="color: #DD0000">'/^\w+\.\w+\./'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCentralAuthAutoLoginWikis</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgCentralAuthLoginWiki </span><span style="color: #007700">= </span><span style="color: #DD0000">'loginwiki'</span><span style="color: #007700">;<br />		break;<br /><br />	case </span><span style="color: #DD0000">'labs'</span><span style="color: #007700">:<br />		</span><span style="color: #FF8000">// wmflabs beta cluster<br />		</span><span style="color: #0000BB">$wmgSecondLevelDomainRegex </span><span style="color: #007700">= </span><span style="color: #DD0000">'/^\w+\.\w+\.\w+\.\w+\./'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis </span><span style="color: #007700">= [<br />			</span><span style="color: #DD0000">'.wikipedia.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwiki'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wikisource.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwikisource'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wikibooks.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwikibooks'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wikiversity.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwikiversity'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wikiquote.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwikiquote'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wikinews.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwikinews'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wikivoyage.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwikivoyage'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'.wiktionary.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'enwiktionary'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'meta.wikimedia.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'deployment.wikimedia.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'deploymentwiki'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'commons.wikimedia.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'commonswiki'</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikidata'</span><span style="color: #007700">] =&gt; </span><span style="color: #DD0000">'wikidatawiki'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'api.wikimedia.beta.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'apiportalwiki'</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikifunctions'</span><span style="color: #007700">] =&gt; </span><span style="color: #DD0000">'wikifunctionswiki'</span><span style="color: #007700">,<br />		];<br />		</span><span style="color: #0000BB">$wgCentralAuthLoginWiki </span><span style="color: #007700">= </span><span style="color: #DD0000">'loginwiki'</span><span style="color: #007700">;<br />		break;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">preg_match</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgSecondLevelDomainRegex</span><span style="color: #007700">, </span><span style="color: #0000BB">strrev</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgServer </span><span style="color: #007700">), </span><span style="color: #0000BB">$m </span><span style="color: #007700">) ) {<br />		</span><span style="color: #0000BB">$wmgSecondLevelDomain </span><span style="color: #007700">= </span><span style="color: #0000BB">strrev</span><span style="color: #007700">( </span><span style="color: #0000BB">$m</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">] );<br />	} else {<br />		</span><span style="color: #0000BB">$wmgSecondLevelDomain </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br />	unset( </span><span style="color: #0000BB">$wmgSecondLevelDomainRegex </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000"># Don't autologin to self<br />	</span><span style="color: #007700">if ( isset( </span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis</span><span style="color: #007700">[</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #007700">] ) ) {<br />		unset( </span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis</span><span style="color: #007700">[</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #007700">] );<br />		</span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #007700">;<br />	} elseif ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">&amp;&amp; isset( </span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis</span><span style="color: #007700">[</span><span style="color: #DD0000">"commons</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #DD0000">"</span><span style="color: #007700">] ) ) {<br />		unset( </span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis</span><span style="color: #007700">[</span><span style="color: #DD0000">"commons</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #DD0000">"</span><span style="color: #007700">] );<br />		</span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">"commons</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />	} elseif ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">) {<br />		unset( </span><span style="color: #0000BB">$wgCentralAuthAutoLoginWikis</span><span style="color: #007700">[</span><span style="color: #DD0000">"meta</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #DD0000">"</span><span style="color: #007700">] );<br />		</span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">"meta</span><span style="color: #0000BB">$wmgSecondLevelDomain</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #FF8000"># Don't set 2nd-level cookies for *.wikimedia.org, insecure<br />		</span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #0000BB">$wgCentralAuthLoginIcon </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCentralAuthLoginIcon</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCentralAuthAutoNew </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">/**<br />	 * This function is used for both the CentralAuthWikiList and<br />	 * GlobalUserPageWikis hooks.<br />	 *<br />	 * @param array &amp;$list<br />	 * @return bool<br />	 */<br />	</span><span style="color: #007700">function </span><span style="color: #0000BB">wmfCentralAuthWikiList</span><span style="color: #007700">( &amp;</span><span style="color: #0000BB">$list </span><span style="color: #007700">) {<br />		global </span><span style="color: #0000BB">$wgLocalDatabases</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgSiteMatrixPrivateSites</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wgSiteMatrixFishbowlSites</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgSiteMatrixClosedSites</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wgSiteMatrixNonGlobalSites</span><span style="color: #007700">;<br /><br />		</span><span style="color: #0000BB">$list </span><span style="color: #007700">= </span><span style="color: #0000BB">array_diff</span><span style="color: #007700">(<br />			</span><span style="color: #0000BB">$wgLocalDatabases</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wgSiteMatrixPrivateSites</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wgSiteMatrixFishbowlSites</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wgSiteMatrixClosedSites</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wgSiteMatrixNonGlobalSites<br />		</span><span style="color: #007700">);<br />		return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'CentralAuthWikiList'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'wmfCentralAuthWikiList'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Let's give it another try<br />	</span><span style="color: #0000BB">$wgCentralAuthCreateOnView </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Attempt to attach unattached accounts by password on login<br />	</span><span style="color: #0000BB">$wgCentralAuthAutoMigrate </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Try to create global accounts if one doesn't exist and it's safe<br />	</span><span style="color: #0000BB">$wgCentralAuthAutoMigrateNonGlobalAccounts </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Enables Special:GlobalRenameRequest<br />	</span><span style="color: #0000BB">$wgCentralAuthEnableGlobalRenameRequest </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Only allow users with global accounts to login<br />	</span><span style="color: #0000BB">$wgCentralAuthStrict </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Create some local accounts as soon as the global registration happens<br />	</span><span style="color: #0000BB">$wgCentralAuthAutoCreateWikis </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'loginwiki'</span><span style="color: #007700">, </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">];<br /><br />	</span><span style="color: #FF8000">// Link global block blockers to user pages on Meta<br />	</span><span style="color: #0000BB">$wgCentralAuthGlobalBlockInterwikiPrefix </span><span style="color: #007700">= </span><span style="color: #DD0000">'meta'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// See T104371 and [[m:Requests_for_comment/Password_policy_for_users_with_certain_advanced_permissions]]<br />	</span><span style="color: #007700">foreach ( </span><span style="color: #0000BB">$wmgPrivilegedGlobalGroups </span><span style="color: #007700">as </span><span style="color: #0000BB">$group </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCentralAuthGlobalPasswordPolicies</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgPrivilegedPolicy</span><span style="color: #007700">;<br />		if ( </span><span style="color: #0000BB">$group </span><span style="color: #007700">=== </span><span style="color: #DD0000">'staff' </span><span style="color: #007700">) {<br />			</span><span style="color: #FF8000">// Require 10 byte password for staff.<br />			</span><span style="color: #0000BB">$wgCentralAuthGlobalPasswordPolicies</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'MinimumPasswordLengthToLogin'</span><span style="color: #007700">] = </span><span style="color: #0000BB">10</span><span style="color: #007700">;<br />		}<br />	}<br /><br />	</span><span style="color: #FF8000">// Check global rename log on meta for new accounts<br />	</span><span style="color: #0000BB">$wgCentralAuthOldNameAntiSpoofWiki </span><span style="color: #007700">= </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Config for GlobalCssJs<br />// Only enable on CentralAuth wikis<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseGlobalCssJs </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GlobalCssJs' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// Disable site-wide global css/js<br />	</span><span style="color: #0000BB">$wgUseGlobalSiteCssJs </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Setup metawiki as central wiki<br />	</span><span style="color: #0000BB">$wgResourceLoaderSources</span><span style="color: #007700">[</span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'apiScript' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'//meta.wikimedia.org/w/api.php'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'loadScript' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'//meta.wikimedia.org/w/load.php'</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #0000BB">$wgGlobalCssJsConfig </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'wiki' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">, </span><span style="color: #FF8000">// database name<br />		</span><span style="color: #DD0000">'source' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">, </span><span style="color: #FF8000">// ResourceLoader source name<br />	</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGlobalUserPage </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GlobalUserPage' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGlobalUserPageAPIUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://meta.wikimedia.org/w/api.php'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGlobalUserPageDBname </span><span style="color: #007700">= </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'GlobalUserPageWikis'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'wmfCentralAuthWikiList'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgLocalAuthLoginOnly </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// T57420: prevent creation of local password records for SUL users<br />	</span><span style="color: #007700">if ( isset( </span><span style="color: #0000BB">$wgAuthManagerAutoConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'primaryauth'</span><span style="color: #007700">][\</span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">LocalPasswordPrimaryAuthenticationProvider</span><span style="color: #007700">::class] ) ) {<br />		</span><span style="color: #0000BB">$wgAuthManagerAutoConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'primaryauth'</span><span style="color: #007700">][\</span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">LocalPasswordPrimaryAuthenticationProvider</span><span style="color: #007700">::class][</span><span style="color: #DD0000">'args'</span><span style="color: #007700">][</span><span style="color: #0000BB">0</span><span style="color: #007700">][</span><span style="color: #DD0000">'loginOnly'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseApiFeatureUsage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ApiFeatureUsage' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgApiFeatureUsageQueryEngineConf </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">ApiFeatureUsageQueryEngineElastica</span><span style="color: #007700">::class,<br />		</span><span style="color: #DD0000">'serverList' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'search-chi'</span><span style="color: #007700">],<br />	];<br />}<br /><br /></span><span style="color: #FF8000">// taking it live 2006-12-15 brion<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'DismissableSiteNotice' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgDismissableSiteNoticeForAnons </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T59732<br /></span><span style="color: #0000BB">$wgMajorSiteNoticeID </span><span style="color: #007700">= </span><span style="color: #DD0000">'2'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">/**<br /> * Get an array of groups (in $wmgPrivilegedGroups) that $username is part of<br /> *<br /> * @param UserIdentity $user<br /> * @return array Any elevated/privileged groups the user is a member of<br /> */<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">wmfGetPrivilegedGroups</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">) {<br />	global </span><span style="color: #0000BB">$wmgUseCentralAuth</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgPrivilegedGroups</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgPrivilegedGlobalGroups</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">CentralAuthUser</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstanceByName</span><span style="color: #007700">( </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">() )-&gt;</span><span style="color: #0000BB">exists</span><span style="color: #007700">() ) {<br />		</span><span style="color: #0000BB">$centralUser </span><span style="color: #007700">= </span><span style="color: #0000BB">CentralAuthUser</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstanceByName</span><span style="color: #007700">( </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">() );<br />		try {<br />			</span><span style="color: #0000BB">$groups </span><span style="color: #007700">= </span><span style="color: #0000BB">array_intersect</span><span style="color: #007700">(<br />				</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wmgPrivilegedGroups</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgPrivilegedGlobalGroups </span><span style="color: #007700">),<br />				</span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$centralUser</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getGlobalGroups</span><span style="color: #007700">(), </span><span style="color: #0000BB">$centralUser</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getLocalGroups</span><span style="color: #007700">() )<br />			);<br />		} catch ( </span><span style="color: #0000BB">Exception $e </span><span style="color: #007700">) {<br />			</span><span style="color: #FF8000">// Don't block login if we can't query attached (T119736)<br />			</span><span style="color: #0000BB">MWExceptionHandler</span><span style="color: #007700">::</span><span style="color: #0000BB">logException</span><span style="color: #007700">( </span><span style="color: #0000BB">$e </span><span style="color: #007700">);<br />			</span><span style="color: #0000BB">$groups </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br />				</span><span style="color: #0000BB">MediaWikiServices</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()<br />					-&gt;</span><span style="color: #0000BB">getUserGroupManager</span><span style="color: #007700">()<br />					-&gt;</span><span style="color: #0000BB">getUserGroups</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">),<br />				</span><span style="color: #0000BB">$centralUser</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getGlobalGroups</span><span style="color: #007700">()<br />			);<br />		}<br />	} else {<br />		</span><span style="color: #FF8000">// use effective groups, as we set 'user' as privileged for private/fishbowl wikis<br />		</span><span style="color: #0000BB">$groups </span><span style="color: #007700">= </span><span style="color: #0000BB">array_intersect</span><span style="color: #007700">(<br />			</span><span style="color: #0000BB">$wmgPrivilegedGroups</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">MediaWikiServices</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()<br />				-&gt;</span><span style="color: #0000BB">getUserGroupManager</span><span style="color: #007700">()<br />				-&gt;</span><span style="color: #0000BB">getUserEffectiveGroups</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">)<br />			);<br />	}<br />	return </span><span style="color: #0000BB">$groups</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// log suspicious or sensitive login attempts<br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'AuthManagerLoginAuthenticateAudit'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$response</span><span style="color: #007700">, </span><span style="color: #0000BB">$user</span><span style="color: #007700">, </span><span style="color: #0000BB">$username </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$guessed </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	if ( !</span><span style="color: #0000BB">$user </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$username </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$user </span><span style="color: #007700">= </span><span style="color: #0000BB">MediaWikiServices</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()<br />			-&gt;</span><span style="color: #0000BB">getUserIdentityLookup</span><span style="color: #007700">()<br />			-&gt;</span><span style="color: #0000BB">getUserIdentityByName</span><span style="color: #007700">( </span><span style="color: #0000BB">$username </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$guessed </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />	if ( !</span><span style="color: #0000BB">$user </span><span style="color: #007700">|| !</span><span style="color: #0000BB">in_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$response</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status</span><span style="color: #007700">,<br />		[ </span><span style="color: #0000BB">AuthenticationResponse</span><span style="color: #007700">::</span><span style="color: #0000BB">PASS</span><span style="color: #007700">, </span><span style="color: #0000BB">AuthenticationResponse</span><span style="color: #007700">::</span><span style="color: #0000BB">FAIL </span><span style="color: #007700">], </span><span style="color: #0000BB">true </span><span style="color: #007700">)<br />	) {<br />		return;<br />	}<br /><br />	global </span><span style="color: #0000BB">$wgRequest</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$headers </span><span style="color: #007700">= </span><span style="color: #0000BB">function_exists</span><span style="color: #007700">( </span><span style="color: #DD0000">'apache_request_headers' </span><span style="color: #007700">) ? </span><span style="color: #0000BB">apache_request_headers</span><span style="color: #007700">() : [];<br />	</span><span style="color: #0000BB">$successful </span><span style="color: #007700">= </span><span style="color: #0000BB">$response</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">status </span><span style="color: #007700">=== </span><span style="color: #0000BB">AuthenticationResponse</span><span style="color: #007700">::</span><span style="color: #0000BB">PASS</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">= </span><span style="color: #0000BB">wmfGetPrivilegedGroups</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$channel </span><span style="color: #007700">= </span><span style="color: #0000BB">$successful </span><span style="color: #007700">? </span><span style="color: #DD0000">'goodpass' </span><span style="color: #007700">: </span><span style="color: #DD0000">'badpass'</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$channel </span><span style="color: #007700">.= </span><span style="color: #DD0000">'-priv'</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #0000BB">$logger </span><span style="color: #007700">= </span><span style="color: #0000BB">LoggerFactory</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">( </span><span style="color: #0000BB">$channel </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$verb </span><span style="color: #007700">= </span><span style="color: #0000BB">$successful </span><span style="color: #007700">? </span><span style="color: #DD0000">'succeeded' </span><span style="color: #007700">: </span><span style="color: #DD0000">'failed'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">( </span><span style="color: #DD0000">"Login </span><span style="color: #0000BB">$verb</span><span style="color: #DD0000"> for {priv} {name} from {clientip} - {xff} - {ua} - {geocookie}: {messagestr}"</span><span style="color: #007700">, [<br />		</span><span style="color: #DD0000">'successful' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$successful</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'groups' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">implode</span><span style="color: #007700">( </span><span style="color: #DD0000">', '</span><span style="color: #007700">, </span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">),<br />		</span><span style="color: #DD0000">'priv' </span><span style="color: #007700">=&gt; ( </span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">? </span><span style="color: #DD0000">'elevated' </span><span style="color: #007700">: </span><span style="color: #DD0000">'normal' </span><span style="color: #007700">),<br />		</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">(),<br />		</span><span style="color: #DD0000">'clientip' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgRequest</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getIP</span><span style="color: #007700">(),<br />		</span><span style="color: #DD0000">'xff' </span><span style="color: #007700">=&gt; @</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'X-Forwarded-For'</span><span style="color: #007700">],<br />		</span><span style="color: #DD0000">'ua' </span><span style="color: #007700">=&gt; @</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'User-Agent'</span><span style="color: #007700">],<br />		</span><span style="color: #DD0000">'guessed' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$guessed</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'msgname' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$response</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message </span><span style="color: #007700">? </span><span style="color: #0000BB">$response</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getKey</span><span style="color: #007700">() : </span><span style="color: #DD0000">'-'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'messagestr' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$response</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message </span><span style="color: #007700">? </span><span style="color: #0000BB">$response</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">message</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">inLanguage</span><span style="color: #007700">( </span><span style="color: #DD0000">'en' </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">() : </span><span style="color: #DD0000">''</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'geocookie' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgRequest</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCookie</span><span style="color: #007700">( </span><span style="color: #DD0000">'GeoIP'</span><span style="color: #007700">, </span><span style="color: #DD0000">'' </span><span style="color: #007700">),<br />	] );<br />};<br /><br /></span><span style="color: #FF8000">// log sysop password changes<br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'ChangeAuthenticationDataAudit'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$req</span><span style="color: #007700">, </span><span style="color: #0000BB">$status </span><span style="color: #007700">) {<br />	global </span><span style="color: #0000BB">$wgRequest</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$user </span><span style="color: #007700">= </span><span style="color: #0000BB">MediaWikiServices</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">()<br />		-&gt;</span><span style="color: #0000BB">getUserIdentityLookup</span><span style="color: #007700">()<br />		-&gt;</span><span style="color: #0000BB">getUserIdentityByName</span><span style="color: #007700">( </span><span style="color: #0000BB">$req</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">username </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$status </span><span style="color: #007700">= </span><span style="color: #0000BB">Status</span><span style="color: #007700">::</span><span style="color: #0000BB">wrap</span><span style="color: #007700">( </span><span style="color: #0000BB">$status </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">$req </span><span style="color: #007700">instanceof \</span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">PasswordAuthenticationRequest </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">= </span><span style="color: #0000BB">wmfGetPrivilegedGroups</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$priv </span><span style="color: #007700">= ( </span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">? </span><span style="color: #DD0000">'elevated' </span><span style="color: #007700">: </span><span style="color: #DD0000">'normal' </span><span style="color: #007700">);<br />		if ( </span><span style="color: #0000BB">$priv </span><span style="color: #007700">=== </span><span style="color: #DD0000">'elevated' </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$headers </span><span style="color: #007700">= </span><span style="color: #0000BB">function_exists</span><span style="color: #007700">( </span><span style="color: #DD0000">'apache_request_headers' </span><span style="color: #007700">) ? </span><span style="color: #0000BB">apache_request_headers</span><span style="color: #007700">() : [];<br /><br />			</span><span style="color: #0000BB">$logger </span><span style="color: #007700">= </span><span style="color: #0000BB">LoggerFactory</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">( </span><span style="color: #DD0000">'badpass' </span><span style="color: #007700">);<br />			</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">( </span><span style="color: #DD0000">'Password change in prefs for {priv} {name}: {status} - {clientip} - {xff} - {ua} - {geocookie}'</span><span style="color: #007700">, [<br />				</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">(),<br />				</span><span style="color: #DD0000">'groups' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">implode</span><span style="color: #007700">( </span><span style="color: #DD0000">', '</span><span style="color: #007700">, </span><span style="color: #0000BB">$privGroups </span><span style="color: #007700">),<br />				</span><span style="color: #DD0000">'priv' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$priv</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'status' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isGood</span><span style="color: #007700">() ? </span><span style="color: #DD0000">'ok' </span><span style="color: #007700">: </span><span style="color: #0000BB">$status</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getWikiText</span><span style="color: #007700">( </span><span style="color: #0000BB">null</span><span style="color: #007700">, </span><span style="color: #0000BB">null</span><span style="color: #007700">, </span><span style="color: #DD0000">'en' </span><span style="color: #007700">),<br />				</span><span style="color: #DD0000">'clientip' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgRequest</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getIP</span><span style="color: #007700">(),<br />				</span><span style="color: #DD0000">'xff' </span><span style="color: #007700">=&gt; @</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'X-Forwarded-For'</span><span style="color: #007700">],<br />				</span><span style="color: #DD0000">'ua' </span><span style="color: #007700">=&gt; @</span><span style="color: #0000BB">$headers</span><span style="color: #007700">[</span><span style="color: #DD0000">'User-Agent'</span><span style="color: #007700">],<br />				</span><span style="color: #DD0000">'geocookie' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgRequest</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getCookie</span><span style="color: #007700">( </span><span style="color: #DD0000">'GeoIP'</span><span style="color: #007700">, </span><span style="color: #DD0000">'' </span><span style="color: #007700">),<br />			] );<br />		}<br />	}<br />};<br /><br /></span><span style="color: #FF8000">// Passed to ulimit<br /><br /></span><span style="color: #0000BB">$wgMaxShellFileSize </span><span style="color: #007700">= </span><span style="color: #0000BB">512 </span><span style="color: #007700">* </span><span style="color: #0000BB">1024</span><span style="color: #007700">; </span><span style="color: #FF8000">// Kilobytes<br /></span><span style="color: #0000BB">$wgMaxShellMemory </span><span style="color: #007700">= </span><span style="color: #0000BB">1024 </span><span style="color: #007700">* </span><span style="color: #0000BB">1024</span><span style="color: #007700">;  </span><span style="color: #FF8000">// Kilobytes<br /></span><span style="color: #0000BB">$wgMaxShellTime </span><span style="color: #007700">= </span><span style="color: #0000BB">50</span><span style="color: #007700">;  </span><span style="color: #FF8000">// seconds<br /><br />// Use a cgroup for shell execution.<br />// This will cause shell execution to fail if the cgroup is not installed.<br />// If some misc server doesn't have the cgroup installed, you can create it<br />// with: mkdir -p -m777 /sys/fs/cgroup/memory/mediawiki/job<br /></span><span style="color: #0000BB">$wgShellCgroup </span><span style="color: #007700">= </span><span style="color: #DD0000">'/sys/fs/cgroup/memory/mediawiki/job'</span><span style="color: #007700">;<br /><br />switch ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">) {<br />case </span><span style="color: #DD0000">'production'</span><span style="color: #007700">:<br />	</span><span style="color: #0000BB">$wgImageMagickTempDir </span><span style="color: #007700">= </span><span style="color: #DD0000">'/tmp/magick-tmp'</span><span style="color: #007700">;<br />	break;<br />case </span><span style="color: #DD0000">'labs'</span><span style="color: #007700">:<br />	</span><span style="color: #0000BB">$wgImageMagickTempDir </span><span style="color: #007700">= </span><span style="color: #DD0000">'/tmp/a/magick-tmp'</span><span style="color: #007700">;<br />	break;<br />}<br /><br /></span><span style="color: #FF8000">// Banner notice system<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralNotice </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CentralNotice' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// for DNS prefetching<br />	</span><span style="color: #0000BB">$wgCentralHost </span><span style="color: #007700">= </span><span style="color: #DD0000">"//</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'meta'</span><span style="color: #007700">]}</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// for banner loading<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'production' </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'testwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCentralSelectedBannerDispatcher </span><span style="color: #007700">= </span><span style="color: #DD0000">"//test.wikipedia.org/w/index.php?title=Special:BannerLoader"</span><span style="color: #007700">;<br /><br />		</span><span style="color: #FF8000">// No caching for banners on testwiki, so we can develop them there a bit faster - NeilK 2012-01-16<br />		// Never set this to zero on a highly trafficked wiki, there are server-melting consequences<br />		</span><span style="color: #0000BB">$wgNoticeBannerMaxAge </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgCentralSelectedBannerDispatcher </span><span style="color: #007700">= </span><span style="color: #DD0000">"//</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'meta'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/w/index.php?title=Special:BannerLoader"</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #FF8000">// Relative URL which is hardcoded to HTTP 204 in Varnish config.<br />	</span><span style="color: #0000BB">$wgCentralBannerRecorder </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wgServer</span><span style="color: #007700">}</span><span style="color: #DD0000">/beacon/impression"</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Allow only these domains to access CentralNotice data through the reporter<br />	</span><span style="color: #0000BB">$wgNoticeReporterDomains </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://donate.wikimedia.org'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgCentralDBname </span><span style="color: #007700">= </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgNoticeInfrastructure </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCentralNoticeAdminGroup </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">== </span><span style="color: #DD0000">'production' </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'testwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// test.wikipedia.org has its own central database:<br />		</span><span style="color: #0000BB">$wgCentralDBname </span><span style="color: #007700">= </span><span style="color: #DD0000">'testwiki'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgNoticeInfrastructure </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	} elseif ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgNoticeInfrastructure </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />	if ( </span><span style="color: #0000BB">$wgNoticeInfrastructure </span><span style="color: #007700">) {<br /><br />		</span><span style="color: #FF8000">// List of available wiki groups within CentralNotice<br />		// (Only referenced from the infrastructure special pages.)<br />		</span><span style="color: #0000BB">$wgNoticeProjects </span><span style="color: #007700">= [<br />			</span><span style="color: #DD0000">"wikipedia"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wiktionary"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikiquote"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikibooks"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikidata"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikinews"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikisource"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikiversity"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikivoyage"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikimedia"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"commons"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"meta"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"wikispecies"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"test"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">"mediawiki"</span><span style="color: #007700">,<br />		];<br /><br />		</span><span style="color: #0000BB">$wgCentralNoticeMessageProtectRight </span><span style="color: #007700">= </span><span style="color: #DD0000">'banner-protect'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Set fundraising banners to use HTTPS on foundation wiki<br />	</span><span style="color: #0000BB">$wgNoticeFundraisingUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://donate.wikimedia.org/wiki/Special:LandingCheck'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Enable the CentralNotice/Translate integration<br />	</span><span style="color: #0000BB">$wgNoticeUseTranslateExtension </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// T51905<br />	</span><span style="color: #0000BB">$wgNoticeUseLanguageConversion </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// *** Hide Cookies ***<br />	// A little bit of historical breadcrumbs:<br />	// In 2012 we expired cookies on 2012-12-26, then everyone had<br />	// a two week expiration until 2013-01-22 whereupon we introduced<br />	// a year long expiration. For the 2013 fundraiser starting<br />	// 2013-12-02 we're now using a 10 month expiration.<br />	// For the 2014 fundraiser it's 250 days, though we can change it<br />	// retroactively as the cookie value now has a create date and reason.<br />	// 'close' duration is used for the banner X button<br />	// 'donate' duration is used for cookie set on Thank You page<br />	</span><span style="color: #0000BB">$wgNoticeCookieDurations </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'close' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">604800</span><span style="color: #007700">, </span><span style="color: #FF8000">// 1 week<br />		</span><span style="color: #DD0000">'donate' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">21600000</span><span style="color: #007700">, </span><span style="color: #FF8000">// 250 days<br />	</span><span style="color: #007700">];<br /><br />	</span><span style="color: #FF8000">// T18821<br />	// Updates made here also need to be reflected in<br />	// foundation.wikimedia.org/wiki/Template:HideBanners<br />	</span><span style="color: #0000BB">$wgNoticeHideUrls </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'//en.wikipedia.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//meta.wikimedia.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//commons.wikimedia.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//species.wikimedia.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//en.wikibooks.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//en.wikiquote.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//en.wikisource.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//en.wikinews.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//en.wikiversity.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'//www.mediawiki.org/w/index.php?title=Special:HideBanners'</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #FF8000">// Emit CSP headers on banner previews. This can go away when full CSP<br />	// support (T135963) is deployed.<br />	// www.pages04.net is used by Wikimedia Fundraising to enable 'remind me later' banner functionality, which submits email addresses to our email campaign vendor<br />	</span><span style="color: #0000BB">$wgCentralNoticeContentSecurityPolicy </span><span style="color: #007700">= </span><span style="color: #DD0000">"script-src 'unsafe-eval' blob: 'self' meta.wikimedia.org *.wikimedia.org *.wikipedia.org *.wikinews.org *.wiktionary.org *.wikibooks.org *.wikiversity.org *.wikisource.org wikisource.org *.wikiquote.org *.wikidata.org *.wikivoyage.org *.mediawiki.org 'unsafe-inline'; default-src 'self' data: blob: upload.wikimedia.org https://commons.wikimedia.org meta.wikimedia.org *.wikimedia.org *.wikipedia.org *.wikinews.org *.wiktionary.org *.wikibooks.org *.wikiversity.org *.wikisource.org wikisource.org *.wikiquote.org *.wikidata.org *.wikivoyage.org *.mediawiki.org wikimedia.org www.pages04.net; style-src 'self' data: blob: upload.wikimedia.org https://commons.wikimedia.org meta.wikimedia.org *.wikimedia.org *.wikipedia.org *.wikinews.org *.wiktionary.org *.wikibooks.org *.wikiversity.org *.wikisource.org wikisource.org *.wikiquote.org *.wikidata.org *.wikivoyage.org *.mediawiki.org wikimedia.org 'unsafe-inline';"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Load our site-specific l10n extension<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikimediaMessages' </span><span style="color: #007700">);<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'enwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Please don't interfere with our hundreds of wikis ability to manage themselves.<br />	// Only use this shitty hack for enwiki. Thanks.<br />	// -- brion 2008-04-10<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'getUserPermissionsErrorsExpensive'</span><span style="color: #007700">][] = static function ( &amp;</span><span style="color: #0000BB">$title</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$user</span><span style="color: #007700">, </span><span style="color: #0000BB">$action</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$result </span><span style="color: #007700">) {<br />		if ( </span><span style="color: #0000BB">$action </span><span style="color: #007700">!== </span><span style="color: #DD0000">'delete' </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$action </span><span style="color: #007700">!== </span><span style="color: #DD0000">'move' </span><span style="color: #007700">) {<br />			return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		}<br />		</span><span style="color: #0000BB">$main </span><span style="color: #007700">= </span><span style="color: #0000BB">Title</span><span style="color: #007700">::</span><span style="color: #0000BB">newMainPage</span><span style="color: #007700">();<br />		</span><span style="color: #0000BB">$mainText </span><span style="color: #007700">= </span><span style="color: #0000BB">$main</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getPrefixedDBkey</span><span style="color: #007700">();<br />		if ( </span><span style="color: #0000BB">$mainText </span><span style="color: #007700">=== </span><span style="color: #0000BB">$title</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getPrefixedDBkey</span><span style="color: #007700">() ) {<br />			</span><span style="color: #0000BB">$result </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'cant-delete-main-page' </span><span style="color: #007700">];<br />			return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />		}<br />		return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'enwiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'fawiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// T59569, T105118<br />	//<br />	// If it's an anonymous user creating a page in the English and Persian Wikipedia<br />	// Draft namespace, tell TitleQuickPermissions to abort the normal<br />	// checkQuickPermissions checks.  This lets anonymous users create a page in this<br />	// namespace, even though they don't have the general 'createpage' right.<br />	//<br />	// It does not affect other checks from getUserPermissionsErrorsInternal<br />	// (e.g. protection and blocking).<br />	//<br />	// Returning true tells it to proceed as normal in other cases.<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'TitleQuickPermissions'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">Title $title</span><span style="color: #007700">, </span><span style="color: #0000BB">User $user</span><span style="color: #007700">, </span><span style="color: #0000BB">$action</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$errors</span><span style="color: #007700">, </span><span style="color: #0000BB">$doExpensiveQueries</span><span style="color: #007700">, </span><span style="color: #0000BB">$short </span><span style="color: #007700">) {<br />		return ( </span><span style="color: #0000BB">$action </span><span style="color: #007700">!== </span><span style="color: #DD0000">'create' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$title</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getNamespace</span><span style="color: #007700">() !== </span><span style="color: #0000BB">118 </span><span style="color: #007700">|| !</span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">isAnon</span><span style="color: #007700">() );<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCollection </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// PediaPress / PDF generation<br />	// Intentionally loaded *before* the Wikisource extension below.<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Collection' </span><span style="color: #007700">);<br />	</span><span style="color: #FF8000">// Use pediapress server for POD function (T73675)<br />	</span><span style="color: #0000BB">$wgCollectionCommandToServeURL </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'zip_post' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'urldownloader'</span><span style="color: #007700">]}</span><span style="color: #DD0000">|https://pediapress.com/wmfup/"</span><span style="color: #007700">,<br />	];<br />	</span><span style="color: #0000BB">$wgCollectionPODPartners </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'pediapress' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'PediaPress'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://pediapress.com/'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'posturl' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://pediapress.com/api/collections/'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'infopagetitle' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'coll-order_info_article'</span><span style="color: #007700">,<br />		],<br />	];<br /><br />	</span><span style="color: #FF8000">// MediaWiki namespace is not a good default<br />	</span><span style="color: #0000BB">$wgCommunityCollectionNamespace </span><span style="color: #007700">= </span><span style="color: #0000BB">NS_PROJECT</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Allow collecting Help pages<br />	</span><span style="color: #0000BB">$wgCollectionArticleNamespaces</span><span style="color: #007700">[] = </span><span style="color: #0000BB">NS_HELP</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgCollectionFormats </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'rdf2latex' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'PDF'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'rdf2text' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'TXT'</span><span style="color: #007700">,<br />	];<br /><br />	if ( !</span><span style="color: #0000BB">$wmgUseElectronPdfService </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCollectionShowRenderNotes</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'coll-rendering_finished_note_article_rdf2latex'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">$wgCollectionPortletForLoggedInUsersOnly </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCollectionPortletForLoggedInUsersOnly</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCollectionArticleNamespaces </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCollectionArticleNamespaces</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCollectionPortletFormats </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCollectionPortletFormats</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseElectronPdfService </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ElectronPdfService' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'AdvancedSearch' </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000"># Various system to allow/prevent flooding<br /># (including exemptions for scheduled outreach events)<br /></span><span style="color: #007700">require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/throttle.php'</span><span style="color: #007700">;<br />require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/throttle-analyze.php'</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseNewUserMessage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'NewUserMessage' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgNewUserSuppressRC </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgNewUserMinorEdit </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgNewUserMinorEdit</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgNewUserMessageOnAutoCreate </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgNewUserMessageOnAutoCreate</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCodeReview </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CodeReview' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-add-tag'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-remove-tag'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-post-comment'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-set-status'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-link-user'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-signoff'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'codereview-associate'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgCodeReviewRepoStatsCacheTime </span><span style="color: #007700">= </span><span style="color: #0000BB">24 </span><span style="color: #007700">* </span><span style="color: #0000BB">60 </span><span style="color: #007700">* </span><span style="color: #0000BB">60</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCodeReviewMaxDiffPaths </span><span style="color: #007700">= </span><span style="color: #0000BB">100</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Delist the deprecated special page.<br />	</span><span style="color: #0000BB">$wgCodeReviewListSpecialPage </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># AbuseFilter<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'AbuseFilter' </span><span style="color: #007700">);<br />include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/abusefilter.php'</span><span style="color: #007700">;<br />if ( </span><span style="color: #0000BB">$wmgUseGlobalAbuseFilters </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgAbuseFilterCentralDB </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgAbuseFilterCentralDB</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgAbuseFilterIsCentral </span><span style="color: #007700">= ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #0000BB">$wgAbuseFilterCentralDB </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000"># PdfHandler<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUsePdfHandler </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'PdfHandler' </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">$wmgUsePdfHandlerShellbox </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-media'</span><span style="color: #007700">] ) {<br />		</span><span style="color: #FF8000">// Route pdfhandler to the Shellbox named "shellbox-media".<br />		</span><span style="color: #0000BB">$wgShellboxUrls</span><span style="color: #007700">[</span><span style="color: #DD0000">'pdfhandler'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'shellbox-media'</span><span style="color: #007700">];<br />		</span><span style="color: #FF8000">// $wgShellboxSecretKey set in PrivateSettings.php<br />	</span><span style="color: #007700">} else {<br />		</span><span style="color: #0000BB">$wgPdfProcessor </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/local/bin/mediawiki-firejail-ghostscript'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgPdfPostProcessor </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/local/bin/mediawiki-firejail-convert'</span><span style="color: #007700">;<br />	}<br />}<br /><br /></span><span style="color: #FF8000"># WikiEditor<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikiEditor' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'usebetatoolbar'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgEnableLandingCheck </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'LandingCheck' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgPriorityCountries </span><span style="color: #007700">= [<br />		</span><span style="color: #FF8000">// === Fundraising Chapers<br />		</span><span style="color: #DD0000">'DE'</span><span style="color: #007700">, </span><span style="color: #DD0000">'CH'</span><span style="color: #007700">,<br /><br />		</span><span style="color: #FF8000">// === Blacklisted countries<br />		</span><span style="color: #DD0000">'BY'</span><span style="color: #007700">, </span><span style="color: #DD0000">'CD'</span><span style="color: #007700">, </span><span style="color: #DD0000">'CI'</span><span style="color: #007700">, </span><span style="color: #DD0000">'CU'</span><span style="color: #007700">, </span><span style="color: #DD0000">'IQ'</span><span style="color: #007700">, </span><span style="color: #DD0000">'IR'</span><span style="color: #007700">, </span><span style="color: #DD0000">'KP'</span><span style="color: #007700">, </span><span style="color: #DD0000">'LB'</span><span style="color: #007700">, </span><span style="color: #DD0000">'LY'</span><span style="color: #007700">, </span><span style="color: #DD0000">'MM'</span><span style="color: #007700">, </span><span style="color: #DD0000">'SD'</span><span style="color: #007700">, </span><span style="color: #DD0000">'SO'</span><span style="color: #007700">, </span><span style="color: #DD0000">'SY'</span><span style="color: #007700">, </span><span style="color: #DD0000">'YE'</span><span style="color: #007700">, </span><span style="color: #DD0000">'ZW'</span><span style="color: #007700">,<br />	];<br />	</span><span style="color: #0000BB">$wgLandingCheckPriorityURLBase </span><span style="color: #007700">= </span><span style="color: #DD0000">"//foundation.wikimedia.org/wiki/Special:LandingCheck"</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgLandingCheckNormalURLBase </span><span style="color: #007700">= </span><span style="color: #DD0000">"//donate.wikimedia.org/wiki/Special:LandingCheck"</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgEnableFundraiserLandingPage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'FundraiserLandingPage' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseLiquidThreads </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgLiquidThreadsFrozen </span><span style="color: #007700">) {<br />	require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/liquidthreads.php'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGlobalUsage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GlobalUsage' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGlobalUsageDatabase </span><span style="color: #007700">= </span><span style="color: #DD0000">'commonswiki'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGlobalUsageSharedRepoWiki </span><span style="color: #007700">= </span><span style="color: #DD0000">'commonswiki'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGlobalUsagePurgeBacklinks </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseLivePreview </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'uselivepreview'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TemplateStyles' </span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// allow protocol-relative URLs per T188760<br /></span><span style="color: #0000BB">$wgTemplateStylesAllowedUrls </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'audio' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #DD0000">'&lt;^(?:https:)?//upload\\.wikimedia\\.org/wikipedia/commons/&gt;'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'image' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #DD0000">'&lt;^(?:https:)?//upload\\.wikimedia\\.org/wikipedia/commons/&gt;'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'svg' </span><span style="color: #007700">=&gt; [<br />		</span><span style="color: #DD0000">'&lt;^(?:https:)?//upload\\.wikimedia\\.org/wikipedia/commons/[^?#]*\\.svg(?:[?#]|$)&gt;'</span><span style="color: #007700">,<br />	],<br />	</span><span style="color: #DD0000">'font' </span><span style="color: #007700">=&gt; [],<br />	</span><span style="color: #DD0000">'namespace' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'&lt;.&gt;' </span><span style="color: #007700">],<br />	</span><span style="color: #DD0000">'css' </span><span style="color: #007700">=&gt; [],<br />];<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CodeMirror' </span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Temporary feature flag for the CodeMirror colorblind-friendly color scheme option see T306867<br /></span><span style="color: #0000BB">$wgCodeMirrorColorblindColors </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Must be loaded BEFORE VisualEditor, or things will break<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseArticleCreationWorkflow </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ArticleCreationWorkflow' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'thumbsize'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgThumbsizeIndex</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'showhiddencats'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgShowHiddenCats</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchcreations'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Temporary override: WMF is not hardcore enough to enable this.<br />// See T37785, T38316, T47022 about it.<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgWatchlistDefault </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchdefault'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchdefault'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgWatchMoves </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchmoves'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchmoves'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgWatchRollback </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchrollback'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchrollback'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'enotifminoredits'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgEnotifMinorEditsUserDefault</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'enotifwatchlistpages'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgEnhancedRecentChanges </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'usenewrc'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'usenewrc'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgEnhancedWatchlist </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'extendwatchlist'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'extendwatchlist'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgForceEditSummary </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'forceeditsummary'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'forceeditsummary'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgShowWikidataInWatchlist </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'wlshowwikibase'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />} else {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'wlshowwikibase'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMassMessage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MassMessage' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSandboxLink </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SandboxLink' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseUploadWizard </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'UploadWizard' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgUploadStashScalerBaseUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">"//</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgHostnames</span><span style="color: #007700">[</span><span style="color: #DD0000">'upload'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/</span><span style="color: #0000BB">$site</span><span style="color: #DD0000">/</span><span style="color: #0000BB">$lang</span><span style="color: #DD0000">/thumb/temp"</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgUploadWizardConfig </span><span style="color: #007700">= [<br />		</span><span style="color: #FF8000"># 'debug' =&gt; true,<br />		// Normally we don't include API keys in CommonSettings, but this key<br />		// isn't private since it's used on the client-side, i.e. anyone can see<br />		// it in the outgoing AJAX requests to Flickr.<br />		</span><span style="color: #DD0000">'flickrApiKey' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'e9d8174a79c782745289969a45d350e8'</span><span style="color: #007700">,<br />		</span><span style="color: #FF8000">// Slowwwwwwww<br />		</span><span style="color: #DD0000">'campaignExpensiveStatsEnabled' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'licensing' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'thirdParty' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'licenseGroups' </span><span style="color: #007700">=&gt; [<br />					[<br />						</span><span style="color: #FF8000">// This should be a list of all CC licenses we can reasonably expect to find around the web<br />						</span><span style="color: #DD0000">'head' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-cc-head'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'subhead' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-cc-subhead'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'licenses' </span><span style="color: #007700">=&gt; [<br />							</span><span style="color: #DD0000">'cc-by-sa-4.0'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-by-sa-3.0'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-by-sa-2.5'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-by-4.0'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-by-3.0'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-by-2.5'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-zero'<br />						</span><span style="color: #007700">]<br />					],<br />					[<br />						</span><span style="color: #FF8000">// n.b. as of April 2011, Flickr still uses CC 2.0 licenses.<br />						// The White House also has an account there, hence the Public Domain US Government license<br />						</span><span style="color: #DD0000">'head' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-flickr-head'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'subhead' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-flickr-subhead'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'prependTemplates' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'flickrreview' </span><span style="color: #007700">],<br />						</span><span style="color: #DD0000">'licenses' </span><span style="color: #007700">=&gt; [<br />							</span><span style="color: #DD0000">'cc-by-sa-2.0'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'cc-by-2.0'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'pd-usgov'</span><span style="color: #007700">,<br />						]<br />					],<br />					[<br />						</span><span style="color: #DD0000">'head' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-public-domain-usa-head'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'subhead' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-public-domain-usa-subhead'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'licenses' </span><span style="color: #007700">=&gt; [<br />							</span><span style="color: #DD0000">'pd-us'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'pd-old-70-expired'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'pd-art'</span><span style="color: #007700">,<br />						]<br />					],<br />					[<br />						</span><span style="color: #DD0000">'head' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-usgov-head'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'licenses' </span><span style="color: #007700">=&gt; [<br />							</span><span style="color: #DD0000">'pd-usgov'</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'pd-usgov-nasa'<br />						</span><span style="color: #007700">]<br />					],<br />					[<br />						</span><span style="color: #DD0000">'head' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-custom-head'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'special' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'custom'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'licenses' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'custom' </span><span style="color: #007700">],<br />					],<br />					[<br />						</span><span style="color: #DD0000">'head' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mwe-upwiz-license-none-head'</span><span style="color: #007700">,<br />						</span><span style="color: #DD0000">'licenses' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'none' </span><span style="color: #007700">]<br />					],<br />				],<br />			],<br />		],<br />	];<br /><br />	</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'enableChunked'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'opt-in'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'altUploadForm'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgAltUploadForm</span><span style="color: #007700">; </span><span style="color: #FF8000">// T35513<br /><br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'testwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'feedbackPage'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Prototype_upload_wizard_feedback'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">"missingCategoriesWikiText"</span><span style="color: #007700">] = </span><span style="color: #DD0000">'&lt;p&gt;&lt;span class="errorbox"&gt;&lt;b&gt;Hey, no categories?&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;'</span><span style="color: #007700">;<br />		unset( </span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'fallbackToAltUploadForm'</span><span style="color: #007700">] );<br />	} elseif ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'feedbackPage'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Commons:Upload_Wizard_feedback'</span><span style="color: #007700">; </span><span style="color: #FF8000"># Set by neilk, 2011-11-01, per erik<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">"missingCategoriesWikiText"</span><span style="color: #007700">] = </span><span style="color: #DD0000">"{{subst:unc}}"</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'flickrBlacklistPage'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'User:FlickreviewR/bad-authors'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'customLicenseTemplate'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Template:License_template_tag'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Enable Structured Data captions on upload<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseWikibaseMediaInfo </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikibase'</span><span style="color: #007700">][</span><span style="color: #DD0000">'enabled'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgUploadWizardConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikibase'</span><span style="color: #007700">][</span><span style="color: #DD0000">'statements'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgMediaInfoEnableUploadWizardStatements</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMediaSearch </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MediaSearch' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgCustomUploadDialog </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgUploadDialog </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'fields' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'description' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'date' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'categories' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'licensemessages' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #FF8000">// Messages defined in WikimediaMessages: upload-form-label-own-work-message-commons,<br />			// upload-form-label-not-own-work-message-commons, upload-form-label-not-own-work-local-commons<br />			</span><span style="color: #DD0000">'local' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">? </span><span style="color: #DD0000">'commons' </span><span style="color: #007700">: </span><span style="color: #DD0000">'generic-local'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'foreign' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">? </span><span style="color: #DD0000">'commons' </span><span style="color: #007700">: </span><span style="color: #DD0000">'generic-foreign'</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'comment' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Uploaded while editing "$PAGENAME" on $HOST'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'format' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'filepage' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'== {{int:filedesc}} ==<br />{{Information<br />|description=$DESCRIPTION<br />|date=$DATE<br />|source=$SOURCE<br />|author=$AUTHOR<br />}}<br /><br />== {{int:license-header}} ==<br />$LICENSE<br /><br />$CATEGORIES<br />'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'description' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'{{$LANGUAGE|1=$TEXT}}'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'ownwork' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'{{own}}'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'license' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'{{self|cc-by-sa-4.0}}'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'uncategorized' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'{{subst:unc}}'</span><span style="color: #007700">,<br />		],<br />	];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseBetaFeatures </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'BetaFeatures' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCommonsMetadata </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CommonsMetadata' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgCommonsMetadataSetTrackingCategories </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCommonsMetadataForceRecalculate </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgCommonsMetadataForceRecalculate</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGWToolset </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GWToolset' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGWTFileBackend </span><span style="color: #007700">= </span><span style="color: #DD0000">'local-multiwrite'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// extra throttling until the image scalers are more robust<br />	</span><span style="color: #0000BB">$wgGWToolsetConfigOverrides</span><span style="color: #007700">[</span><span style="color: #DD0000">'mediafile_job_throttle_default'</span><span style="color: #007700">] = </span><span style="color: #0000BB">5</span><span style="color: #007700">; </span><span style="color: #FF8000">// 5 files per batch<br />	</span><span style="color: #0000BB">$wgJobBackoffThrottling</span><span style="color: #007700">[</span><span style="color: #DD0000">'gwtoolsetUploadMetadataJob'</span><span style="color: #007700">] = </span><span style="color: #0000BB">5 </span><span style="color: #007700">/ </span><span style="color: #0000BB">3600</span><span style="color: #007700">; </span><span style="color: #FF8000">// 5 batches per hour<br /></span><span style="color: #007700">}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMultimediaViewer </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MultimediaViewer' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUsePopups </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Popups' </span><span style="color: #007700">);<br /><br />	if ( </span><span style="color: #0000BB">$wmgPopupsReferencePreviews </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgPopupsReferencePreviews </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgPopupsReferencePreviewsBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseLinter </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Linter' </span><span style="color: #007700">);<br />}<br /><br />if ( !isset( </span><span style="color: #0000BB">$wgVirtualRestConfig </span><span style="color: #007700">) &amp;&amp; ( </span><span style="color: #0000BB">$wmgUseRestbaseVRS </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseParsoid </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseCollection </span><span style="color: #007700">) ) {<br />	</span><span style="color: #0000BB">$wgVirtualRestConfig </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'modules' </span><span style="color: #007700">=&gt; [],<br />		</span><span style="color: #DD0000">'global' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'domain' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgCanonicalServer</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'timeout' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">360</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'forwardCookies' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'HTTPProxy' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,<br />		]<br />	];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseRestbaseVRS </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgVirtualRestConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'modules'</span><span style="color: #007700">][</span><span style="color: #DD0000">'restbase'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'restbase'</span><span style="color: #007700">],<br />		</span><span style="color: #DD0000">'domain' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgCanonicalServer</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'forwardCookies' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'parsoidCompat' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false<br />	</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseParsoid </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wmgParsoidURL </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'parsoid'</span><span style="color: #007700">];<br /><br />	</span><span style="color: #0000BB">$wgVirtualRestConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'modules'</span><span style="color: #007700">][</span><span style="color: #DD0000">'parsoid'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgParsoidURL</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">, </span><span style="color: #FF8000">// The wiki prefix to use; deprecated<br />		</span><span style="color: #DD0000">'domain' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wgCanonicalServer</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'forwardCookies' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgParsoidForwardCookies</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'restbaseCompat' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false<br />	</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCollection </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgVirtualRestConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'modules'</span><span style="color: #007700">][</span><span style="color: #DD0000">'electron'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'electron'</span><span style="color: #007700">],<br />		</span><span style="color: #DD0000">'options' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'accessKey' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgElectronSecret</span><span style="color: #007700">, </span><span style="color: #FF8000">// set in private repo<br />		</span><span style="color: #007700">],<br />	];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseVisualEditor </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'VisualEditor' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// RESTBase connection configuration is done by $wmgUseRestbaseVRS above.<br />	// Parsoid connection configuration is done by $wmgUseParsoid above.<br />	// At least one of these should be set if you want to use Visual Editor.<br />	</span><span style="color: #0000BB">$wgVisualEditorParsoidAutoConfig </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// RESTBase connection configuration<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgVisualEditorAccessRestbaseDirectly </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorRestbaseURL </span><span style="color: #007700">= </span><span style="color: #DD0000">"/api/rest_v1/page/html/"</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgVisualEditorFullRestbaseURL </span><span style="color: #007700">= </span><span style="color: #DD0000">"/api/rest_"</span><span style="color: #007700">;<br />		</span><span style="color: #FF8000">// There should be no lossy switching in RESTBase mode, but just in case<br />		</span><span style="color: #0000BB">$wgVisualEditorAllowLossySwitching </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	} else {<br />		if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labswiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />			</span><span style="color: #FF8000">// (T241961) Just for wikitech, load the Parsoid extension and<br />			// use VisualEditor auto-config. (Yes, this is a bit of a hack,<br />			// and it exposes Parsoid's REST API, but ensures that Parsoid<br />			// 'extension' code is kept in sync with core.)<br />			</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Parsoid'</span><span style="color: #007700">, </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/vendor/wikimedia/parsoid/extension.json" </span><span style="color: #007700">);<br />			</span><span style="color: #FF8000">// Note that wgVirtualRestConfig['modules']['parsoid'] isn't set as wmgUseParsoid is false<br />			</span><span style="color: #0000BB">$wgVisualEditorParsoidAutoConfig </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		}<br />		</span><span style="color: #FF8000">// Prefer lossy switching (dirty diffs) to not being able to switch editors<br />		</span><span style="color: #0000BB">$wgVisualEditorAllowLossySwitching </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Tab configuration<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgVisualEditorUseSingleEditTab </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorUseSingleEditTab </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgVisualEditorSingleEditTabSwitchTime </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgVisualEditorSingleEditTabSwitchTime</span><span style="color: #007700">;<br />	}<br />	if ( </span><span style="color: #0000BB">$wmgVisualEditorIsSecondaryEditor </span><span style="color: #007700">) {<br />		if ( !</span><span style="color: #0000BB">$wmgVisualEditorUseSingleEditTab </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$wgVisualEditorTabPosition </span><span style="color: #007700">= </span><span style="color: #DD0000">'after'</span><span style="color: #007700">;<br />		}<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'visualeditor-editor'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'wikitext'</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'visualeditor-editor'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'visualeditor'</span><span style="color: #007700">;<br />	}<br />	if ( </span><span style="color: #0000BB">$wmgVisualEditorEnableWikitext </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorEnableWikitext </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'visualeditor-newwikitext'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgVisualEditorEnableVisualSectionEditing </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorEnableVisualSectionEditing </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgVisualEditorEnableVisualSectionEditing</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Namespace configuration<br />	</span><span style="color: #0000BB">$wgVisualEditorAvailableNamespaces </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgVisualEditorAvailableNamespaces</span><span style="color: #007700">;<br />	if ( !isset( </span><span style="color: #0000BB">$wgVisualEditorAvailableNamespaces </span><span style="color: #007700">) ) {<br />		</span><span style="color: #0000BB">$wgVisualEditorAvailableNamespaces </span><span style="color: #007700">= []; </span><span style="color: #FF8000">// Set null to be an empty array to avoid fatals<br />	</span><span style="color: #007700">}<br /><br />	</span><span style="color: #FF8000">// User access configuration<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgVisualEditorDefault </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'visualeditor-enable'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'visualeditor-enable'</span><span style="color: #007700">] = </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgVisualEditorEnableBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />	if ( </span><span style="color: #0000BB">$wmgVisualEditorTransitionDefault </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorTransitionDefault </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />	if ( </span><span style="color: #0000BB">$wmgVisualEditorAllowExternalLinkPaste </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorAllowExternalLinkPaste </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #FF8000">// T52000 - to remove once roll-out is complete.<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgVisualEditorDisableForAnons </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorDisableForAnons </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Feedback configuration<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgVisualEditorConsolidateFeedback </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgVisualEditorFeedbackAPIURL </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://www.mediawiki.org/w/api.php'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgVisualEditorFeedbackTitle </span><span style="color: #007700">= </span><span style="color: #DD0000">'VisualEditor/Feedback'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgVisualEditorSourceFeedbackTitle </span><span style="color: #007700">= </span><span style="color: #DD0000">'2017 wikitext editor/Feedback'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Citoid<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Citoid' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// Move the citation button from the primary toolbar into the "other" group<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgCiteVisualEditorOtherGroup </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCiteVisualEditorOtherGroup </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Enable the wikitext mode Beta Feature for opt-in<br />	</span><span style="color: #0000BB">$wgVisualEditorEnableWikitextBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Enable the diff page visual diff Beta Feature for opt-in<br />	</span><span style="color: #0000BB">$wgVisualEditorEnableDiffPageBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTemplateData </span><span style="color: #007700">) { </span><span style="color: #FF8000">// T61702 - 2015-07-20<br />	// TemplateData enabled for all wikis - 2014-09-29<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TemplateData' </span><span style="color: #007700">);<br />	</span><span style="color: #FF8000">// TemplateData GUI enabled for all wikis - 2014-11-06<br />	</span><span style="color: #0000BB">$wgTemplateDataUseGUI </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// TemplateWizard enabled for all TemplateData wikis – T202545<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TemplateWizard' </span><span style="color: #007700">);<br /><br />	if ( </span><span style="color: #0000BB">$wmgTemplateDataSuggestedValues </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgTemplateDataSuggestedValuesEditor </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgTemplateSearchImprovements </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgVisualEditorTemplateSearchImprovements </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTemplateWizardTemplateSearchImprovements </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGoogleNewsSitemap </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GoogleNewsSitemap' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGNSMfallbackCategory </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgGNSMfallbackCategory</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGNSMcommentNamespace </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgGNSMcommentNamespace</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCLDR </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'cldr' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseIncubator </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikimediaIncubator' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wmincClosedWikis </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgSiteMatrixClosedSites</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikiLove </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikiLove' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgWikiLoveLogging </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikilove-enabled'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGuidedTour </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GuidedTour' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMobileApp </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MobileApp' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000"># Mobile related configuration<br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MobileFrontend' </span><span style="color: #007700">);<br /></span><span style="color: #0000BB">wfLoadSkin</span><span style="color: #007700">( </span><span style="color: #DD0000">'MinervaNeue' </span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$wgMFMobileHeader </span><span style="color: #007700">= </span><span style="color: #DD0000">'X-Subdomain'</span><span style="color: #007700">;<br />if ( !</span><span style="color: #0000BB">$wmgEnableGeoData </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgMFNearby </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'EnterMobileMode'</span><span style="color: #007700">][] = static function () {<br />	global </span><span style="color: #0000BB">$wgCentralAuthCookieDomain</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgIncludeLegacyJavaScript</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Disable loading of legacy wikibits in the mobile web experience<br />	</span><span style="color: #0000BB">$wgIncludeLegacyJavaScript </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Hack for T49647<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">== </span><span style="color: #DD0000">'commons.wikimedia.org' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">'commons.m.wikimedia.org'</span><span style="color: #007700">;<br />	} elseif ( </span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">== </span><span style="color: #DD0000">'meta.wikimedia.org' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCentralAuthCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">'meta.m.wikimedia.org'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Better hack for T49647<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'WebResponseSetCookie'</span><span style="color: #007700">][] = static function ( &amp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$value</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$expire</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$options </span><span style="color: #007700">) {<br />		if ( isset( </span><span style="color: #0000BB">$options</span><span style="color: #007700">[</span><span style="color: #DD0000">'domain'</span><span style="color: #007700">] ) ) {<br />			if ( </span><span style="color: #0000BB">$options</span><span style="color: #007700">[</span><span style="color: #DD0000">'domain'</span><span style="color: #007700">] == </span><span style="color: #DD0000">'commons.wikimedia.org' </span><span style="color: #007700">) {<br />				</span><span style="color: #0000BB">$options</span><span style="color: #007700">[</span><span style="color: #DD0000">'domain'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'commons.m.wikimedia.org'</span><span style="color: #007700">;<br />			} elseif ( </span><span style="color: #0000BB">$options</span><span style="color: #007700">[</span><span style="color: #DD0000">'domain'</span><span style="color: #007700">] == </span><span style="color: #DD0000">'meta.wikimedia.org' </span><span style="color: #007700">) {<br />				</span><span style="color: #0000BB">$options</span><span style="color: #007700">[</span><span style="color: #DD0000">'domain'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'meta.m.wikimedia.org'</span><span style="color: #007700">;<br />			}<br />		}<br />	};<br /><br />	return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />};<br /><br /></span><span style="color: #0000BB">$wgMFNearbyRange </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgMaxGeoSearchRadius</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Turn on volunteer recruitment<br /></span><span style="color: #0000BB">$wgMFEnableJSConsoleRecruitment </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Brute-force bandwidth optimization by stripping srcset (T119797)<br /></span><span style="color: #0000BB">$wgMFStripResponsiveImages </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgMFDefaultEditor </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgMFDefaultEditor </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgMFDefaultEditor</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># MUST be after MobileFrontend initialization<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgEnableTextExtracts </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TextExtracts' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSubPageList3 </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SubPageList3' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// Serve 'Powered by MediaWiki' badge from /static/images instead of<br />// $wgResourceBasePath so we can set far-future expires.<br /></span><span style="color: #0000BB">$wgFooterIcons</span><span style="color: #007700">[</span><span style="color: #DD0000">'poweredby'</span><span style="color: #007700">][</span><span style="color: #DD0000">'mediawiki'</span><span style="color: #007700">][</span><span style="color: #DD0000">'src'</span><span style="color: #007700">] =<br />	   </span><span style="color: #0000BB">$wmgPoweredByMediaWikiIcon</span><span style="color: #007700">[</span><span style="color: #DD0000">'1x'</span><span style="color: #007700">];<br /></span><span style="color: #0000BB">$wgFooterIcons</span><span style="color: #007700">[</span><span style="color: #DD0000">'poweredby'</span><span style="color: #007700">][</span><span style="color: #DD0000">'mediawiki'</span><span style="color: #007700">][</span><span style="color: #DD0000">'srcset'</span><span style="color: #007700">] =<br />	   </span><span style="color: #0000BB">$wmgPoweredByMediaWikiIcon</span><span style="color: #007700">[</span><span style="color: #DD0000">'1.5x'</span><span style="color: #007700">] . </span><span style="color: #DD0000">' 1.5x, ' </span><span style="color: #007700">.<br />	   </span><span style="color: #0000BB">$wmgPoweredByMediaWikiIcon</span><span style="color: #007700">[</span><span style="color: #DD0000">'2x'</span><span style="color: #007700">] . </span><span style="color: #DD0000">' 2x'</span><span style="color: #007700">;<br /><br />if ( isset( </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_X_FORWARDED_PROTO'</span><span style="color: #007700">] ) &amp;&amp; </span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTP_X_FORWARDED_PROTO'</span><span style="color: #007700">] == </span><span style="color: #DD0000">'https' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgCookieSecure </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">'HTTPS'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'on'</span><span style="color: #007700">; </span><span style="color: #FF8000">// Fake this so MW goes into HTTPS mode<br /></span><span style="color: #007700">}<br /></span><span style="color: #0000BB">$wgVaryOnXFP </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgCookieExpiration </span><span style="color: #007700">= </span><span style="color: #0000BB">30 </span><span style="color: #007700">* </span><span style="color: #0000BB">86400</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgExtendedLoginCookieExpiration </span><span style="color: #007700">= </span><span style="color: #0000BB">365 </span><span style="color: #007700">* </span><span style="color: #0000BB">86400</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMath </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Math' </span><span style="color: #007700">);<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseMathML </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseRestbaseVRS </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'math'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'mathml'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// This variable points to non-WMF servers by default.<br />	// Prevent accidental use.<br />	</span><span style="color: #0000BB">$wgMathLaTeXMLUrl </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgMathMathMLUrl </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'mathoid'</span><span style="color: #007700">];<br />	</span><span style="color: #FF8000">// Increase the number of concurrent connections made to RESTBase<br />	</span><span style="color: #0000BB">$wgMathConcurrentReqs </span><span style="color: #007700">= </span><span style="color: #0000BB">150</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Set up $wgMathFullRestbaseURL - similar to VE RESTBase config above<br />	// HACK: $wgServerName is not available yet at this point, it's set by Setup.php<br />	// so use a hook<br />	</span><span style="color: #0000BB">$wgExtensionFunctions</span><span style="color: #007700">[] = static function () {<br />		global </span><span style="color: #0000BB">$wgServerName</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgMathFullRestbaseURL</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgRealm</span><span style="color: #007700">;<br /><br />		</span><span style="color: #0000BB">$wgMathFullRestbaseURL </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'production'<br />			</span><span style="color: #007700">? </span><span style="color: #DD0000">'https://wikimedia.org/api/rest_'  </span><span style="color: #FF8000">// T136205<br />			</span><span style="color: #007700">: </span><span style="color: #DD0000">"//</span><span style="color: #0000BB">$wgServerName</span><span style="color: #DD0000">/api/rest_"</span><span style="color: #007700">;<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseBabel </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Babel' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgBabelCategoryNames </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgBabelCategoryNames</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBabelMainCategory </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgBabelMainCategory</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBabelDefaultLevel </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgBabelDefaultLevel</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBabelUseUserLanguage </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgBabelUseUserLanguage</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgBabelUseDatabase </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgBabelCentralDb </span><span style="color: #007700">= </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgBabelCentralApi </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://meta.wikimedia.org/w/api.php'</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseBounceHandler </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'BounceHandler' </span><span style="color: #007700">);<br />	</span><span style="color: #FF8000">// $wmgVERPsecret is set in PrivateSettings.php<br />	</span><span style="color: #0000BB">$wgVERPsecret </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgVERPsecret</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgVERPdomainPart </span><span style="color: #007700">= </span><span style="color: #DD0000">'wikimedia.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBounceHandlerUnconfirmUsers </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBounceRecordLimit </span><span style="color: #007700">= </span><span style="color: #0000BB">5</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBounceHandlerCluster </span><span style="color: #007700">= </span><span style="color: #DD0000">'extension1'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBounceHandlerSharedDB </span><span style="color: #007700">= </span><span style="color: #DD0000">'wikishared'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgBounceHandlerInternalIPs </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'208.80.154.76'</span><span style="color: #007700">,			  </span><span style="color: #FF8000"># mx1001<br />		</span><span style="color: #DD0000">'2620:0:861:3:208:80:154:76'</span><span style="color: #007700">, </span><span style="color: #FF8000"># mx1001<br />		</span><span style="color: #DD0000">'208.80.153.45'</span><span style="color: #007700">,			  </span><span style="color: #FF8000"># mx2001<br />		</span><span style="color: #DD0000">'2620:0:860:2:208:80:153:45'</span><span style="color: #007700">, </span><span style="color: #FF8000"># mx2001<br />	</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTranslate </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Translate' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'*'</span><span style="color: #007700">][</span><span style="color: #DD0000">'translate'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'pagetranslation'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'translate-manage'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'translate-import'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T42341<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'pagelang'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T153209<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'translate-messagereview'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'translate-groupreview'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'pagelang'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T153209<br />	</span><span style="color: #0000BB">$wgAddGroups</span><span style="color: #007700">[</span><span style="color: #DD0000">'bureaucrat'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T178793<br />	</span><span style="color: #0000BB">$wgRemoveGroups</span><span style="color: #007700">[</span><span style="color: #DD0000">'bureaucrat'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T178793<br />	</span><span style="color: #0000BB">$wgGroupsAddToSelf</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T178793<br />	</span><span style="color: #0000BB">$wgGroupsRemoveFromSelf</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'translationadmin'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T178793<br /><br />	</span><span style="color: #0000BB">$wgTranslateDocumentationLanguageCode </span><span style="color: #007700">= </span><span style="color: #DD0000">'qqq'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgExtraLanguageNames</span><span style="color: #007700">[</span><span style="color: #DD0000">'qqq'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Message documentation'</span><span style="color: #007700">; </span><span style="color: #FF8000"># No linguistic content. Used for documenting messages<br /><br />	</span><span style="color: #0000BB">$wgPageLanguageUseDB </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T153209<br /><br />	</span><span style="color: #0000BB">$wgTranslateTranslationServices </span><span style="color: #007700">= [];<br />	if ( </span><span style="color: #0000BB">$wmgUseTranslationMemory </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// Switch to 'eqiad' or 'codfw' if you plan to bring down<br />		// the elastic cluster equals to $wmgDatacenter<br />		</span><span style="color: #0000BB">$wgTranslateTranslationDefaultService </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgDatacenter</span><span style="color: #007700">;<br /><br />		</span><span style="color: #FF8000">// If the downtime is long (&gt; 10mins) consider disabling<br />		// mirroring in this var to avoid logspam about ttm updates<br />		// then plan to refresh this index via ttmserver-export when<br />		// it's back up.<br />		// NOTE: these settings are also used for the labs cluster<br />		// where codfw may not be available<br />		</span><span style="color: #0000BB">$wgTranslateClustersAndMirrors </span><span style="color: #007700">= [<br />			</span><span style="color: #DD0000">'eqiad' </span><span style="color: #007700">=&gt; isset( </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'codfw'</span><span style="color: #007700">][</span><span style="color: #DD0000">'search-chi'</span><span style="color: #007700">] ) ? [ </span><span style="color: #DD0000">'codfw' </span><span style="color: #007700">] : [],<br />			</span><span style="color: #DD0000">'codfw' </span><span style="color: #007700">=&gt; isset( </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'eqiad'</span><span style="color: #007700">][</span><span style="color: #DD0000">'search-chi'</span><span style="color: #007700">] ) ? [ </span><span style="color: #DD0000">'eqiad' </span><span style="color: #007700">] : [],<br />		];<br />		foreach ( </span><span style="color: #0000BB">$wgTranslateClustersAndMirrors </span><span style="color: #007700">as </span><span style="color: #0000BB">$cluster </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$mirrors </span><span style="color: #007700">) {<br />			if ( !isset( </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #0000BB">$cluster</span><span style="color: #007700">][</span><span style="color: #DD0000">'search-chi'</span><span style="color: #007700">] ) ) {<br />				continue;<br />			}<br />			</span><span style="color: #0000BB">$wgTranslateTranslationServices</span><span style="color: #007700">[</span><span style="color: #0000BB">$cluster</span><span style="color: #007700">] = [<br />				</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'ttmserver'</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'ElasticSearchTTMServer'</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'shards' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'replicas' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'index' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgTranslateESIndex</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'cutoff' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0.65</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'use_wikimedia_extra' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'config' </span><span style="color: #007700">=&gt; [<br />					</span><span style="color: #DD0000">'servers' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">array_map</span><span style="color: #007700">( static function ( </span><span style="color: #0000BB">$hostConfig </span><span style="color: #007700">) {<br />						if ( </span><span style="color: #0000BB">is_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$hostConfig </span><span style="color: #007700">) ) {<br />							return </span><span style="color: #0000BB">$hostConfig</span><span style="color: #007700">;<br />						}<br />						return [<br />							</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$hostConfig</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'port' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">9243</span><span style="color: #007700">,<br />							</span><span style="color: #DD0000">'transport' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Https'</span><span style="color: #007700">,<br />						];<br />					}, </span><span style="color: #0000BB">$wmgAllServices</span><span style="color: #007700">[</span><span style="color: #0000BB">$cluster</span><span style="color: #007700">][</span><span style="color: #DD0000">'search-chi'</span><span style="color: #007700">] ),<br />				],<br />				</span><span style="color: #DD0000">'mirrors' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$mirrors</span><span style="color: #007700">,<br />			];<br />		}<br />		unset( </span><span style="color: #0000BB">$wgTranslateClustersAndMirrors </span><span style="color: #007700">);<br />	} else {<br />		</span><span style="color: #0000BB">$wgTranslateTranslationDefaultService </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">$wgTranslateWorkflowStates </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgTranslateWorkflowStates</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTranslateRcFilterDefault </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgTranslateRcFilterDefault</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgTranslateUsePreSaveTransform </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T39304<br /><br />	</span><span style="color: #0000BB">$wgEnablePageTranslation </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgTranslateDelayedMessageIndexRebuild </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Deprecated language codes<br />	</span><span style="color: #0000BB">$wgTranslateDisabledTargetLanguages </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'*' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'gan-hans' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in gan please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'gan-hant' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in gan please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'ike-cans' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in iu please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'ike-latn' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in iu please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'kk-cyrl' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in kk please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'kk-latn' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in kk please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'kk-arab' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in kk please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'kk-kz'   </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in kk please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'kk-tr'   </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in kk please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'kk-cn'   </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in kk please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'ku-latn' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in ku please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'ku-arab' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in ku please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'shi-tfng' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in shi please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'shi-latn' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in shi please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'sr-ec' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in sr please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'sr-el' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in sr please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'tg-latn' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in tg please.'</span><span style="color: #007700">,<br /><br />			</span><span style="color: #DD0000">'zh-hans' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-hant' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-cn' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-hk' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-mo' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-my' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-sg' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'zh-tw' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Translate in zh please.'</span><span style="color: #007700">,<br />		],<br />	];<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgTranslateMessageNamespaces</span><span style="color: #007700">[] = </span><span style="color: #0000BB">NS_MEDIAWIKI</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'TranslatePostInitGroups'</span><span style="color: #007700">][] = static function ( &amp;</span><span style="color: #0000BB">$cc </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$id </span><span style="color: #007700">= </span><span style="color: #DD0000">'wiki-translatable'</span><span style="color: #007700">;<br />			</span><span style="color: #0000BB">$mg </span><span style="color: #007700">= new </span><span style="color: #0000BB">WikiMessageGroup</span><span style="color: #007700">( </span><span style="color: #0000BB">$id</span><span style="color: #007700">, </span><span style="color: #DD0000">'translatable-messages' </span><span style="color: #007700">);<br />			</span><span style="color: #0000BB">$mg</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setLabel</span><span style="color: #007700">( </span><span style="color: #DD0000">'Interface' </span><span style="color: #007700">);<br />			</span><span style="color: #0000BB">$mg</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setDescription</span><span style="color: #007700">( </span><span style="color: #DD0000">'Messages used in the custom interface of this wiki' </span><span style="color: #007700">);<br />			</span><span style="color: #0000BB">$cc</span><span style="color: #007700">[</span><span style="color: #0000BB">$id</span><span style="color: #007700">] = </span><span style="color: #0000BB">$mg</span><span style="color: #007700">;<br />			return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		};<br />	}<br /><br />	</span><span style="color: #0000BB">$wgSpecialPages</span><span style="color: #007700">[</span><span style="color: #DD0000">'ManageMessageGroups'</span><span style="color: #007700">] = </span><span style="color: #0000BB">DisabledSpecialPage</span><span style="color: #007700">::</span><span style="color: #0000BB">getCallback</span><span style="color: #007700">( </span><span style="color: #DD0000">'ManageMessageGroups' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTranslateStatsProviders</span><span style="color: #007700">[</span><span style="color: #DD0000">'registrations'</span><span style="color: #007700">] = </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgTranslateTranslationServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'Apertium'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'type' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'cxserver'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'host' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'cxserver'</span><span style="color: #007700">],<br />		</span><span style="color: #DD0000">'timeout' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">3</span><span style="color: #007700">,<br />	];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTranslationNotifications </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TranslationNotifications' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTranslationNotificationsContactMethods</span><span style="color: #007700">[</span><span style="color: #DD0000">'talkpage-elsewhere'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseFundraisingTranslateWorkflow </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'FundraisingTranslateWorkflow' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseVips </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'VipsScaler' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgVipsOptions </span><span style="color: #007700">= [<br />		[<br />			</span><span style="color: #DD0000">'conditions' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'mimeType' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'image/png'</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'minArea' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">2e7</span><span style="color: #007700">,<br />			],<br />		],<br />		[<br />			</span><span style="color: #DD0000">'conditions' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'mimeType' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'image/tiff'</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'minShrinkFactor' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">1.2</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'minArea' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">5e7</span><span style="color: #007700">,<br />			],<br />			</span><span style="color: #DD0000">'sharpen' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'sigma' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0.8 </span><span style="color: #007700">],<br />		],<br />	];<br /><br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseShortUrl </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ShortUrl' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgShortUrlTemplate </span><span style="color: #007700">= </span><span style="color: #DD0000">"/s/$1"</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseFeaturedFeeds </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'FeaturedFeeds' </span><span style="color: #007700">);<br />	require_once </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/FeaturedFeedsWMF.php'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$wgDisplayFeedsInSidebar </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgDisplayFeedsInSidebar</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgEnablePageTriage </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'PageTriage' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgAddGroups</span><span style="color: #007700">[</span><span style="color: #DD0000">'bureaucrat'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'copyviobot'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T206731<br />	</span><span style="color: #0000BB">$wgRemoveGroups</span><span style="color: #007700">[</span><span style="color: #DD0000">'bureaucrat'</span><span style="color: #007700">][] = </span><span style="color: #DD0000">'copyviobot'</span><span style="color: #007700">; </span><span style="color: #FF8000">// T206731<br /></span><span style="color: #007700">}<br /><br />if ( </span><span style="color: #0000BB">$wmgEnableInterwiki </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Interwiki' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgInterwikiViewOnly </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000"># Avoid excessive CPU due to cache misses from rapid invalidations<br /></span><span style="color: #0000BB">$wgJobBackoffThrottling</span><span style="color: #007700">[</span><span style="color: #DD0000">'htmlCacheUpdate'</span><span style="color: #007700">] = </span><span style="color: #0000BB">50</span><span style="color: #007700">; </span><span style="color: #FF8000">// pages/sec per runner<br /><br /># Job types to exclude from the default queue processing. Aka the very long<br /># one. That will exclude the types from any queries such as nextJobDB.php<br /># We have to set this for any project cause we usually run PHP script against<br /># the 'aawiki' database, but might as well run it against another name.<br /><br /># Timed Media Handler:<br /></span><span style="color: #0000BB">$wgJobTypesExcludedFromDefaultQueue</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'webVideoTranscode'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgJobTypesExcludedFromDefaultQueue</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'webVideoTranscodePrioritized'</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000"># GWToolset<br /></span><span style="color: #0000BB">$wgJobTypesExcludedFromDefaultQueue</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'gwtoolsetUploadMetadataJob'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgJobTypesExcludedFromDefaultQueue</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'gwtoolsetUploadMediafileJob'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgJobTypesExcludedFromDefaultQueue</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'gwtoolsetGWTFileBackendCleanupJob'</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseEducationProgram </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgExtraNamespaces</span><span style="color: #007700">[</span><span style="color: #0000BB">446</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Education_Program'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgExtraNamespaces</span><span style="color: #007700">[</span><span style="color: #0000BB">447</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Education_Program_talk'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgNamespacesWithSubpages</span><span style="color: #007700">[</span><span style="color: #0000BB">447</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikimediaShopLink </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">/**<br />	 * @param Skin $skin<br />	 * @param array $sidebar<br />	 * @return bool<br />	 */<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'SkinBuildSidebar'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$skin</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$sidebar </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$sidebar</span><span style="color: #007700">[</span><span style="color: #DD0000">'navigation'</span><span style="color: #007700">][] = [<br />			</span><span style="color: #DD0000">'text'  </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$skin</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">msg</span><span style="color: #007700">( </span><span style="color: #DD0000">'wikimediashoplink-linktext' </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(),<br />			</span><span style="color: #DD0000">'href'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'//shop.wikimedia.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'title' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$skin</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">msg</span><span style="color: #007700">( </span><span style="color: #DD0000">'wikimediashoplink-link-tooltip' </span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">text</span><span style="color: #007700">(),<br />			</span><span style="color: #DD0000">'id'	</span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'n-shoplink'</span><span style="color: #007700">,<br />		];<br />		return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgEnableGeoData </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GeoData' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgGeoDataBackend </span><span style="color: #007700">= </span><span style="color: #DD0000">'elastic'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgMaxCoordinatesPerPage </span><span style="color: #007700">= </span><span style="color: #0000BB">2000</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGeoDataDebug </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseEcho </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// LoginNotify code loaded before Notifications<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'LoginNotify' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgNotifyTypeAvailabilityByCategory</span><span style="color: #007700">[</span><span style="color: #DD0000">'login-success'</span><span style="color: #007700">][</span><span style="color: #DD0000">'web'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgLoginNotifyAttemptsNewIP </span><span style="color: #007700">= </span><span style="color: #0000BB">3</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// This is intentionally loaded *before* the GlobalPreferences extension (below).<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Echo' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// Common settings, never varied<br />	</span><span style="color: #0000BB">$wgEchoPerUserBlacklist </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEchoMaxMentionsInEditSummary </span><span style="color: #007700">= </span><span style="color: #0000BB">5</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Eventlogging for Schema:EchoMail<br />	</span><span style="color: #0000BB">$wgEchoEventLoggingSchemas</span><span style="color: #007700">[</span><span style="color: #DD0000">'EchoMail'</span><span style="color: #007700">][</span><span style="color: #DD0000">'enabled'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #FF8000">// Eventlogging for Schema:EchoInteraction<br />	</span><span style="color: #0000BB">$wgEchoEventLoggingSchemas</span><span style="color: #007700">[</span><span style="color: #DD0000">'EchoInteraction'</span><span style="color: #007700">][</span><span style="color: #DD0000">'enabled'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgEchoEnableEmailBatch </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgEchoEnableEmailBatch</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEchoEmailFooterAddress </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgEchoEmailFooterAddress</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEchoNotificationIcons</span><span style="color: #007700">[</span><span style="color: #DD0000">'site'</span><span style="color: #007700">][</span><span style="color: #DD0000">'url'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgEchoSiteNotificationIconUrl</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000"># Outgoing from and reply to address for Echo notifications extension<br />	</span><span style="color: #0000BB">$wgNotificationSender </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgNotificationSender</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgNotificationSenderName </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgSitename</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgNotificationReplyName </span><span style="color: #007700">= </span><span style="color: #DD0000">'No Reply'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Define the cluster database, false to use main database<br />	</span><span style="color: #0000BB">$wgEchoCluster </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgEchoCluster</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Whether to use job queue to process web and email notifications<br />	</span><span style="color: #0000BB">$wgEchoUseJobQueue </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgEchoUseJobQueue</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// CentralAuth is extra check to be absolutely sure we don't enable on non-SUL<br />	// wikis.<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgEchoCrossWikiByDefault </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgEchoCrossWikiNotifications </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		if ( </span><span style="color: #0000BB">$wmgEchoCrossWikiByDefault </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'echo-cross-wiki-notifications'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />		}<br />	}<br /><br />	</span><span style="color: #FF8000">// Whether to make mention failure/success notifications available<br />	</span><span style="color: #0000BB">$wgEchoMentionStatusNotifications </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Enable tracking table only on SULed wikis<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgEchoSharedTrackingDB </span><span style="color: #007700">= </span><span style="color: #DD0000">'wikishared'</span><span style="color: #007700">;<br />		</span><span style="color: #FF8000">// Explicitly set this to 'extension1', because some wikis have $wgEchoCluster set to false<br />		</span><span style="color: #0000BB">$wgEchoSharedTrackingCluster </span><span style="color: #007700">= </span><span style="color: #DD0000">'extension1'</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Default user options: subscriptions<br />	</span><span style="color: #007700">foreach ( </span><span style="color: #0000BB">$wmgEchoDefaultUserSubscriptions </span><span style="color: #007700">as </span><span style="color: #0000BB">$where </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$notifications </span><span style="color: #007700">) {<br />		foreach ( </span><span style="color: #0000BB">$notifications </span><span style="color: #007700">as </span><span style="color: #0000BB">$notification </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$value </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$option </span><span style="color: #007700">= </span><span style="color: #DD0000">'echo-subscriptions-' </span><span style="color: #007700">. </span><span style="color: #0000BB">$where </span><span style="color: #007700">. </span><span style="color: #DD0000">'-' </span><span style="color: #007700">. </span><span style="color: #0000BB">$notification</span><span style="color: #007700">;<br />			</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #0000BB">$option</span><span style="color: #007700">] = </span><span style="color: #0000BB">$value</span><span style="color: #007700">;<br />		}<br />	}<br /><br />	</span><span style="color: #FF8000">// Push notifications<br />	</span><span style="color: #0000BB">$wgEchoEnablePush </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgEchoEnablePush </span><span style="color: #007700">?? </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEchoPushServiceBaseUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'push-notifications'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/v1/message"</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEchoPushMaxSubscriptionsPerUser </span><span style="color: #007700">= </span><span style="color: #0000BB">10</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Set up the push notifier type if push is enabled.<br />	// If/when this is promoted to all wikis, this config can be moved directly into extension.json<br />	// along with the original notifier types ('web' and 'email').<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgEchoEnablePush </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgEchoNotifiers</span><span style="color: #007700">[</span><span style="color: #DD0000">'push'</span><span style="color: #007700">] = [ </span><span style="color: #DD0000">'EchoPush\\PushNotifier'</span><span style="color: #007700">, </span><span style="color: #DD0000">'notifyWithPush' </span><span style="color: #007700">];<br />		</span><span style="color: #0000BB">$wgDefaultNotifyTypeAvailability</span><span style="color: #007700">[</span><span style="color: #DD0000">'push'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgNotifyTypeAvailabilityByCategory</span><span style="color: #007700">[</span><span style="color: #DD0000">'system'</span><span style="color: #007700">][</span><span style="color: #DD0000">'push'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgNotifyTypeAvailabilityByCategory</span><span style="color: #007700">[</span><span style="color: #DD0000">'system-noemail'</span><span style="color: #007700">][</span><span style="color: #DD0000">'push'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Limit the 'push-subscription-manager' group to Meta-Wiki only (T261625)<br />	</span><span style="color: #0000BB">$wgExtensionFunctions</span><span style="color: #007700">[] = static function () {<br />		global </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">;<br />		if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">!== </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">) {<br />			unset( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'push-subscription-manager'</span><span style="color: #007700">] );<br />		}<br />	};<br />}<br /><br /></span><span style="color: #FF8000">// Wikitech specific settings<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labswiki' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgEmailConfirmToEdit </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEnableCreativeCommonsRdf </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Don't depend on other DB servers<br />	</span><span style="color: #0000BB">$wgDefaultExternalStore </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'editinterface'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'tboverride'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'titleblacklistlog'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'override-antispoof'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'createaccount'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000"># We don't want random strangers playing on this wiki<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'*'</span><span style="color: #007700">][</span><span style="color: #DD0000">'createaccount'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// These are somehow not added as they are assigned to 'sysop' in the respective extension.json<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'nuke'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'massmessage'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'spamblacklistlog'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Grant AbuseFilter permissions regular sysops have - T242593<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'abusefilter-log-detail'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'abusefilter-log-private'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'abusefilter-modify'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'abusefilter-modify-restricted'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'contentadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'abusefilter-view-private'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgMessageCacheType </span><span style="color: #007700">= </span><span style="color: #DD0000">'memcached-pecl'</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labswiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">"wikitech.wikimedia.org"</span><span style="color: #007700">; </span><span style="color: #FF8000">// TODO: Is this really necessary?<br />	</span><span style="color: #007700">} elseif ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgCookieDomain </span><span style="color: #007700">= </span><span style="color: #DD0000">"labtestwikitech.wikimedia.org"</span><span style="color: #007700">; </span><span style="color: #FF8000">// TODO: Is this really necessary?<br />	</span><span style="color: #007700">}<br /><br />	</span><span style="color: #FF8000">// Some settings specific to wikitech's extensions<br />	</span><span style="color: #007700">include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/wikitech.php'</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// wgReadOnly is set by etcdConfig using datacenter-global configs.<br />		// since labtestwikitech uses its own database, $wgReadOnly shouldn't<br />		// be determined from etcd.<br />		</span><span style="color: #0000BB">$wgReadOnly </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseThanks </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Thanks' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseEntitySchema </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'EntitySchema' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// Flow configuration<br /><br />// We always set this variable, as it's required by the create table<br />// maintenance script. This allows to deploy Flow on non standard wikis.<br /></span><span style="color: #0000BB">$wgFlowDefaultWikiDb </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgFlowDefaultWikiDb</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseFlow </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseParsoid </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Flow' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// Flow Parsoid - These are now specified directly as Flow-specific<br />	// configuration variables, though it currently uses the same Parsoid URL<br />	// as VisualEditor does.<br />	</span><span style="color: #0000BB">$wgFlowParsoidURL </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgParsoidURL</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFlowParsoidPrefix </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFlowParsoidTimeout </span><span style="color: #007700">= </span><span style="color: #0000BB">50</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wmgParsoidForwardCookies </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgFlowParsoidForwardCookies </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseVisualEditor </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'flow-editor'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'visualeditor'</span><span style="color: #007700">;<br />	}<br /><br />	foreach ( </span><span style="color: #0000BB">$wmgFlowNamespaces </span><span style="color: #007700">as </span><span style="color: #0000BB">$namespace </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgNamespaceContentModels</span><span style="color: #007700">[</span><span style="color: #0000BB">$namespace</span><span style="color: #007700">] = </span><span style="color: #DD0000">'flow-board'</span><span style="color: #007700">; </span><span style="color: #FF8000">// CONTENT_MODEL_FLOW_BOARD<br />	</span><span style="color: #007700">}<br />	</span><span style="color: #FF8000">// Requires that Parsoid is available for all wikis using Flow.<br />	</span><span style="color: #0000BB">$wgFlowContentFormat </span><span style="color: #007700">= </span><span style="color: #DD0000">'html'</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wmgFlowEnglishNamespaceOnly </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// HACK: Only use English namespace names, override the localized namespace names<br />		// This is needed for languages where the translation for Thread: (from LQT)<br />		// and Topic: (from Flow) are the same, like in Portuguese. In those cases we<br />		// make the Flow Topic: namespace only use the English name, so the translated name<br />		// will still point to the LQT namespace.<br />		</span><span style="color: #0000BB">$wgExtraNamespaces</span><span style="color: #007700">[</span><span style="color: #0000BB">2600</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Topic'</span><span style="color: #007700">; </span><span style="color: #FF8000">// NS_TOPIC<br />	</span><span style="color: #007700">}<br /><br />	</span><span style="color: #0000BB">$wgFlowDefaultWikiDb </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgFlowDefaultWikiDb</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFlowCluster </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgFlowCluster</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFlowExternalStore </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgDefaultExternalStore</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFlowMaintenanceMode </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgFlowMaintenanceMode</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wmgFlowAllowAutoconfirmedEdit </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'autoconfirmed'</span><span style="color: #007700">][</span><span style="color: #DD0000">'flow-edit-post'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">$wgFlowEnableOptInBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgFlowEnableOptInBetaFeature</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// On wikis that have Flow as a beta feature or in an entire namespace,<br />	// give sysops the right to create and move Flow boards<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgFlowEnableOptInBetaFeature </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgFlowNamespaces </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'flow-create-board'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseDisambiguator </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Disambiguator' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseDiscussionTools </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'DiscussionTools' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCodeEditorForCore </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseScribunto </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CodeEditor' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgCodeEditorEnableCore </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgUseCodeEditorForCore</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'metawiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'CodeEditorGetPageLanguage'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">Title $title</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$lang </span><span style="color: #007700">) {<br />			if ( </span><span style="color: #0000BB">preg_match</span><span style="color: #007700">(<br />				</span><span style="color: #DD0000">'/^(API listing|Www\.wik(imedia|ipedia|inews|tionary|iquote|iversity|ibooks|ivoyage)\.org) template(\/temp)?$/'</span><span style="color: #007700">,<br />				</span><span style="color: #0000BB">$title</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getPrefixedText</span><span style="color: #007700">()<br />			) ) {<br />				</span><span style="color: #0000BB">$lang </span><span style="color: #007700">= </span><span style="color: #DD0000">'html'</span><span style="color: #007700">;<br />			}<br />		};<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseScribunto </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Scribunto' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgScribuntoUseGeSHi </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgScribuntoUseCodeEditor </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgScribuntoGatherFunctionStats </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;  </span><span style="color: #FF8000">// ori, 29-Oct-2015<br />	</span><span style="color: #0000BB">$wgScribuntoSlowFunctionThreshold </span><span style="color: #007700">= </span><span style="color: #0000BB">0.99</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgScribuntoDefaultEngine </span><span style="color: #007700">= </span><span style="color: #DD0000">'luasandbox'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgScribuntoEngineConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'luasandbox'</span><span style="color: #007700">][</span><span style="color: #DD0000">'cpuLimit'</span><span style="color: #007700">] = </span><span style="color: #0000BB">10</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgScribuntoEngineConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'luasandbox'</span><span style="color: #007700">][</span><span style="color: #DD0000">'maxLangCacheSize'</span><span style="color: #007700">] = </span><span style="color: #0000BB">200</span><span style="color: #007700">; </span><span style="color: #FF8000">// see T85461#3100878<br /></span><span style="color: #007700">}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSubpageSortkey </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SubpageSortkey' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgSubpageSortkeyByNamespace </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgSubpageSortkeyByNamespace</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGeoCrumbs </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GeoCrumbs' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCalendar </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Calendar' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMapSources </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MapSources' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCreditsSource </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CreditsSource' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseListings </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Listings' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTocTree </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TocTree' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'toc-floated'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgUseFloatedToc</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseInsider </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Insider' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseRelatedArticles </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'RelatedArticles' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgRelatedArticlesLoggingBucketSize </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgRelatedArticlesOnlyUseCirrusSearch </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgRelatedArticlesDescriptionSource </span><span style="color: #007700">= </span><span style="color: #DD0000">'wikidata'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseRevisionSlider </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'RevisionSlider' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTwoColConflict </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TwoColConflict' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTwoColConflictBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgTwoColConflictBetaFeature</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Enable oversampled event tracking during limited study period (T249616)<br />	</span><span style="color: #0000BB">$wgTwoColConflictTrackingOversample </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseEventLogging </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'EventLogging' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'EventStreamConfig' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// All wikis reference metawiki.<br />	</span><span style="color: #0000BB">$wgEventLoggingBaseUri </span><span style="color: #007700">= </span><span style="color: #0000BB">$wgCanonicalServer </span><span style="color: #007700">. </span><span style="color: #DD0000">'/beacon/event'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEventLoggingDBname </span><span style="color: #007700">= </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgEventLoggingSchemaApiUri </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://meta.wikimedia.org/w/api.php'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// For compat, also register the Schema NS on test2.wikipedia.org,<br />	// because this wiki used to be its own EventLogging repo (T196309)<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #0000BB">$wgEventLoggingDBname </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'test2wiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// T47031<br />		</span><span style="color: #0000BB">$wgExtraNamespaces</span><span style="color: #007700">[</span><span style="color: #0000BB">470</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Schema'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgExtraNamespaces</span><span style="color: #007700">[</span><span style="color: #0000BB">471</span><span style="color: #007700">] = </span><span style="color: #DD0000">'Schema_talk'</span><span style="color: #007700">;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #0000BB">$wgEventLoggingDBname </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CodeEditor' </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$wgCodeEditorEnableCore </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgUseCodeEditorForCore</span><span style="color: #007700">; </span><span style="color: #FF8000">// For safety's sake<br />	</span><span style="color: #007700">}<br /><br />	</span><span style="color: #FF8000">// Depends on EventLogging<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCampaigns </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Campaigns' </span><span style="color: #007700">);<br />	}<br /><br />	</span><span style="color: #FF8000">// Depends on EventLogging<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseWikimediaEvents </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikimediaEvents' </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$wgWMEStatsdBaseUri </span><span style="color: #007700">= </span><span style="color: #DD0000">'/beacon/statsv'</span><span style="color: #007700">;<br />		if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'testwiki' </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'data-qa'</span><span style="color: #007700">][</span><span style="color: #DD0000">'perform-data-qa'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T276515<br />		</span><span style="color: #007700">}<br />	}<br /><br />	</span><span style="color: #FF8000">// Depends on EventLogging<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseNavigationTiming </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'NavigationTiming' </span><span style="color: #007700">);<br />	}<br />}<br /><br /></span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'XAnalytics' </span><span style="color: #007700">);<br /><br />if ( </span><span style="color: #0000BB">$wmgUseUniversalLanguageSelector </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'UniversalLanguageSelector' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgULSGeoService </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgULSAnonCanChangeLanguage </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgULSPosition </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgULSPosition</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgULSIMEEnabled </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgULSIMEEnabled</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgULSWebfontsEnabled </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgULSWebfontsEnabled</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wmgUseCodeEditorForCore </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseScribunto </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgULSNoImeSelectors</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'.ace_editor textarea'</span><span style="color: #007700">;<br />	}<br />	if ( </span><span style="color: #0000BB">$wmgUseTranslate </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgULSPosition </span><span style="color: #007700">=== </span><span style="color: #DD0000">'personal' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgTranslatePageTranslationULS </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Compact Language Links …<br /><br />	// … as a beta feature (see T136677 for beta to stable)<br />	</span><span style="color: #0000BB">$wgULSCompactLanguageLinksBetaFeature </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgULSCompactLanguageLinksBetaFeature</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// … as a stable feature<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'compact-language-links'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseFileExporter </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'FileExporter' </span><span style="color: #007700">);<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseFileExporter </span><span style="color: #007700">!== </span><span style="color: #0000BB">true </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgFileExporterTarget </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgUseFileExporter</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseFileImporter </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'FileImporter' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgFileImporterCommonsHelperServer </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://www.mediawiki.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileImporterCommonsHelperBasePageName </span><span style="color: #007700">= </span><span style="color: #DD0000">'Extension:FileImporter/Data/'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileImporterCommonsHelperHelpPage </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://www.mediawiki.org/wiki/Extension:FileImporter/List_of_configured_wikis'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileImporterSourceSiteServices </span><span style="color: #007700">= [ </span><span style="color: #0000BB">$wmgUseFileImporter </span><span style="color: #007700">];<br />	</span><span style="color: #FF8000">// Temporary solution until we have a stable implementation for this<br />	// https://gerrit.wikimedia.org/r/440857<br />	</span><span style="color: #0000BB">$wgFileImporterInterWikiMap </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'test.wikipedia.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'testwiki'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'test2.wikipedia.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'test2wiki'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'mediawiki.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'mw'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ar.wikipedia.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'w:ar'</span><span style="color: #007700">, </span><span style="color: #FF8000">// T196969<br />		</span><span style="color: #DD0000">'de.wikipedia.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'w:de'</span><span style="color: #007700">, </span><span style="color: #FF8000">// T196969<br />		</span><span style="color: #DD0000">'fa.wikipedia.org' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'w:fa'</span><span style="color: #007700">, </span><span style="color: #FF8000">// T196969<br />	</span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wgFileImporterWikidataEntityEndpoint </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://www.wikidata.org/wiki/Special:EntityData/'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileImporterWikidataNowCommonsEntity </span><span style="color: #007700">= </span><span style="color: #DD0000">'Q5611625'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileImporterSourceWikiDeletion </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgFileImporterSourceWikiTemplating </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Temporarily enable for testing, see T228851<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'testwiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgFileImporterWikidataEntityEndpoint </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://test.wikidata.org/wiki/Special:EntityData/'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgFileImporterWikidataNowCommonsEntity </span><span style="color: #007700">= </span><span style="color: #DD0000">'Q210317'</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseContentTranslation </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ContentTranslation' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// T76200: Public URL for cxserver instance<br />	</span><span style="color: #0000BB">$wgContentTranslationSiteTemplates</span><span style="color: #007700">[</span><span style="color: #DD0000">'cx'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'//cxserver.wikimedia.org/v1'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgContentTranslationSiteTemplates</span><span style="color: #007700">[</span><span style="color: #DD0000">'cookieDomain'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'.wikipedia.org'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgContentTranslationTranslateInTarget </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgContentTranslationTranslateInTarget</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgContentTranslationUnmodifiedMTThresholdForPublish </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgContentTranslationUnmodifiedMTThresholdForPublish</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wmgContentTranslationCluster </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgContentTranslationCluster </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgContentTranslationCluster</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">$wgContentTranslationCampaigns </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgContentTranslationCampaigns</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgContentTranslationCXServerAuth </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'algorithm' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'HS256'</span><span style="color: #007700">,<br />		</span><span style="color: #FF8000">// This is set in PrivateSettings.php<br />		</span><span style="color: #DD0000">'key' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$wmgContentTranslationCXServerAuthKey</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'age' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'3600'</span><span style="color: #007700">,<br />	];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseExternalGuidance </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ExternalGuidance' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgExternalGuidanceMTReferrers </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'translate.google.com'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'translate.googleusercontent.com'<br />	</span><span style="color: #007700">];<br /><br />	</span><span style="color: #0000BB">$wgExternalGuidanceKnownServices </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'Google'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'translate.google.com'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'translate.googleusercontent.com'<br />	</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCognate </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Cognate' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgCognateDb </span><span style="color: #007700">= </span><span style="color: #DD0000">'cognate_' </span><span style="color: #007700">. </span><span style="color: #0000BB">$wmgUseCognate</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCognateCluster </span><span style="color: #007700">= </span><span style="color: #DD0000">'extension1'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgCognateNamespaces </span><span style="color: #007700">= [ </span><span style="color: #0000BB">0 </span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseInterwikiSorting </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgInterwikiSortingInterwikiSortOrders </span><span style="color: #007700">= include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/InterwikiSortOrders.php'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'InterwikiSorting' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikibaseRepo </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseWikibaseClient </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseWikibaseMediaInfo </span><span style="color: #007700">) {<br />	include </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/Wikibase.php'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// Turn off exact search match redirects<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgDoNotRedirectOnSearchMatch </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgSearchMatchRedirectPreference </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'search-match-redirect'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// put this here to ensure it is available for localisation cache rebuild<br /></span><span style="color: #0000BB">$wgWBClientSettings</span><span style="color: #007700">[</span><span style="color: #DD0000">'repoSiteName'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'wikibase-repo-name'</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseTemplateSandbox </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TemplateSandbox' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUsePageAssessments </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'PageAssessments' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUsePageImages </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'PageImages' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseSearchExtraNS </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'SearchExtraNS' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGraph </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'JsonConfig' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgEnableJsonConfigDataMode </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Safety: before extension.json, these values were initialized by JsonConfig.php<br />	</span><span style="color: #007700">if ( !isset( </span><span style="color: #0000BB">$wgJsonConfigModels </span><span style="color: #007700">) ) {<br />		</span><span style="color: #0000BB">$wgJsonConfigModels </span><span style="color: #007700">= [];<br />	}<br />	if ( !isset( </span><span style="color: #0000BB">$wgJsonConfigs </span><span style="color: #007700">) ) {<br />		</span><span style="color: #0000BB">$wgJsonConfigs </span><span style="color: #007700">= [];<br />	}<br /><br />	</span><span style="color: #0000BB">$wgJsonConfigEnableLuaSupport </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// https://www.mediawiki.org/wiki/Extension:JsonConfig#Configuration<br /><br />	</span><span style="color: #0000BB">$wgJsonConfigModels</span><span style="color: #007700">[</span><span style="color: #DD0000">'Tabular.JsonConfig'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'JsonConfig\JCTabularContent'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Tabular.JsonConfig'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'namespace' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">486</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nsName' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Data'</span><span style="color: #007700">,<br />		</span><span style="color: #FF8000">// page name must end in ".tab", and contain at least one symbol<br />		</span><span style="color: #DD0000">'pattern' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'/.\.tab$/'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'license' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'CC0-1.0'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'isLocal' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #0000BB">$wgJsonConfigModels</span><span style="color: #007700">[</span><span style="color: #DD0000">'Map.JsonConfig'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'JsonConfig\JCMapDataContent'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Map.JsonConfig'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'namespace' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">486</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'nsName' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Data'</span><span style="color: #007700">,<br />		</span><span style="color: #FF8000">// page name must end in ".map", and contain at least one symbol<br />		</span><span style="color: #DD0000">'pattern' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'/.\.map$/'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'license' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'CC0-1.0'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'isLocal' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />	];<br /><br />	</span><span style="color: #FF8000">// Enable Tabular data namespace on Commons - T148745<br />	// Enable Map (GeoJSON) data namespace on Commons - T149548<br />	// TODO: Consider whether this hard-coding to Commons is appropriate<br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'commonswiki' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// Ensure we have a stable cross-wiki title resolution<br />		// See JCSingleton::parseTitle()<br />		</span><span style="color: #0000BB">$wgJsonConfigInterwikiPrefix </span><span style="color: #007700">= </span><span style="color: #DD0000">"meta"</span><span style="color: #007700">;<br /><br />		</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Tabular.JsonConfig'</span><span style="color: #007700">][</span><span style="color: #DD0000">'store'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Map.JsonConfig'</span><span style="color: #007700">][</span><span style="color: #DD0000">'store'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgJsonConfigInterwikiPrefix </span><span style="color: #007700">= </span><span style="color: #DD0000">"commons"</span><span style="color: #007700">;<br /><br />		</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Tabular.JsonConfig'</span><span style="color: #007700">][</span><span style="color: #DD0000">'remote'</span><span style="color: #007700">] = [<br />			</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://commons.wikimedia.org/w/api.php'<br />		</span><span style="color: #007700">];<br />		</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Map.JsonConfig'</span><span style="color: #007700">][</span><span style="color: #DD0000">'remote'</span><span style="color: #007700">] = [<br />			</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'https://commons.wikimedia.org/w/api.php'<br />		</span><span style="color: #007700">];<br />	}<br />}<br /><br /></span><span style="color: #FF8000">// Enable Config:Dashiki: sub-namespace on meta.wikimedia.org - T156971<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgEnableDashikiData </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Dashiki sub-namespace Config:Dashiki: is configured in extension.json<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Dashiki' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGraph </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Graph' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// **** THIS LIST MUST MATCH puppet/hieradata/role/common/scb.yaml ****<br />	// See https://www.mediawiki.org/wiki/Extension:Graph#External_data<br />	//<br />	</span><span style="color: #0000BB">$wgGraphAllowedDomains </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'https' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'mediawiki.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikibooks.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikidata.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikimedia.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikinews.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikipedia.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikiquote.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikisource.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikiversity.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wikivoyage.org'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'wiktionary.org'</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'wikirawupload' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'upload.wikimedia.org'</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'wikidatasparql' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'query.wikidata.org'</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'geoshape' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'maps.wikimedia.org'</span><span style="color: #007700">,<br />		],<br />	];<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseGraphWithJsonNamespace </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgJsonConfigModels</span><span style="color: #007700">[</span><span style="color: #DD0000">'Json.JsonConfig'</span><span style="color: #007700">] = </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgJsonConfigs</span><span style="color: #007700">[</span><span style="color: #DD0000">'Json.JsonConfig'</span><span style="color: #007700">] = [<br />			</span><span style="color: #DD0000">'namespace' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">486</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'nsName' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'Data'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'isLocal' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'pattern' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'/^Json:./'</span><span style="color: #007700">,<br />		];<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseOAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'OAuth' </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">in_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">, [ </span><span style="color: #DD0000">'labswiki'</span><span style="color: #007700">, </span><span style="color: #DD0000">'labtestwiki' </span><span style="color: #007700">] ) ) {<br />		</span><span style="color: #FF8000">// Wikitech and its testing variant use local OAuth tables<br />		</span><span style="color: #0000BB">$wgMWOAuthCentralWiki </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgMWOAuthCentralWiki </span><span style="color: #007700">= </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgMWOAuthSharedUserSource </span><span style="color: #007700">= </span><span style="color: #DD0000">'CentralAuth'</span><span style="color: #007700">;<br />	}<br />	</span><span style="color: #0000BB">$wgMWOAuthSecureTokenTransfer </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgOAuth2GrantExpirationInterval </span><span style="color: #007700">= </span><span style="color: #DD0000">'PT4H'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgOAuth2RefreshTokenTTL </span><span style="color: #007700">= </span><span style="color: #DD0000">'P365D'</span><span style="color: #007700">;<br /><br />	if ( </span><span style="color: #0000BB">$wgMWOAuthCentralWiki </span><span style="color: #007700">=== </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wgMWOAuthCentralWiki </span><span style="color: #007700">=== </span><span style="color: #0000BB">false </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// Management interfaces are available on the central wiki or wikis<br />		// that are using local OAuth tables<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'mwoauthproposeconsumer'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'mwoauthupdateownconsumer'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'oauthadmin'</span><span style="color: #007700">][</span><span style="color: #DD0000">'mwoauthmanageconsumer'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgOAuthGroupsToNotify </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'oauthadmin' </span><span style="color: #007700">];<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseOAuthRateLimiter </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'OAuthRateLimiter' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgOAuthRateLimiterDefaultClientTier </span><span style="color: #007700">= </span><span style="color: #DD0000">'default'</span><span style="color: #007700">;<br />	</span><span style="color: #FF8000">// As defined in T246271<br />	</span><span style="color: #0000BB">$wgOAuthRateLimiterTierConfig </span><span style="color: #007700">= [<br />		</span><span style="color: #FF8000">// demo added for demoing/testing purposes<br />		</span><span style="color: #DD0000">'demo' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'ratelimit' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'requests_per_unit' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">10</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'unit'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'HOUR'<br />			</span><span style="color: #007700">],<br />		],<br />		</span><span style="color: #DD0000">'default' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'ratelimit' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'requests_per_unit' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">5000</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'unit'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'HOUR'<br />			</span><span style="color: #007700">],<br />		],<br />		</span><span style="color: #DD0000">'preferred' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'ratelimit' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'requests_per_unit' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">25000</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'unit'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'HOUR'<br />			</span><span style="color: #007700">],<br />		],<br />		</span><span style="color: #DD0000">'internal' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'ratelimit' </span><span style="color: #007700">=&gt; [<br />				</span><span style="color: #DD0000">'requests_per_unit' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">100000</span><span style="color: #007700">,<br />				</span><span style="color: #DD0000">'unit'  </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'HOUR'<br />			</span><span style="color: #007700">],<br />		],<br />	];<br />}<br /><br /></span><span style="color: #FF8000">// T15712<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseJosa </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Josa' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseOATHAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'OATHAuth' </span><span style="color: #007700">);<br /><br />	if ( </span><span style="color: #0000BB">$wmgOATHAuthDisableRight </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'user'</span><span style="color: #007700">][</span><span style="color: #DD0000">'oathauth-enable'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />		foreach ( </span><span style="color: #0000BB">$wmgPrivilegedGroups </span><span style="color: #007700">as </span><span style="color: #0000BB">$group </span><span style="color: #007700">) {<br />			if ( isset( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">] ) ) {<br />				</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'oathauth-enable'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />			}<br />		}<br />	}<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'oathauth-disable-for-user'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'oathauth-view-log'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'oathauth-verify-user'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">; </span><span style="color: #FF8000">// T209749<br /><br />	</span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgOATHAuthAccountPrefix </span><span style="color: #007700">= </span><span style="color: #DD0000">'Wikimedia'</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$wgOATHAuthDatabase </span><span style="color: #007700">= </span><span style="color: #DD0000">'centralauth'</span><span style="color: #007700">;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseWebAuthn </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WebAuthn' </span><span style="color: #007700">);<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMediaModeration </span><span style="color: #007700">) {<br />	if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'production' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgMediaModerationHttpProxy </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'urldownloader'</span><span style="color: #007700">];<br />	}<br /><br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MediaModeration' </span><span style="color: #007700">);<br />	</span><span style="color: #FF8000">// This relies on configuration in PrivateSettings.php:<br />	// - $wgMediaModerationPhotoDNASubscriptionKey<br />	// - $wgMediaModerationRecipientList<br />	</span><span style="color: #0000BB">$wgMediaModerationFrom </span><span style="color: #007700">= </span><span style="color: #DD0000">'no-reply@wikimedia.org'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseORES </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ORES' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgOresBaseUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">'http://localhost:6010/'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgOresFrontendBaseUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://ores.wikimedia.org/'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'oresDamagingPref'</span><span style="color: #007700">] =<br />		</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'rcOresDamagingPref'</span><span style="color: #007700">] =<br />		</span><span style="color: #0000BB">$wmgOresDefaultSensitivityLevel</span><span style="color: #007700">;<br /><br />	</span><span style="color: #FF8000">// Backwards compatibility for upcoming config format change<br />	</span><span style="color: #007700">if ( isset( </span><span style="color: #0000BB">$wgOresFiltersThresholds</span><span style="color: #007700">[</span><span style="color: #DD0000">'goodfaith'</span><span style="color: #007700">][</span><span style="color: #DD0000">'good'</span><span style="color: #007700">] ) ) {<br />		</span><span style="color: #0000BB">$wgOresFiltersThresholds</span><span style="color: #007700">[</span><span style="color: #DD0000">'goodfaith'</span><span style="color: #007700">][</span><span style="color: #DD0000">'likelygood'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wgOresFiltersThresholds</span><span style="color: #007700">[</span><span style="color: #DD0000">'goodfaith'</span><span style="color: #007700">][</span><span style="color: #DD0000">'good'</span><span style="color: #007700">];<br />	}<br />	if ( isset( </span><span style="color: #0000BB">$wgOresFiltersThresholds</span><span style="color: #007700">[</span><span style="color: #DD0000">'goodfaith'</span><span style="color: #007700">][</span><span style="color: #DD0000">'bad'</span><span style="color: #007700">] ) ) {<br />		</span><span style="color: #0000BB">$wgOresFiltersThresholds</span><span style="color: #007700">[</span><span style="color: #DD0000">'goodfaith'</span><span style="color: #007700">][</span><span style="color: #DD0000">'likelybad'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wgOresFiltersThresholds</span><span style="color: #007700">[</span><span style="color: #DD0000">'goodfaith'</span><span style="color: #007700">][</span><span style="color: #DD0000">'bad'</span><span style="color: #007700">];<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseNewsletter </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Newsletter' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">### End (roughly) of general extensions ########################<br /><br /></span><span style="color: #0000BB">$wgApplyIpBlocksToXff </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Soft-block private IPs and other shared resources.<br />// Note this has no effect on edits from traffic proxied through any of these<br />// IPs with a trusted XFF header, only edits where MediaWiki is actually going<br />// to attribute the edit (or other logged action) to one of these IPs, e.g.<br />// that it would show up on [[Special:Contributions/127.0.0.1]].<br /></span><span style="color: #0000BB">$wgSoftBlockRanges </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br />	[<br />		</span><span style="color: #FF8000">// Ranges that aren't supposed to be publicly routable<br />		</span><span style="color: #DD0000">'0.0.0.0/8'</span><span style="color: #007700">, </span><span style="color: #FF8000">// "This host on this network" (RFC 6890)<br />		</span><span style="color: #DD0000">'10.0.0.0/8'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Private<br />		</span><span style="color: #DD0000">'100.64.0.0/10'</span><span style="color: #007700">, </span><span style="color: #FF8000">// "Shared address space" for internal routing (RFC 6598)<br />		</span><span style="color: #DD0000">'127.0.0.0/8'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Loopback<br />		</span><span style="color: #DD0000">'169.254.0.0/16'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Link local<br />		// 172.16.0.0/12 is handled below, don't add it here.<br />		</span><span style="color: #DD0000">'192.0.0.0/24'</span><span style="color: #007700">, </span><span style="color: #FF8000">// IETF Protocol Assignments (RFC 6890)<br />		</span><span style="color: #DD0000">'192.0.2.0/24'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Documentation<br />		</span><span style="color: #DD0000">'192.168.0.0/16'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Private<br />		</span><span style="color: #DD0000">'198.18.0.0/15'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Benchmarking (RFC 2544)<br />		</span><span style="color: #DD0000">'198.51.100.0/24'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Documentation<br />		</span><span style="color: #DD0000">'203.0.113.0/24'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Documentation<br />		</span><span style="color: #DD0000">'240.0.0.0/4'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Reserved (RFC 1112)<br />		</span><span style="color: #DD0000">'::/128'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Unspecified address<br />		</span><span style="color: #DD0000">'::1/128'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Loopback<br />		</span><span style="color: #DD0000">'::ffff:0:0/96'</span><span style="color: #007700">, </span><span style="color: #FF8000">// IPv4 mapped (these should be coming in as IPv4, not IPv6)<br />		</span><span style="color: #DD0000">'100::/64'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Discard-only address block<br />		</span><span style="color: #DD0000">'2001:2::/48'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Benchmarking<br />		</span><span style="color: #DD0000">'2001:db8::/32'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Documentation<br />		</span><span style="color: #DD0000">'2001:10::/28'</span><span style="color: #007700">, </span><span style="color: #FF8000">// ORCHID (RFC 4843)<br />		</span><span style="color: #DD0000">'fc00::/7'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Local communications, not globally routable (RFC 4193)<br />		</span><span style="color: #DD0000">'fe80::/10'</span><span style="color: #007700">, </span><span style="color: #FF8000">// Link-local<br /><br />		// We shouldn't be getting edits via multicast either<br />		</span><span style="color: #DD0000">'224.0.0.0/4'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'ff00::/8'</span><span style="color: #007700">,<br />	],<br /><br />	</span><span style="color: #FF8000">// Addresses used by WMF, people should log in to edit from them directly.<br />	</span><span style="color: #0000BB">$wgCdnServersNoPurge<br /></span><span style="color: #007700">);<br /><br />if ( </span><span style="color: #0000BB">$wmgAllowLabsAnonEdits </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// CI makes anonymous edits on some wikis, so don't block Cloud VPS<br />	// private addresses when this feature flag is true.<br />	</span><span style="color: #0000BB">$wgSoftBlockRanges </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgSoftBlockRanges</span><span style="color: #007700">, [<br />		</span><span style="color: #FF8000">// 172.16.0.0/16 is allowed<br />		</span><span style="color: #DD0000">'172.17.0.0/16'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'172.18.0.0/15'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'172.20.0.0/14'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'172.24.0.0/13'</span><span style="color: #007700">,<br />	] );<br />} else {<br />	</span><span style="color: #FF8000">// Cloud VPS users shouldn't be editing anonymously on most wikis, so we<br />	// can block anonymous edits from the whole private ranges.<br />	</span><span style="color: #0000BB">$wgSoftBlockRanges</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'172.16.0.0/12'</span><span style="color: #007700">;<br />	</span><span style="color: #FF8000">// Cloud VPS VMs with floating/public addresses<br />	</span><span style="color: #0000BB">$wgSoftBlockRanges</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'185.15.56.0/24'</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// On Special:Version, link to useful release notes<br /></span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'SpecialVersionVersionUrl'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$version</span><span style="color: #007700">, &amp;</span><span style="color: #0000BB">$versionUrl </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$matches </span><span style="color: #007700">= [];<br />	</span><span style="color: #0000BB">preg_match</span><span style="color: #007700">( </span><span style="color: #DD0000">"/^(\d+\.\d+)(?:\.0-)?wmf\.?(\d+)?$/"</span><span style="color: #007700">, </span><span style="color: #0000BB">$version</span><span style="color: #007700">, </span><span style="color: #0000BB">$matches </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">$matches </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$versionUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">"//www.mediawiki.org/wiki/MediaWiki_</span><span style="color: #007700">{</span><span style="color: #0000BB">$matches</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]}</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />		if ( isset( </span><span style="color: #0000BB">$matches</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">] ) ) {<br />			</span><span style="color: #0000BB">$versionUrl </span><span style="color: #007700">.= </span><span style="color: #DD0000">"/wmf.</span><span style="color: #007700">{</span><span style="color: #0000BB">$matches</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]}</span><span style="color: #DD0000">"</span><span style="color: #007700">;<br />		}<br />		return </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br />	return </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />};<br /><br />if ( </span><span style="color: #0000BB">$wmgAllowRobotsControlInAllNamespaces </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgExemptFromUserRobotsControl </span><span style="color: #007700">= [];<br />} else {<br />	</span><span style="color: #0000BB">$wgExemptFromUserRobotsControl </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgContentNamespaces</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgExemptFromUserRobotsControlExtra </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// additional "language names", adding to Names.php data<br /></span><span style="color: #0000BB">$wgExtraLanguageNames </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgExtraLanguageNames</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCheckUser </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CheckUser' </span><span style="color: #007700">);<br />	if ( </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// T128605<br />		// Only for CA wikis - will break stuff otherwise<br />		</span><span style="color: #0000BB">$wgCheckUserCAMultiLock </span><span style="color: #007700">= [<br />			</span><span style="color: #DD0000">'centralDB' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'metawiki'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'groups' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'steward' </span><span style="color: #007700">]<br />		];<br />	}<br />	</span><span style="color: #FF8000">// T239288 - CheckUser logs pertaining to spam blacklist logged actions appear redacted<br />	</span><span style="color: #0000BB">$wgCheckUserLogAdditionalRights</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'spamblacklistlog'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseIPInfo </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'IPInfo' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgIPInfoGeoIP2EnterprisePath </span><span style="color: #007700">= </span><span style="color: #DD0000">'/usr/share/GeoIPInfo/'</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'autoconfirmed'</span><span style="color: #007700">][</span><span style="color: #DD0000">'ipinfo'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'autoconfirmed'</span><span style="color: #007700">][</span><span style="color: #DD0000">'ipinfo-view-basic'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'ipinfo-view-full'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'sysop'</span><span style="color: #007700">][</span><span style="color: #DD0000">'ipinfo-view-log'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'checkuser'</span><span style="color: #007700">][</span><span style="color: #DD0000">'ipinfo-view-full'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'checkuser'</span><span style="color: #007700">][</span><span style="color: #DD0000">'ipinfo-view-log'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// T39211<br /></span><span style="color: #0000BB">$wgUseCombinedLoginLink </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseRC2UDP </span><span style="color: #007700">) {<br />	if ( </span><span style="color: #0000BB">$wmgRC2UDPPrefix </span><span style="color: #007700">=== </span><span style="color: #0000BB">false </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$matches </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;<br />		if ( </span><span style="color: #0000BB">preg_match</span><span style="color: #007700">( </span><span style="color: #DD0000">'/^(https?:)?\/\/(.+)\.org$/'</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgServer</span><span style="color: #007700">, </span><span style="color: #0000BB">$matches </span><span style="color: #007700">) &amp;&amp; isset( </span><span style="color: #0000BB">$matches</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">] ) ) {<br />			</span><span style="color: #0000BB">$wmgRC2UDPPrefix </span><span style="color: #007700">= </span><span style="color: #DD0000">"#</span><span style="color: #007700">{</span><span style="color: #0000BB">$matches</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]}</span><span style="color: #DD0000">\t"</span><span style="color: #007700">;<br />		}<br />	}<br /><br />	foreach ( </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'irc'</span><span style="color: #007700">] as </span><span style="color: #0000BB">$i </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$address </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgRCFeeds</span><span style="color: #007700">[</span><span style="color: #DD0000">"irc</span><span style="color: #0000BB">$i</span><span style="color: #DD0000">"</span><span style="color: #007700">] = [<br />			</span><span style="color: #DD0000">'formatter' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'IRCColourfulRCFeedFormatter'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'uri' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"udp://</span><span style="color: #0000BB">$address</span><span style="color: #DD0000">:</span><span style="color: #0000BB">$wmgRC2UDPPort</span><span style="color: #DD0000">/</span><span style="color: #0000BB">$wmgRC2UDPPrefix</span><span style="color: #DD0000">"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'add_interwiki_prefix' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'omit_bots' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,<br />		];<br />	}<br />}<br /><br /></span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #DD0000">'confirmed'</span><span style="color: #007700">][</span><span style="color: #DD0000">'skipcaptcha'</span><span style="color: #007700">] = </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'watchlistdays'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgWatchlistNumberOfDaysShow</span><span style="color: #007700">;<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikidataPageBanner </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikidataPageBanner' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseQuickSurveys </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'QuickSurveys' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseEventBus </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'EventBus' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// For analytics purposes, we forward the X-Client-IP header to eventgate.<br />	// eventgate will use this to set a default http.client_ip in event data when relevant.<br />	// https://phabricator.wikimedia.org/T288853<br />	</span><span style="color: #0000BB">$wgEventServices </span><span style="color: #007700">= [<br />		</span><span style="color: #DD0000">'eventgate-analytics' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'eventgate-analytics'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/v1/events?hasty=true"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'timeout' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">11</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'x_client_ip_forwarding_enabled' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'eventgate-analytics-external' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'eventgate-analytics-external'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/v1/events?hasty=true"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'timeout' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">11</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'x_client_ip_forwarding_enabled' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		],<br />		</span><span style="color: #DD0000">'eventgate-main' </span><span style="color: #007700">=&gt; [<br />			</span><span style="color: #DD0000">'url' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">"</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'eventgate-main'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/v1/events"</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'timeout' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">62</span><span style="color: #007700">, </span><span style="color: #FF8000">// envoy overall req timeout + 1<br />		</span><span style="color: #007700">]<br />	];<br /><br />	</span><span style="color: #0000BB">$wgRCFeeds</span><span style="color: #007700">[</span><span style="color: #DD0000">'eventbus'</span><span style="color: #007700">] = [<br />		</span><span style="color: #DD0000">'formatter' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'\\MediaWiki\\Extension\\EventBus\\Adapters\\RCFeed\\EventBusRCFeedFormatter'</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'\\MediaWiki\\Extension\\EventBus\\Adapters\\RCFeed\\EventBusRCFeedEngine'</span><span style="color: #007700">,<br />	];<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseClusterJobqueue </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgJobTypeConf</span><span style="color: #007700">[</span><span style="color: #DD0000">'default'</span><span style="color: #007700">] = [<br />			</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'\\MediaWiki\\Extension\\EventBus\\Adapters\\JobQueue\\JobQueueEventBus'</span><span style="color: #007700">,<br />			</span><span style="color: #DD0000">'readOnlyReason' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false<br />		</span><span style="color: #007700">];<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgServerGroup </span><span style="color: #007700">=== </span><span style="color: #DD0000">'jobrunner' </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgServerGroup </span><span style="color: #007700">=== </span><span style="color: #DD0000">'videoscaler' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgEventBusEnableRunJobAPI </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	} else {<br />		</span><span style="color: #0000BB">$wgEventBusEnableRunJobAPI </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCapiunto </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Capiunto' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseKartographer </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Kartographer' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgKartographerMapServer </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://maps.wikimedia.org'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgKartographerVersionedMapdata </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">; </span><span style="color: #FF8000">// T307110<br />	// Versioned maps support, see T300712<br />	</span><span style="color: #0000BB">$wgKartographerVersionedLiveMaps </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgKartographerVersionedStaticMaps </span><span style="color: #007700">= </span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUsePageViewInfo </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'PageViewInfo' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wgDBname </span><span style="color: #007700">=== </span><span style="color: #DD0000">'foundationwiki' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Foundationwiki has raw html enabled. Attempt to prevent people<br />	// from accidentally violating the privacy policy with external scripts.<br />	// Note, we need all WMF domains in here due to Special:HideBanners<br />	// being loaded as an image from various domains on donation thank you<br />	// pages.<br />	</span><span style="color: #0000BB">$wgHooks</span><span style="color: #007700">[</span><span style="color: #DD0000">'BeforePageDisplay'</span><span style="color: #007700">][] = static function ( </span><span style="color: #0000BB">$out</span><span style="color: #007700">, </span><span style="color: #0000BB">$skin </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$resp </span><span style="color: #007700">= </span><span style="color: #0000BB">$out</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getRequest</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">response</span><span style="color: #007700">();<br />		</span><span style="color: #0000BB">$cspHeader </span><span style="color: #007700">= </span><span style="color: #DD0000">"default-src *.wikimedia.org *.wikipedia.org *.wiktionary.org *.wikisource.org *.wikibooks.org *.wikiversity.org *.wikiquote.org *.wikinews.org www.mediawiki.org www.wikidata.org *.wikivoyage.org data: blob: 'self'; script-src *.wikimedia.org 'unsafe-inline' 'unsafe-eval' 'self'; style-src  *.wikimedia.org data: 'unsafe-inline' 'self'; report-uri /w/api.php?action=cspreport&amp;format=none&amp;reportonly=1&amp;source=wmfwiki&amp;"</span><span style="color: #007700">;<br />		</span><span style="color: #0000BB">$resp</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">header</span><span style="color: #007700">( </span><span style="color: #DD0000">"X-Webkit-CSP-Report-Only: </span><span style="color: #0000BB">$cspHeader</span><span style="color: #DD0000">" </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$resp</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">header</span><span style="color: #007700">( </span><span style="color: #DD0000">"X-Content-Security-Policy-Report-Only: </span><span style="color: #0000BB">$cspHeader</span><span style="color: #DD0000">" </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$resp</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">header</span><span style="color: #007700">( </span><span style="color: #DD0000">"Content-Security-Policy-Report-Only: </span><span style="color: #0000BB">$cspHeader</span><span style="color: #DD0000">" </span><span style="color: #007700">);<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUse3d </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'3D' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgTrustedMediaFormats</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'application/sla'</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wg3dProcessor </span><span style="color: #007700">= [ </span><span style="color: #DD0000">'/usr/bin/xvfb-run'</span><span style="color: #007700">, </span><span style="color: #DD0000">'-a'</span><span style="color: #007700">, </span><span style="color: #DD0000">'-s'</span><span style="color: #007700">, </span><span style="color: #DD0000">'-ac -screen 0 1280x1024x24' </span><span style="color: #007700">,</span><span style="color: #DD0000">'/srv/deployment/3d2png/deploy/src/3d2png.js' </span><span style="color: #007700">];<br /><br />	if ( </span><span style="color: #0000BB">$wmgUseMultimediaViewer </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgMediaViewerExtensions</span><span style="color: #007700">[</span><span style="color: #DD0000">'stl'</span><span style="color: #007700">] = </span><span style="color: #DD0000">'mmv.3d'</span><span style="color: #007700">;<br />	}<br /><br />	if ( </span><span style="color: #0000BB">$wmgUpload3d </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgFileExtensions</span><span style="color: #007700">[] = </span><span style="color: #DD0000">'stl'</span><span style="color: #007700">;<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseReadingLists </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgReadingListsMaxEntriesPerList </span><span style="color: #007700">= </span><span style="color: #0000BB">5000</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ReadingLists' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGlobalPreferences </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// This is intentionally loaded *after* the Echo extension (above).<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GlobalPreferences' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCongressLookup </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'CongressLookup' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikisource </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Intentionally loaded *after* the Collection extension above.<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Wikisource' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGrowthExperiments </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GrowthExperiments' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #FF8000">// T298122 temporary fix while mobile-only quality gate gets removed<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'growthexperiments-addimage-desktop'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br /><br />	if ( !</span><span style="color: #0000BB">$wmgGEFeaturesMayBeAvailableToNewcomers </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// Disable welcome survey<br />		</span><span style="color: #0000BB">$wgWelcomeSurveyExperimentalGroups </span><span style="color: #007700">= [<br />			</span><span style="color: #DD0000">'exp2_target_specialpage' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'percentage' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0 </span><span style="color: #007700">],<br />			</span><span style="color: #DD0000">'exp2_target_popup' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'percentage' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0 </span><span style="color: #007700">],<br />			</span><span style="color: #DD0000">'exp1_group2' </span><span style="color: #007700">=&gt; [ </span><span style="color: #DD0000">'percentage' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0 </span><span style="color: #007700">],<br />		];<br />		</span><span style="color: #FF8000">// Disable all other Growth features<br />		</span><span style="color: #0000BB">$wgGEHomepageNewAccountEnablePercentage </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #FF8000">// Proof-of-concept API, allowed until 2022-06-30. See T294362#7768458.<br />	</span><span style="color: #0000BB">$wgGEImageRecommendationServiceUrl </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://image-suggestion-api.wmcloud.org'</span><span style="color: #007700">;<br />	if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">!== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgGEImageRecommendationServiceHttpProxy </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'urldownloader'</span><span style="color: #007700">];<br />	}<br />	</span><span style="color: #0000BB">$wgGELinkRecommendationServiceUrl </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'linkrecommendation'</span><span style="color: #007700">];<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikiLambda </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikiLambda' </span><span style="color: #007700">);<br /><br />	</span><span style="color: #0000BB">$wgWikiLambdaOrchestratorLocation </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikifunctions-orchestrator'</span><span style="color: #007700">];<br />	</span><span style="color: #0000BB">$wgWikiLambdaEvaluatorLocation </span><span style="color: #007700">= </span><span style="color: #DD0000">"http://</span><span style="color: #007700">{</span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'wikifunctions-evaluator'</span><span style="color: #007700">]}</span><span style="color: #DD0000">/1/v1/evaluate"</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">$wgWikiLambdaWikiAPILocation </span><span style="color: #007700">= </span><span style="color: #DD0000">'https://wikifunctions.beta.wmflabs.org/w/api.php'</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikistories </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Wikistories' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">PHP_SAPI </span><span style="color: #007700">=== </span><span style="color: #DD0000">'cli' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Needed for the "abstracts" XML dumps. We only load it for PHP from the CLI.<br />	// Must be loaded explicitly here so that autoloading works when specifying<br />	// its PHP class name as CLI option to the maintenance script.<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'ActiveAbstract' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseCSPReportOnly </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseCSPReportOnlyHasSession </span><span style="color: #007700">|| </span><span style="color: #0000BB">$wmgUseCSP </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Temporary global whitelist for origins used by trusted<br />	// opt-in scripts, until a per-user ability for this exists.<br />	// T207900#4846582<br />	</span><span style="color: #0000BB">$wgCSPFalsePositiveUrls </span><span style="color: #007700">= </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgCSPFalsePositiveUrls</span><span style="color: #007700">, [<br />		</span><span style="color: #DD0000">'https://cvn.wmflabs.org' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'https://tools.wmflabs.org/intuition/' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />		</span><span style="color: #DD0000">'https://intuition.toolforge.org/' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	] );<br /><br />	</span><span style="color: #0000BB">$wgExtensionFunctions</span><span style="color: #007700">[] = static function () {<br />		global </span><span style="color: #0000BB">$wgCSPReportOnlyHeader</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgUseCSPReportOnly</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgCommandLineMode</span><span style="color: #007700">,<br />			</span><span style="color: #0000BB">$wmgApprovedContentSecurityPolicyDomains</span><span style="color: #007700">, </span><span style="color: #0000BB">$wmgUseCSP</span><span style="color: #007700">, </span><span style="color: #0000BB">$wgCSPHeader</span><span style="color: #007700">;<br />		if ( !</span><span style="color: #0000BB">$wmgUseCSPReportOnly </span><span style="color: #007700">&amp;&amp; !</span><span style="color: #0000BB">$wmgUseCSP </span><span style="color: #007700">) {<br />			</span><span style="color: #FF8000">// This means that $wmgUseCSPReportOnlyHasSession<br />			// is set, so only logged in users should trigger this.<br />			</span><span style="color: #007700">if (<br />				</span><span style="color: #0000BB">defined</span><span style="color: #007700">( </span><span style="color: #DD0000">'MW_NO_SESSION' </span><span style="color: #007700">) ||<br />				</span><span style="color: #0000BB">$wgCommandLineMode </span><span style="color: #007700">||<br />				!</span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Session</span><span style="color: #007700">\</span><span style="color: #0000BB">SessionManager</span><span style="color: #007700">::</span><span style="color: #0000BB">getGlobalSession</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">isPersistent</span><span style="color: #007700">()<br />			) {<br />				</span><span style="color: #FF8000">// There is no session, so don't set CSP, as we care more<br />				// about actual users, and this allows quick revert since<br />				// not cached in varnish<br />				</span><span style="color: #007700">return;<br />			}<br />		}<br /><br />		if ( </span><span style="color: #0000BB">$wmgUseCSPReportOnly </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$wgCSPReportOnlyHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'useNonces'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />			</span><span style="color: #0000BB">$wgCSPReportOnlyHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'includeCORS'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />			</span><span style="color: #0000BB">$wgCSPReportOnlyHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'default-src'</span><span style="color: #007700">] = </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br />				</span><span style="color: #0000BB">$wmgApprovedContentSecurityPolicyDomains</span><span style="color: #007700">,<br />				[<br />					</span><span style="color: #FF8000">// Needed for Math. Remove when/if math is fixed.<br />					</span><span style="color: #DD0000">'wikimedia.org'</span><span style="color: #007700">,<br />				]<br />			);<br />			</span><span style="color: #0000BB">$wgCSPReportOnlyHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'script-src'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgApprovedContentSecurityPolicyDomains</span><span style="color: #007700">;<br />		}<br /><br />		if ( </span><span style="color: #0000BB">$wmgUseCSP </span><span style="color: #007700">) {<br />			</span><span style="color: #0000BB">$wgCSPHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'useNonces'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />			</span><span style="color: #0000BB">$wgCSPHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'includeCORS'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />			</span><span style="color: #0000BB">$wgCSPHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'default-src'</span><span style="color: #007700">] = </span><span style="color: #0000BB">array_merge</span><span style="color: #007700">(<br />				</span><span style="color: #0000BB">$wmgApprovedContentSecurityPolicyDomains</span><span style="color: #007700">,<br />				[<br />					</span><span style="color: #FF8000">// Needed for Math. Remove when/if math is fixed.<br />					</span><span style="color: #DD0000">'wikimedia.org'</span><span style="color: #007700">,<br />				]<br />			);<br />			</span><span style="color: #0000BB">$wgCSPHeader</span><span style="color: #007700">[</span><span style="color: #DD0000">'script-src'</span><span style="color: #007700">] = </span><span style="color: #0000BB">$wmgApprovedContentSecurityPolicyDomains</span><span style="color: #007700">;<br />		}<br />	};<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'labs' </span><span style="color: #007700">) {<br />	require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">'/CommonSettings-labs.php'</span><span style="color: #007700">;<br />}<br /><br />foreach ( </span><span style="color: #0000BB">$wgGroupPermissions </span><span style="color: #007700">as </span><span style="color: #0000BB">$group </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$_ </span><span style="color: #007700">) {<br />	if ( </span><span style="color: #0000BB">$group </span><span style="color: #007700">!== </span><span style="color: #DD0000">'interface-admin' </span><span style="color: #007700">&amp;&amp; (<br />		!empty( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editsitecss'</span><span style="color: #007700">] )<br />		|| !empty( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editsitejs'</span><span style="color: #007700">] )<br />		|| !empty( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editusercss'</span><span style="color: #007700">] )<br />		|| !empty( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'edituserjs'</span><span style="color: #007700">] )<br />		|| !empty( </span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editmyuserjsredirect'</span><span style="color: #007700">] )<br />	) ) {<br />		</span><span style="color: #FF8000">// enforce that interace-admin is the only group that can edit non-own CSS/JS<br />		</span><span style="color: #007700">unset(<br />			</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editsitecss'</span><span style="color: #007700">],<br />			</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editsitejs'</span><span style="color: #007700">],<br />			</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editusercss'</span><span style="color: #007700">],<br />			</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'edituserjs'</span><span style="color: #007700">],<br />			</span><span style="color: #0000BB">$wgGroupPermissions</span><span style="color: #007700">[</span><span style="color: #0000BB">$group</span><span style="color: #007700">][</span><span style="color: #DD0000">'editmyuserjsredirect'</span><span style="color: #007700">]<br />		);<br />	}<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgShowRollbackConfirmationDefaultUserOptions </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgDefaultUserOptions</span><span style="color: #007700">[</span><span style="color: #DD0000">'showrollbackconfirmation'</span><span style="color: #007700">] = </span><span style="color: #0000BB">1</span><span style="color: #007700">;<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikimediaEditorTasks </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikimediaEditorTasks' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseMachineVision </span><span style="color: #007700">) {<br />	if ( </span><span style="color: #0000BB">$wmgRealm </span><span style="color: #007700">=== </span><span style="color: #DD0000">'production' </span><span style="color: #007700">) {<br />		</span><span style="color: #0000BB">$wgMachineVisionHttpProxy </span><span style="color: #007700">= </span><span style="color: #0000BB">$wmgLocalServices</span><span style="color: #007700">[</span><span style="color: #DD0000">'urldownloader'</span><span style="color: #007700">];<br />	}<br /><br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'MachineVision' </span><span style="color: #007700">);<br />	</span><span style="color: #0000BB">$wgNotifyTypeAvailabilityByCategory</span><span style="color: #007700">[</span><span style="color: #DD0000">'machinevision'</span><span style="color: #007700">][</span><span style="color: #DD0000">'email'</span><span style="color: #007700">] = </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #FF8000">// T283003: TheWikipediaLibrary requires GlobalPreferences and CentralAuth to be installed<br /></span><span style="color: #007700">if ( </span><span style="color: #0000BB">$wmgUseTheWikipediaLibrary </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseGlobalPreferences </span><span style="color: #007700">&amp;&amp; </span><span style="color: #0000BB">$wmgUseCentralAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'TheWikipediaLibrary' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikimediaApiPortal </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadSkin</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikimediaApiPortal' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseWikimediaApiPortalOAuth </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'WikimediaApiPortalOAuth' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseGlobalWatchlist </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'GlobalWatchlist' </span><span style="color: #007700">);<br />}<br /><br />if ( </span><span style="color: #0000BB">$wmgUseNearbyPages </span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'NearbyPages' </span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #FF8000">// This is a temporary hack for hooking up Parsoid/PHP with MediaWiki<br />// This is just the regular check out of parsoid in that week's vendor<br /></span><span style="color: #0000BB">$parsoidDir </span><span style="color: #007700">= </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$IP</span><span style="color: #DD0000">/vendor/wikimedia/parsoid"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$wgParsoidSettings </span><span style="color: #007700">= [<br />	</span><span style="color: #DD0000">'useSelser' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'linting' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">true</span><span style="color: #007700">,<br />	</span><span style="color: #DD0000">'nativeGalleryEnabled' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">false</span><span style="color: #007700">,  </span><span style="color: #FF8000">// T214649<br /></span><span style="color: #007700">];<br />if ( </span><span style="color: #0000BB">$wmgServerGroup </span><span style="color: #007700">=== </span><span style="color: #DD0000">'parsoid' </span><span style="color: #007700">) {<br />	if ( </span><span style="color: #0000BB">wfHostName</span><span style="color: #007700">() === </span><span style="color: #DD0000">'scandium' </span><span style="color: #007700">) {<br />		</span><span style="color: #FF8000">// Scandium has its own special check out of parsoid for testing.<br />		</span><span style="color: #0000BB">$parsoidDir </span><span style="color: #007700">= </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">"/../../parsoid-testing"</span><span style="color: #007700">;<br />		</span><span style="color: #FF8000">// Override settings specific to round-trip testing on scandium<br />		</span><span style="color: #007700">require_once </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$parsoidDir</span><span style="color: #DD0000">/tests/RTTestSettings.php"</span><span style="color: #007700">;<br />	}<br /><br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Parsoid'</span><span style="color: #007700">, </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$parsoidDir</span><span style="color: #DD0000">/extension.json" </span><span style="color: #007700">);<br />} elseif ( </span><span style="color: #0000BB">$wmgServerGroup </span><span style="color: #007700">=== </span><span style="color: #DD0000">'api_appserver' </span><span style="color: #007700">) {<br />	</span><span style="color: #FF8000">// Parsoid extension needed by core REST /html handler<br />	// until T265518 is resolved, but we do not want to expose<br />	// Parsoid REST API.<br />	</span><span style="color: #0000BB">$wgParsoidEnableREST </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />	</span><span style="color: #0000BB">wfLoadExtension</span><span style="color: #007700">( </span><span style="color: #DD0000">'Parsoid'</span><span style="color: #007700">, </span><span style="color: #DD0000">"</span><span style="color: #0000BB">$parsoidDir</span><span style="color: #DD0000">/extension.json" </span><span style="color: #007700">);<br />}<br />unset( </span><span style="color: #0000BB">$parsoidDir </span><span style="color: #007700">);<br /></span><span style="color: #FF8000">// End of temporary hack for hooking up Parsoid/PHP with MediaWiki<br /><br /></span><span style="color: #007700">class </span><span style="color: #0000BB">ClosedWikiProvider </span><span style="color: #007700">extends \</span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Auth</span><span style="color: #007700">\</span><span style="color: #0000BB">AbstractPreAuthenticationProvider </span><span style="color: #007700">{<br />	</span><span style="color: #FF8000">/**<br />	 * @param User $user<br />	 * @param bool $autocreate<br />	 * @param array $options<br />	 * @return \StatusValue<br />	 */<br />	</span><span style="color: #007700">public function </span><span style="color: #0000BB">testUserForCreation</span><span style="color: #007700">( </span><span style="color: #0000BB">$user</span><span style="color: #007700">, </span><span style="color: #0000BB">$autocreate</span><span style="color: #007700">, array </span><span style="color: #0000BB">$options </span><span style="color: #007700">= [] ) {<br />		</span><span style="color: #0000BB">$logger </span><span style="color: #007700">= \</span><span style="color: #0000BB">MediaWiki</span><span style="color: #007700">\</span><span style="color: #0000BB">Logger</span><span style="color: #007700">\</span><span style="color: #0000BB">LoggerFactory</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">( </span><span style="color: #DD0000">'authentication' </span><span style="color: #007700">);<br />		</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">( </span><span style="color: #DD0000">'Running ClosedWikiProvider for {name}'</span><span style="color: #007700">, [<br />			</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">()<br />		] );<br />		if ( </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getId</span><span style="color: #007700">() ) { </span><span style="color: #FF8000">// User already exists, do not block authentication<br />			</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">( </span><span style="color: #DD0000">'User {name} passed ClosedWikiProvider check, account already exists'</span><span style="color: #007700">, [<br />				</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">()<br />			] );<br />			return \</span><span style="color: #0000BB">StatusValue</span><span style="color: #007700">::</span><span style="color: #0000BB">newGood</span><span style="color: #007700">();<br />		}<br />		</span><span style="color: #0000BB">$central </span><span style="color: #007700">= </span><span style="color: #0000BB">CentralAuthUser</span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">( </span><span style="color: #0000BB">$user </span><span style="color: #007700">);<br />		if (<br />			</span><span style="color: #0000BB">$central</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasGlobalPermission</span><span style="color: #007700">( </span><span style="color: #DD0000">'createaccount' </span><span style="color: #007700">) ||<br />			</span><span style="color: #0000BB">$central</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">hasGlobalPermission</span><span style="color: #007700">( </span><span style="color: #DD0000">'autocreateaccount' </span><span style="color: #007700">)<br />		) {<br />			</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">info</span><span style="color: #007700">(<br />				</span><span style="color: #DD0000">'User {name} passed ClosedWikiProvider check, has permissions'</span><span style="color: #007700">,<br />				[<br />					</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">()<br />				]<br />			);<br />			</span><span style="color: #FF8000">// User can autocreate account per global permissions<br />			</span><span style="color: #007700">return \</span><span style="color: #0000BB">StatusValue</span><span style="color: #007700">::</span><span style="color: #0000BB">newGood</span><span style="color: #007700">();<br />		}<br />		</span><span style="color: #0000BB">$logger</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">error</span><span style="color: #007700">(<br />			</span><span style="color: #DD0000">'Account autocreation denied for {name} by ClosedWikiProvider'</span><span style="color: #007700">, [<br />				</span><span style="color: #DD0000">'name' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">$user</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">()<br />			]<br />		);<br />		return \</span><span style="color: #0000BB">StatusValue</span><span style="color: #007700">::</span><span style="color: #0000BB">newFatal</span><span style="color: #007700">( </span><span style="color: #DD0000">'authmanager-autocreate-noperm' </span><span style="color: #007700">);<br />	}<br />}<br /><br />if (<br />	</span><span style="color: #0000BB">in_array</span><span style="color: #007700">( </span><span style="color: #0000BB">$wgDBname</span><span style="color: #007700">, </span><span style="color: #0000BB">MWWikiversions</span><span style="color: #007700">::</span><span style="color: #0000BB">readDbListFile</span><span style="color: #007700">( </span><span style="color: #DD0000">'closed' </span><span style="color: #007700">) ) &amp;&amp;<br />	</span><span style="color: #0000BB">$wmgUseCentralAuth<br /></span><span style="color: #007700">) {<br />	</span><span style="color: #0000BB">$wgAuthManagerAutoConfig</span><span style="color: #007700">[</span><span style="color: #DD0000">'preauth'</span><span style="color: #007700">][\</span><span style="color: #0000BB">ClosedWikiProvider</span><span style="color: #007700">::class] = [<br />		</span><span style="color: #DD0000">'class' </span><span style="color: #007700">=&gt; \</span><span style="color: #0000BB">ClosedWikiProvider</span><span style="color: #007700">::class,<br />		</span><span style="color: #DD0000">'sort' </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">0</span><span style="color: #007700">,<br />	];<br />}<br /><br /></span><span style="color: #FF8000"># THIS MUST BE AFTER ALL EXTENSIONS ARE INCLUDED<br />#<br /># REALLY ... we're not kidding here ... NO EXTENSIONS AFTER<br /><br /></span><span style="color: #007700">if ( !</span><span style="color: #0000BB">defined</span><span style="color: #007700">( </span><span style="color: #DD0000">'MW_NO_EXTENSION_MESSAGES' </span><span style="color: #007700">) ) {<br />	require </span><span style="color: #0000BB">__DIR__ </span><span style="color: #007700">. </span><span style="color: #DD0000">"/ExtensionMessages-</span><span style="color: #0000BB">$wmgVersionNumber</span><span style="color: #DD0000">.php"</span><span style="color: #007700">;<br />}<br /></span>
</span>
</code></pre></body>
</html>
